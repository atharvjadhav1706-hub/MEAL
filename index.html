<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="theme-color" content="#0C0C14"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<title>80 KG</title>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CSS VARIABLES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --bg:#0C0C14; --surface:#13131F; --card:#1A1A2E; --card2:#1E1E32;
  --border:#2A2A45; --text:#EEEEff; --sub:#7777AA;
  --accent:#6C63FF; --accent2:#FF6584; --gold:#FFD700; --water:#29B6F6;
  --bg2:#0a0a0f; --surface-imp:rgba(255,255,255,0.03);
  --border-imp:rgba(255,255,255,0.07); --border-bright:rgba(255,255,255,0.15);
  --text-sec:rgba(240,240,248,0.45); --a-green:#00E5A0; --a-red:#FF4D6D;
  --font-head:'Playfair Display',serif; --font-body:'Plus Jakarta Sans',sans-serif;
  --r:22px;
}
.light{
  --bg:#F0F0FA; --surface:#FFFFFF; --card:#E8E8F8; --card2:#DDDDF0;
  --border:#C8C8E8; --text:#1A1A35; --sub:#6666AA;
  --bg2:#F8F8FC; --surface-imp:#FFFFFF; --border-imp:#C8C8E8;
  --border-bright:#A0A0C0; --text-sec:#6666AA; --a-red:#E0002A;
}

/* â”€â”€ GOOGLE FONTS â”€â”€ */
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap');

*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
html{scroll-behavior:smooth;}
body{font-family:var(--font-body);background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;transition:background .4s,color .4s;}

/* â”€â”€ ORB BACKGROUND â”€â”€ */
.orb{position:fixed;border-radius:50%;filter:blur(90px);pointer-events:none;z-index:0;animation:drift 14s ease-in-out infinite alternate;}
.o1{width:340px;height:340px;background:radial-gradient(#6C63FF2A,transparent);top:-100px;left:-100px;}
.o2{width:280px;height:280px;background:radial-gradient(#FF65842A,transparent);bottom:80px;right:-70px;animation-delay:-7s;}
.o3{width:200px;height:200px;background:radial-gradient(#43E97B18,transparent);top:42%;left:32%;animation-delay:-3s;}
@keyframes drift{0%{transform:translate(0,0) scale(1);}100%{transform:translate(28px,20px) scale(1.12);}}

/* â”€â”€ TOAST â”€â”€ */
#toast{
  position:fixed;top:20px;left:50%;transform:translateX(-50%) translateY(-80px);
  background:rgba(18,18,24,0.97);padding:13px 24px;border-radius:40px;
  border:1px solid var(--border-bright);color:var(--text);
  font-size:0.87rem;font-weight:700;z-index:10000;
  box-shadow:0 8px 32px rgba(0,0,0,0.5);font-family:var(--font-body);
  transition:transform .35s cubic-bezier(.34,1.56,.64,1);pointer-events:none;
  white-space:nowrap;
}
#toast.show{transform:translateX(-50%) translateY(0);}

/* â”€â”€ OFFLINE INDICATOR â”€â”€ */
#offlineBadge{
  position:fixed;top:12px;right:14px;z-index:9999;
  background:#FF4D6D;color:#fff;font-size:10px;font-weight:800;
  padding:4px 10px;border-radius:20px;display:none;letter-spacing:.5px;
  font-family:var(--font-body);
}

/* â”€â”€ PAGE SYSTEM â”€â”€ */
#home{position:relative;z-index:1;max-width:440px;margin:0 auto;min-height:100vh;padding-bottom:100px;}
.page{
  position:fixed;inset:0;z-index:100;background:var(--bg);
  transform:translateX(100%);transition:transform .38s cubic-bezier(.4,0,.2,1);
  display:flex;flex-direction:column;overflow:hidden;
}
.page.active{transform:translateX(0);}
.page-inner{max-width:440px;margin:0 auto;width:100%;display:flex;flex-direction:column;height:100%;}
.page-scroll{flex:1;overflow-y:auto;padding-bottom:40px;}
.page-scroll::-webkit-scrollbar{width:3px;}
.page-scroll::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px;}

/* â”€â”€ HEADER â”€â”€ */
.hdr{position:sticky;top:0;z-index:200;background:var(--bg);padding:18px 20px 14px;backdrop-filter:blur(14px);}
.hdr-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;}
.logo{font-family:var(--font-head);font-size:28px;font-weight:900;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.logo-date{font-size:11px;color:var(--sub);letter-spacing:.5px;margin-top:-2px;}
.hdr-right{display:flex;gap:10px;align-items:center;}

.streak-pill{display:flex;align-items:center;gap:7px;
  background:linear-gradient(135deg,#6C63FF22,#FF658422);
  border:1px solid #6C63FF44;border-radius:16px;padding:7px 14px;}
.s-fire{font-size:22px;animation:fireA 1.6s ease-in-out infinite;}
@keyframes fireA{0%,100%{transform:scale(1) rotate(-3deg);}50%{transform:scale(1.18) rotate(3deg);}}
.s-num{font-family:var(--font-head);font-size:21px;font-weight:900;color:var(--accent);line-height:1;}
.s-lbl{font-size:9px;color:var(--sub);text-transform:uppercase;letter-spacing:1px;}

.icon-btn{width:42px;height:42px;background:var(--card);border:1px solid var(--border);
  border-radius:14px;font-size:20px;cursor:pointer;display:flex;align-items:center;
  justify-content:center;transition:all .22s;color:var(--text);flex-shrink:0;}
.icon-btn:hover{transform:scale(1.08);border-color:var(--accent);}

/* â”€â”€ CARDS â”€â”€ */
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);
  padding:20px;margin-bottom:14px;position:relative;overflow:hidden;animation:fadeUp .4s ease both;}
.card::before{content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,#6C63FF06,transparent 60%);pointer-events:none;}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px);}to{opacity:1;transform:translateY(0);}}

/* â”€â”€ CALORIE CARD â”€â”€ */
.cal-row{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px;}
.cal-big{font-family:var(--font-head);font-size:46px;font-weight:900;color:var(--accent);line-height:1;}
.cal-unit{font-size:12px;color:var(--sub);margin-top:4px;}
.cal-right{text-align:right;}
.cal-rem{font-family:var(--font-head);font-size:24px;font-weight:700;color:var(--accent2);}
.cal-rlbl{font-size:11px;color:var(--sub);}
.pbar-wrap{height:12px;background:var(--border);border-radius:12px;overflow:hidden;margin-bottom:6px;}
.pbar{height:100%;border-radius:12px;transition:width .8s cubic-bezier(.4,0,.2,1);position:relative;}
.pbar::after{content:'';position:absolute;right:0;top:0;height:100%;width:30px;
  background:linear-gradient(90deg,transparent,#ffffff22);animation:shim 2s linear infinite;}
@keyframes shim{0%{opacity:0;}50%{opacity:1;}100%{opacity:0;}}
.pb-cal{background:linear-gradient(90deg,var(--accent),var(--accent2));box-shadow:0 0 14px #6C63FF44;}
.pb-water{background:linear-gradient(90deg,#29B6F6,#0288D1);box-shadow:0 0 14px #29B6F644;}
.plabel{display:flex;justify-content:space-between;font-size:11px;color:var(--sub);}

/* â”€â”€ WATER CARD â”€â”€ */
.water-big{font-family:var(--font-head);font-size:36px;font-weight:900;color:var(--water);}
.water-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:14px;}
.water-btn{background:linear-gradient(135deg,#29B6F622,#0288D122);border:1px solid #29B6F644;
  border-radius:14px;padding:12px 4px;color:var(--water);font-family:var(--font-head);
  font-weight:700;font-size:15px;cursor:pointer;transition:all .22s;text-align:center;}
.water-btn span{display:block;font-size:10px;font-family:var(--font-body);font-weight:400;opacity:.7;}
.water-btn:hover{transform:translateY(-3px) scale(1.05);box-shadow:0 6px 18px #29B6F644;}
.water-btn:active{transform:scale(.95);}
.water-reset{margin-top:8px;width:100%;background:transparent;border:1px solid var(--border);
  border-radius:10px;padding:7px;color:var(--sub);font-family:var(--font-body);
  font-size:12px;cursor:pointer;transition:all .2s;}
.water-reset:hover{border-color:var(--accent2);color:var(--accent2);}

/* â”€â”€ NAV CARDS â”€â”€ */
.nav-card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);
  padding:18px 20px;margin-bottom:14px;display:flex;align-items:center;gap:16px;
  cursor:pointer;transition:all .26s;animation:fadeUp .4s ease both;position:relative;overflow:hidden;}
.nav-card::before{content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,#6C63FF06,transparent 60%);pointer-events:none;}
.nav-card:hover{transform:translateY(-3px);border-color:var(--accent);box-shadow:0 8px 28px #6C63FF22;}
.nav-card:active{transform:scale(.98);}
.nav-icon{width:52px;height:52px;border-radius:16px;display:flex;align-items:center;
  justify-content:center;font-size:26px;flex-shrink:0;}
.ni-meals{background:linear-gradient(135deg,var(--accent),var(--accent2));}
.ni-history{background:linear-gradient(135deg,var(--gold),#FF8E53);}
.ni-maida{background:linear-gradient(135deg,#FFD700,#FFA500);}
.nav-info{flex:1;}
.nav-title{font-family:var(--font-head);font-size:17px;font-weight:700;margin-bottom:2px;}
.nav-sub{font-size:12px;color:var(--sub);}
.nav-arrow{font-size:22px;color:var(--sub);transition:transform .22s;}
.nav-card:hover .nav-arrow{transform:translateX(5px);color:var(--accent);}

/* â•â•â• SUB-PAGE SHARED â•â•â• */
.page-hdr{display:flex;align-items:center;gap:14px;padding:18px 20px 14px;
  position:sticky;top:0;z-index:50;background:var(--bg);backdrop-filter:blur(14px);}
.back-btn{width:40px;height:40px;background:var(--card);border:1px solid var(--border);
  border-radius:13px;font-size:18px;cursor:pointer;display:flex;align-items:center;
  justify-content:center;transition:all .22s;color:var(--text);flex-shrink:0;}
.back-btn:hover{border-color:var(--accent);transform:scale(1.06);}
.page-title{font-family:var(--font-head);font-size:22px;font-weight:900;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.pcontent{padding:0 20px 40px;}
.sec-lbl{font-family:var(--font-head);font-size:15px;font-weight:700;
  margin-bottom:10px;display:flex;align-items:center;gap:8px;}

/* â•â•â• SETTINGS PAGE â•â•â• */
.tog-row{display:flex;justify-content:space-between;align-items:center;
  margin-bottom:0;padding-bottom:0;border:none;}
.tog-lbl{font-size:14px;font-weight:500;}
.tog{width:54px;height:30px;border-radius:15px;background:var(--border);
  cursor:pointer;position:relative;transition:background .3s;border:none;}
.tog.on{background:linear-gradient(135deg,var(--accent),var(--accent2));}
.tog-knob{position:absolute;top:4px;left:4px;width:22px;height:22px;border-radius:50%;
  background:#fff;transition:left .3s;box-shadow:0 2px 6px #0005;}
.tog.on .tog-knob{left:28px;}

/* â”€â”€ IMPORT BOXES â”€â”€ */
.import-box{background:var(--card2);border:1px solid var(--border);
  border-radius:20px;padding:22px;margin-bottom:14px;}
.import-box h3{font-size:15px;font-weight:700;font-family:var(--font-head);
  color:var(--text);margin-bottom:6px;}
.import-box p{font-size:12px;color:var(--sub);margin-bottom:14px;line-height:1.5;}

.import-tabs{display:flex;background:var(--card);border-radius:12px;padding:3px;gap:3px;
  border:1px solid var(--border);margin-bottom:14px;}
.imp-tab{flex:1;padding:8px 0;border-radius:9px;border:none;
  font-family:var(--font-body);font-weight:600;font-size:12px;cursor:pointer;
  transition:all .25s;background:transparent;color:var(--sub);}
.imp-tab.active{background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:#fff;box-shadow:0 2px 10px #6C63FF33;}

.import-textarea{width:100%;height:150px;padding:14px;
  background:var(--surface-imp);border:1px solid var(--border-imp);
  color:var(--a-green);border-radius:14px;margin-bottom:12px;
  font-family:monospace;font-size:0.79rem;resize:none;outline:none;
  transition:border-color .2s;line-height:1.5;}
.import-textarea:focus{border-color:var(--border-bright);}
.import-hint{font-size:11px;color:var(--sub);margin-bottom:10px;line-height:1.5;
  background:var(--card);border-radius:10px;padding:10px 12px;border:1px solid var(--border);}
.import-hint code{color:var(--a-green);font-size:10.5px;}

.import-btn{width:100%;padding:13px;background:transparent;
  border:1px solid var(--border-bright);color:var(--text);
  font-weight:700;font-size:14px;border-radius:14px;cursor:pointer;
  transition:all .22s;font-family:var(--font-body);}
.import-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--card);}
.import-btn:active{transform:scale(.97);}

/* â”€â”€ DANGER ZONE â”€â”€ */
.danger-card{background:linear-gradient(135deg,#FF3B3008,transparent); border:1px solid #FF3B3044;border-radius:20px;padding:20px;margin-bottom:14px;margin-top:20px;}
.danger-title{font-size:11px;font-weight:700;color:#FF4D6D; letter-spacing:1.5px;text-transform:uppercase;margin-bottom:12px;}
.btn-danger{width:100%;padding:12px;border-radius:12px;border:1px solid #FF3B3055; background:transparent;color:#FF4D6D;font-family:var(--font-body); font-weight:700;font-size:13px;cursor:pointer;transition:all .22s;margin-bottom:8px;}
.btn-danger:hover{background:#FF3B3015;border-color:#FF4D6D;}

/* â”€â”€ QUICK ADD FORM & AUTOCOMPLETE (MOVED TO MEALS PAGE) â”€â”€ */
.quick-form{display:flex;flex-direction:column;gap:10px;position:relative; background:var(--card); border:1px solid var(--border); padding:16px; border-radius: 20px;}
.quick-form input{
  background:var(--surface);border:1px solid var(--border);color:var(--text);
  border-radius:12px;padding:12px 14px;font-family:var(--font-body);
  font-size:13px;outline:none;width:100%;transition:border-color .2s;}
.quick-form input::placeholder{color:var(--sub);}
.quick-form input:focus{border-color:var(--accent);}
.qf-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.readonly-input{background:var(--surface-imp) !important; color:var(--accent2) !important; font-weight:700;}

.autocomplete-items{
  position:absolute; top:46px; left:0; right:0;
  z-index:99; max-height:220px; overflow-y:auto;
  display:none; flex-direction:column; gap:8px;
  background:transparent; padding:4px 2px;
}
.autocomplete-items::-webkit-scrollbar{width:3px;}
.autocomplete-items::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px;}

.ac-card {
  background: var(--card2); border: 1px solid var(--border); border-radius: 14px;
  position: relative; overflow: hidden; padding: 12px 16px;
  cursor: pointer; transition: all .2s;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  display: flex; justify-content: space-between; align-items: center;
}
.ac-card:hover { border-color: var(--accent); transform: translateY(-2px); }
.ac-card::before {
  content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px;
  background: var(--accent); border-radius: 4px 0 0 4px;
}
.ac-title { font-size: 1rem; font-weight: 700; color: var(--text); letter-spacing: -0.2px;}
.ac-cal { 
  background:rgba(128,128,128,.1); color:var(--sub); padding:4px 10px;
  border-radius:8px; font-weight:600; font-size:.7rem; border:1px solid var(--border);
}


/* â•â•â• MEALS PAGE â•â•â• */
.mini-cal{background:var(--card);border:1px solid var(--border);
  border-radius:18px;padding:14px 18px;margin-bottom:16px;
  display:flex;justify-content:space-between;align-items:center;}
.mc-num{font-family:var(--font-head);font-size:28px;font-weight:900;color:var(--accent);}
.mc-lbl{font-size:11px;color:var(--sub);}
.meal-list{display:flex;flex-direction:column;gap:12px;}

/* â”€â”€ MEAL CARD â”€â”€ */
.meal-card{
  background:var(--card2);border:1px solid var(--border);border-radius:20px;
  position:relative;overflow:hidden;padding-left:4px;
  transition:all .3s cubic-bezier(.16,1,.3,1);
  box-shadow:0 4px 20px rgba(0,0,0,0.08);animation:fadeUp .4s ease both;
}
.meal-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:4px;
  background:var(--accent-color,var(--border));border-radius:4px 0 0 4px;}
.meal-card:hover{transform:translateY(-2px);border-color:var(--border-bright);}
.meal-card.checked{opacity:.38;filter:grayscale(.7);}
.meal-card.highlight{
  border-color:var(--accent-color) !important;
  box-shadow:0 0 0 1px var(--accent-color),0 8px 32px rgba(var(--accent-rgb),.18) !important;
  animation:pulseRing 2.5s ease-in-out infinite;
}
@keyframes pulseRing{
  0%,100%{box-shadow:0 0 0 0 rgba(255,255,255,.12),0 0 0 1px var(--accent-color);}
  50%{box-shadow:0 0 0 5px rgba(255,255,255,.0),0 0 0 1px var(--accent-color);}
}

.next-badge{display:none;position:absolute;top:0;right:56px;
  background:var(--accent-color);color:#000;font-size:9px;
  font-weight:900;padding:5px 12px;border-bottom-left-radius:10px;
  border-bottom-right-radius:10px;text-transform:uppercase;letter-spacing:1px;z-index:10;}
.meal-card.highlight .next-badge{display:block;}

.mc-content{padding:16px 18px;position:relative;}
.mc-top{display:flex;align-items:center;margin-bottom:8px;gap:8px;padding-right:44px;}
.mc-time{color:var(--accent-color);font-weight:700;font-size:.75rem;
  text-transform:uppercase;letter-spacing:1px;flex-shrink:0;}
.mc-cal{background:rgba(128,128,128,.1);color:var(--sub);padding:4px 10px;
  border-radius:8px;font-weight:600;font-size:.7rem;border:1px solid var(--border);flex-shrink:0;}
.mc-title{font-size:1.15rem;font-weight:700;color:var(--text);margin-bottom:12px;
  letter-spacing:-.3px;line-height:1.3;padding-right:44px;}

.ing-row{display:flex;justify-content:space-between;align-items:center;
  margin-bottom:8px;padding-bottom:8px;border-bottom:1px solid var(--border);gap:10px;}
.ing-row:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0;}
.ing-left{display:flex;align-items:center;color:var(--text-sec);font-size:.88rem;flex:1;}
.ing-bullet{width:5px;height:5px;border-radius:50%;
  background:var(--accent-color);margin-right:10px;opacity:.7;flex-shrink:0;}
.ing-tag{background:var(--surface-imp);font-weight:600;font-size:.72rem;
  padding:4px 10px;border-radius:8px;border:1px solid var(--border);
  color:var(--sub);white-space:nowrap;}

.mchk{position:absolute;top:14px;right:14px;width:34px;height:34px;
  border-radius:50%;border:1.5px solid var(--border);background:var(--card);
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  transition:all .3s cubic-bezier(.34,1.56,.64,1);font-size:1rem;
  color:transparent;user-select:none;z-index:20;}
.mchk:active{transform:scale(.84);}
.mchk.on{background:var(--a-green);border-color:var(--a-green);color:#000;
  box-shadow:0 0 18px rgba(0,229,160,.4);}

/* empty state */
.empty-state{text-align:center;padding:40px 20px;color:var(--sub);}
.empty-icon{font-size:52px;margin-bottom:14px;opacity:.6;}

.btn-main{width:100%;padding:14px;border:none;border-radius:16px;
  font-family:var(--font-body);font-weight:700;font-size:14px;cursor:pointer;
  color:#fff;transition:all .25s;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  box-shadow:0 4px 18px #6C63FF33;}
.btn-main:hover{transform:translateY(-2px);box-shadow:0 8px 24px #6C63FF55;}
.btn-main:active{transform:scale(.97);}

/* â•â•â• NO MAIDA PAGE â•â•â• */
@keyframes mPulse{0%,100%{transform:scale(1);}50%{transform:scale(1.06);}}
.btn-mark{width:100%;padding:16px;border-radius:18px;border:1.5px solid #FFD70044;
  cursor:pointer;font-family:var(--font-head);font-size:16px;font-weight:700;
  background:linear-gradient(135deg,#FFD70018,#FFA50018);color:var(--gold);transition:all .28s;}
.btn-mark:hover{background:linear-gradient(135deg,#FFD70030,#FFA50030);
  transform:translateY(-2px);box-shadow:0 6px 24px #FFD70033;}
.btn-mark.marked{border-color:var(--gold);background:linear-gradient(135deg,#FFD70030,#FFA50030);}
.chips{display:flex;flex-wrap:wrap;gap:7px;margin-top:14px;}
.chip{background:#FFD70011;border:1px solid #FFD70044;border-radius:10px;
  padding:6px 12px;font-size:11px;color:var(--gold);font-weight:600;}

/* â•â•â• HISTORY PAGE â•â•â• */
.h-card{background:var(--card2);border:1px solid var(--border);border-radius:20px;
  padding:18px;margin-bottom:12px;position:relative;overflow:hidden;animation:fadeUp .4s ease both;}
.h-card::before{content:'';position:absolute;top:-40px;right:-40px;width:110px;height:110px;
  border-radius:50%;background:radial-gradient(#6C63FF11,transparent);pointer-events:none;}
.h-date{font-family:var(--font-head);font-size:15px;font-weight:700;}
.h-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:12px 0 14px;}
.h-stat{background:var(--card);border-radius:14px;padding:12px;border:1px solid var(--border);}
.h-sn{font-family:var(--font-head);font-size:26px;font-weight:900;}
.h-sl{font-size:10px;color:var(--sub);text-transform:uppercase;letter-spacing:1px;margin-top:2px;}
.h-badge{position:absolute;top:14px;right:14px;font-size:22px;}
.h-empty{text-align:center;padding:60px 20px;color:var(--sub);}
.h-empty-icon{font-size:54px;margin-bottom:14px;}
</style>
</head>
<body>

<div id="offlineBadge">ğŸ“µ OFFLINE</div>
<div id="toast"></div>

<div class="orb o1"></div>
<div class="orb o2"></div>
<div class="orb o3"></div>

<div id="home">
  <div class="hdr">
    <div class="hdr-top">
      <div>
        <div class="logo">80 KG</div>
        <div class="logo-date" id="hdrDate"></div>
      </div>
      <div class="hdr-right">
        <div class="streak-pill">
          <span class="s-fire">ğŸ”¥</span>
          <div><div class="s-num" id="streakNum">0</div><div class="s-lbl">streak</div></div>
        </div>
        <button class="icon-btn" onclick="openPage('settingsPage')" title="Settings">âš™ï¸</button>
      </div>
    </div>
  </div>

  <div class="content" style="padding:0 20px;">

    <div class="card" style="animation-delay:.04s">
      <div class="cal-row">
        <div>
          <div class="cal-big" id="calConsumed">0</div>
          <div class="cal-unit">kcal consumed today</div>
        </div>
        <div class="cal-right">
          <div class="cal-rem" id="calRemain">0</div>
          <div class="cal-rlbl">remaining</div>
          <div class="cal-rlbl" id="calTotalLbl" style="margin-top:4px;font-size:10px"></div>
        </div>
      </div>
      <div class="pbar-wrap"><div class="pbar pb-cal" id="calBar" style="width:0%"></div></div>
      <div class="plabel"><span>0</span><span id="calPct">0%</span><span id="calGoalLabel">2200 kcal</span></div>
    </div>

    <div class="card" style="animation-delay:.09s">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <div class="sec-lbl" style="margin-bottom:0;font-size:14px">ğŸ’§ Hydration</div>
        <div style="font-size:11px;color:var(--sub)">Goal: 5000 ml</div>
      </div>
      <div class="water-big" id="waterAmt">0 ml</div>
      <div class="pbar-wrap" style="margin:10px 0 6px"><div class="pbar pb-water" id="waterBar" style="width:0%"></div></div>
      <div class="plabel"><span>0</span><span id="waterPct">0%</span><span>5000 ml</span></div>
      <div class="water-grid">
        <button class="water-btn" onclick="addWater(200)">+200<span>ml</span></button>
        <button class="water-btn" onclick="addWater(300)">+300<span>ml</span></button>
        <button class="water-btn" onclick="addWater(400)">+400<span>ml</span></button>
        <button class="water-btn" onclick="addWater(500)">+500<span>ml</span></button>
      </div>
      <button class="water-reset" onclick="resetWater()">â†º Reset Water</button>
    </div>

    <div class="nav-card" style="animation-delay:.14s" onclick="openPage('mealsPage')">
      <div class="nav-icon ni-meals">ğŸ½</div>
      <div class="nav-info">
        <div class="nav-title" id="navMealTitle">Today's Meals</div>
        <div class="nav-sub" id="navMealSub">Tap to view &amp; track your meals</div>
      </div>
      <div class="nav-arrow">â€º</div>
    </div>

    <div class="nav-card" style="animation-delay:.18s" onclick="openPage('maidaPage')">
      <div class="nav-icon ni-maida">ğŸ†</div>
      <div class="nav-info">
        <div class="nav-title">No Maida Days</div>
        <div class="nav-sub" id="maidaNavSub">Tap to mark &amp; view history</div>
      </div>
      <div style="font-family:var(--font-head);font-size:26px;font-weight:900;color:var(--gold);margin-right:8px;" id="maidaCntMain">0</div>
      <div class="nav-arrow">â€º</div>
    </div>

    <div class="nav-card" style="animation-delay:.22s" onclick="openPage('historyPage')">
      <div class="nav-icon ni-history">ğŸ“…</div>
      <div class="nav-info">
        <div class="nav-title">History</div>
        <div class="nav-sub" id="navHistSub">View past days &amp; your progress</div>
      </div>
      <div class="nav-arrow">â€º</div>
    </div>

  </div>
</div>

<div class="page" id="mealsPage">
  <div class="page-inner">
    <div class="page-hdr">
      <button class="back-btn" onclick="closePage('mealsPage')">â†</button>
      <div class="page-title" id="mealsPageTitle">Today's Meals</div>
    </div>
    <div class="page-scroll">
      <div class="pcontent">
        <div class="mini-cal">
          <div>
            <div class="mc-num" id="mp-cons">0</div>
            <div class="mc-lbl">kcal consumed</div>
          </div>
          <div style="text-align:right">
            <div class="mc-num" id="mp-rem" style="color:var(--accent2)">0</div>
            <div class="mc-lbl">remaining</div>
          </div>
        </div>
        
        <div class="sec-lbl">ğŸ½ Your Meal Plan</div>
        <div id="mealList" class="meal-list"></div>
        
        <div style="margin-top: 28px; margin-bottom: 24px;">
          <div class="sec-lbl">âš¡ Add Extra Food</div>
          <div class="import-hint" style="margin-bottom: 10px;">
            Search your database. Enter weight to auto-calculate!
          </div>
          <div class="quick-form">
            <input type="time" id="qTime"/>
            
            <div style="position:relative;">
              <input type="text" id="qName" placeholder="Search food (e.g. Paneer)" oninput="searchFood()" autocomplete="off"/>
              <div id="autocomplete-list" class="autocomplete-items"></div>
            </div>

            <div class="qf-row">
              <input type="number" id="qWeight" placeholder="Weight in Grams" oninput="calcCals()"/>
              <input type="number" id="qCal" class="readonly-input" placeholder="Total kcal" readonly/>
            </div>

            <button class="import-btn" style="margin-top:4px;" onclick="submitQuickMeal()">+ Add to Today's List</button>
          </div>
        </div>

        <button class="btn-main" id="saveBtn" onclick="saveToHistory()">
          ğŸ’¾ Save Today's Progress
        </button>
      </div>
    </div>
  </div>
</div>

<div class="page" id="maidaPage">
  <div class="page-inner">
    <div class="page-hdr">
      <button class="back-btn" onclick="closePage('maidaPage')">â†</button>
      <div class="page-title">No Maida Challenge</div>
    </div>
    <div class="page-scroll">
      <div class="pcontent">
        <div style="text-align:center;padding:40px 20px 30px;">
          <div style="font-size:80px;margin-bottom:10px;display:inline-block;animation:mPulse 3s ease-in-out infinite;">ğŸ†</div>
          <div class="cal-big" id="maidaCntPage" style="color:var(--gold);font-size:64px;display:block;">0</div>
          <div style="font-size:13px;color:var(--sub);margin-top:8px;letter-spacing:.5px;text-transform:uppercase;">Days of Clean Eating</div>
        </div>
        <button class="btn-mark" id="maidaBtn" onclick="markNoMaida()">âœ… Mark Today as No-Maida Day!</button>
        <div class="sec-lbl" style="margin-top:28px">Recent Milestones</div>
        <div class="chips" id="maidaChips"></div>
      </div>
    </div>
  </div>
</div>

<div class="page" id="historyPage">
  <div class="page-inner">
    <div class="page-hdr">
      <button class="back-btn" onclick="closePage('historyPage')">â†</button>
      <div class="page-title">History</div>
    </div>
    <div class="page-scroll">
      <div class="pcontent">
        <div id="historyList"></div>
      </div>
    </div>
  </div>
</div>

<div class="page" id="settingsPage">
  <div class="page-inner">
    <div class="page-hdr">
      <button class="back-btn" onclick="closePage('settingsPage')">â†</button>
      <div class="page-title">Settings & Tools</div>
    </div>
    <div class="page-scroll">
      <div class="pcontent">

        <div class="card" style="margin-bottom:14px">
          <div class="tog-row">
            <span class="tog-lbl" id="togLbl">ğŸŒ™ Night Mode</span>
            <button class="tog on" id="togBtn" onclick="toggleTheme()">
              <div class="tog-knob"></div>
            </button>
          </div>
        </div>

        <div class="import-box">
          <div class="import-tabs">
            <button class="imp-tab active" id="tab-plan" onclick="switchTab('plan')">Daily Plan</button>
            <button class="imp-tab" id="tab-db" onclick="switchTab('db')">Food DB</button>
          </div>

          <div id="panel-plan">
            <div class="import-hint">
              Paste your structured meal JSON array below.
            </div>
            <textarea id="importPlanArea" class="import-textarea"
              placeholder='[{ "time":"08:00 AM", "name":"Breakfast", "calories":320, "items":[{"food":"Oats","weight":"80g"}] }]'></textarea>
            <button class="import-btn" onclick="importPlanData()">â¬† Import Plan</button>
          </div>

          <div id="panel-db" style="display:none;">
            <div class="import-hint">
              Paste your custom foods. Use <code>n</code> for Name and <code>c</code> for Calories per 100g.<br>
            </div>
            <textarea id="importDbArea" class="import-textarea"
              placeholder='[{"n": "Raw Paneer", "c": 265}, {"n": "Chicken Breast", "c": 165}]'></textarea>
            <button class="import-btn" onclick="importFoodDB()">ğŸ’¾ Save Food Database</button>
            <div id="dbStatusText" style="margin-top:10px;font-size:12px;color:var(--sub);text-align:center;"></div>
          </div>
        </div>

        <div class="danger-card">
          <div class="danger-title">âš ï¸ Danger Zone</div>
          <button class="btn-danger" onclick="hardResetApp()">ğŸ’¥ Hard Reset â€” Delete All Data</button>
        </div>

      </div>
    </div>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   OFFLINE DETECTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateOnlineStatus(){
  const badge = document.getElementById('offlineBadge');
  badge.style.display = navigator.onLine ? 'none' : 'block';
}
window.addEventListener('online',  updateOnlineStatus);
window.addEventListener('offline', updateOnlineStatus);
updateOnlineStatus();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const ls    = (k,fb) => { try{const v=localStorage.getItem(k); return v!=null?JSON.parse(v):fb;}catch{return fb;} };
const lsSet = (k,v)  => { try{localStorage.setItem(k,JSON.stringify(v));}catch{} };
const todayKey  = () => new Date().toISOString().split("T")[0];
const DOW = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
const PALETTE = ['#FF4D6D','#00D4FF','#FF9F0A','#C77DFF','#00E5A0','#4D9EFF'];

function hexToRgb(h){
  const r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(h);
  return r?`${parseInt(r[1],16)},${parseInt(r[2],16)},${parseInt(r[3],16)}`:'108,99,255';
}
function parseTimeMins(val){
  if(!val) return 0;
  let c=val.toLowerCase().replace(/\s+/g,'');
  const pm=c.includes('pm'), am=c.includes('am');
  const m=c.match(/(\d+):(\d+)/);
  if(!m) return 0;
  let h=parseInt(m[1]), min=parseInt(m[2]);
  if(pm&&h!==12) h+=12; if(am&&h===12) h=0;
  return h*60+min;
}
function cleanInput(s){
  let c=s.trim();
  if(c.includes('=')) c=c.split('=').slice(1).join('=').trim();
  if(c.endsWith(';')) c=c.slice(0,-1);
  return c;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let _toastTimer;
function showToast(msg, color='var(--a-green)'){
  const el=document.getElementById('toast');
  el.textContent=msg; el.style.color=color;
  el.classList.add('show');
  clearTimeout(_toastTimer);
  _toastTimer=setTimeout(()=>el.classList.remove('show'),2800);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let dark       = ls("np_dark", true);
let streak     = ls("np_streak", 0);
let lastVis    = ls("np_lastvisit", "");
let weeklyPlan = ls("np_weeklyPlan", {});
let meals      = ls("np_meals", []);
let allChk     = ls("np_checked", {});
let allWater   = ls("np_water", {});
let noMaida    = ls("np_nomaida", []);
let history    = ls("np_history", {});
let foodDB     = ls("np_foodDB", []);

const getChk   = () => allChk[todayKey()] || {};
const getWater = () => allWater[todayKey()] || 0;
const setChk   = v => { allChk[todayKey()]=v; lsSet("np_checked",allChk); };
const setWater = v => { allWater[todayKey()]=v; lsSet("np_water",allWater); };

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STREAK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateStreak(){
  const t=new Date().toDateString();
  if(lastVis===t) return;
  const yest=new Date(); yest.setDate(yest.getDate()-1);
  streak = lastVis===yest.toDateString() ? streak+1 : 1;
  lastVis=t; lsSet("np_streak",streak); lsSet("np_lastvisit",lastVis);
}

let _lk=todayKey();
setInterval(()=>{
  if(todayKey()!==_lk){ _lk=todayKey(); loadDailyPlan(); renderHome(); }
},30000);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THEME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function applyTheme(){
  document.body.classList.toggle("light",!dark);
  const b=document.getElementById("togBtn"), l=document.getElementById("togLbl");
  b.classList.toggle("on",dark);
  l.textContent=dark?"ğŸŒ™ Night Mode":"â˜€ï¸ Day Mode";
}
function toggleTheme(){ dark=!dark; lsSet("np_dark",dark); applyTheme(); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openPage(id){
  document.getElementById(id).classList.add("active");
  if(id==="mealsPage"){  renderMeals(); setTimeout(scrollToNextMeal,350); }
  if(id==="historyPage")  renderHistory();
  if(id==="maidaPage")    renderNoMaida();
}
function closePage(id){ document.getElementById(id).classList.remove("active"); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TAB SWITCHING (SETTINGS)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function switchTab(tab){
  ['plan','db'].forEach(t => {
    document.getElementById(`tab-${t}`).classList.toggle('active', tab===t);
    document.getElementById(`panel-${t}`).style.display = (tab===t) ? 'block' : 'none';
  });
  if(tab==='db'){
    document.getElementById('dbStatusText').textContent = `Current DB Size: ${foodDB.length} items`;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HARD RESET APP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function hardResetApp(){
  if(confirm("ğŸ’¥ Delete ALL data forever? This cannot be undone.")){
    localStorage.clear();
    location.reload();
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FOOD DATABASE LOGIC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function importFoodDB(){
  const raw = document.getElementById('importDbArea').value.trim();
  if(!raw){ showToast("Paste database code first","var(--a-red)"); return; }
  try{
    const parsed = new Function("return "+cleanInput(raw))();
    if(!Array.isArray(parsed)){ showToast("âŒ Format must be an array","var(--a-red)"); return; }
    
    const valid = parsed.filter(i => i.n && i.c !== undefined);
    if(valid.length === 0){ showToast("âŒ Ensure objects have {n: 'Name', c: 100}","var(--a-red)"); return; }
    
    foodDB = valid; 
    lsSet("np_foodDB", foodDB);
    document.getElementById('importDbArea').value = '';
    document.getElementById('dbStatusText').textContent = `âœ… Success! DB Size: ${foodDB.length} items`;
    showToast(`âœ… Saved ${foodDB.length} foods!`);
  } catch(e) {
    showToast("âŒ JS Parse error","var(--a-red)");
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SMART QUICK ADD LOGIC (ON MEALS PAGE)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let currentCalPer100 = 0;

function searchFood() {
  const val = document.getElementById('qName').value.toLowerCase();
  const list = document.getElementById('autocomplete-list');
  list.innerHTML = '';
  
  if (!val) { list.style.display = 'none'; return; }

  let matches = foodDB.filter(f => f.n.toLowerCase().includes(val));
  
  matches.sort((a, b) => {
    const aStarts = a.n.toLowerCase().startsWith(val);
    const bStarts = b.n.toLowerCase().startsWith(val);
    if (aStarts && !bStarts) return -1;
    if (!aStarts && bStarts) return 1;
    return a.n.localeCompare(b.n);
  });

  if (matches.length === 0) { list.style.display = 'none'; return; }

  matches.forEach(match => {
    const card = document.createElement('div');
    card.className = 'ac-card';
    card.innerHTML = `
      <div class="ac-title">${match.n}</div>
      <div class="ac-cal">${match.c} kcal / 100g</div>
    `;
    card.onclick = () => selectFood(match.n, match.c);
    list.appendChild(card);
  });
  
  list.style.display = 'flex';
}

function selectFood(name, calPer100) {
  document.getElementById('qName').value = name;
  currentCalPer100 = calPer100;
  document.getElementById('autocomplete-list').style.display = 'none';
  calcCals();
  document.getElementById('qWeight').focus();
}

function calcCals() {
  const weightInput = document.getElementById('qWeight').value;
  const weight = parseFloat(weightInput) || 0;
  const calField = document.getElementById('qCal');
  
  if (currentCalPer100 > 0 && weight > 0) {
    const totalCals = Math.round((currentCalPer100 / 100) * weight);
    calField.value = totalCals;
  } else {
    calField.value = '';
  }
}

document.addEventListener("click", function (e) {
  if (e.target.id !== "qName") {
    document.getElementById("autocomplete-list").style.display = "none";
  }
});

function submitQuickMeal() {
  const name = document.getElementById('qName').value.trim();
  const weight = document.getElementById('qWeight').value.trim();
  const cal = parseInt(document.getElementById('qCal').value) || 0;
  const timeval = document.getElementById('qTime').value;

  if(!name){ showToast("Please select/enter a food","var(--a-red)"); return; }
  
  let timeLabel = "Now";
  if(timeval){
    const [hh,mm]=timeval.split(':');
    let h=parseInt(hh), ap=h>=12?'PM':'AM';
    if(h>12) h-=12; if(h===0) h=12;
    timeLabel=`${h}:${mm} ${ap}`;
  } else {
    const now=new Date();
    let h=now.getHours(), min=String(now.getMinutes()).padStart(2,'0'), ap=h>=12?'PM':'AM';
    if(h>12) h-=12; if(h===0) h=12;
    timeLabel=`${h}:${min} ${ap}`;
  }

  const meal = {
    id: Date.now(),
    timeLabel: timeLabel,
    name: name,
    calories: cal,
    items: [{ food: name, weight: weight ? weight + "g" : "â€”" }]
  };

  meals.push(meal);
  lsSet("np_meals", meals);
  
  document.getElementById('qName').value = '';
  document.getElementById('qWeight').value = '';
  document.getElementById('qCal').value = '';
  currentCalPer100 = 0;
  
  updateCalUI();
  updateDayHeaders();
  showToast(`âœ… Added ${name} to your plan!`);
  
  if(typeof confetti !== 'undefined') {
      confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
  }
  
  if(document.getElementById("mealsPage").classList.contains("active")) renderMeals();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   IMPORTER â€” WEEKLY / DAILY PLAN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function importPlanData(){
  const raw = document.getElementById('importPlanArea').value.trim();
  if(!raw){ showToast("Paste your plan code first","var(--a-red)"); return; }

  try{
    const parsed = new Function("return "+cleanInput(raw))();
    const today  = DOW[new Date().getDay()];
    let daily    = [];

    if(Array.isArray(parsed)){
      weeklyPlan[today] = parsed;
      lsSet("np_weeklyPlan", weeklyPlan);
      daily = parsed;
      showToast(`âœ… Plan set for ${today}!`);
    } else if(parsed && typeof parsed==='object'){
      const formatted={};
      for(let k in parsed){
        formatted[k.charAt(0).toUpperCase()+k.slice(1).toLowerCase()] = parsed[k];
      }
      weeklyPlan = formatted;
      lsSet("np_weeklyPlan", weeklyPlan);
      daily = weeklyPlan[today] || [];
      showToast("âœ… Full weekly plan imported!");
    } else {
      showToast("âŒ Unrecognised format","var(--a-red)"); return;
    }

    applyDailyPlanToMeals(daily);
    document.getElementById('importPlanArea').value='';
  } catch(e){
    showToast("âŒ JS parse error","var(--a-red)");
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PLAN HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function loadDailyPlan(){
  const d=DOW[new Date().getDay()];
  const daily=weeklyPlan[d]||[];
  if(daily.length>0) applyDailyPlanToMeals(daily);
}

function applyDailyPlanToMeals(arr){
  meals=arr.map((slot,i)=>({
    id: slot.id || Date.now()+i,
    timeLabel: slot.time || slot.timeLabel || "â€”",
    name: slot.name || slot.food || `Meal ${i+1}`,
    calories: parseInt(slot.calories)||0,
    items: slot.items || (slot.food?[{food:slot.food,weight:slot.weight||"â€”"}]:[])
  }));
  lsSet("np_meals",meals);
  updateCalUI();
  updateDayHeaders();
  if(document.getElementById("mealsPage").classList.contains("active")) renderMeals();
}

function updateDayHeaders(){
  const d=DOW[new Date().getDay()];
  const t=`${d}'s Meals`;
  const pt=document.getElementById("mealsPageTitle");
  const nt=document.getElementById("navMealTitle");
  if(pt) pt.textContent=t;
  if(nt) nt.textContent=t;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WATER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function addWater(ml){ setWater(Math.min(getWater()+ml,6000)); updateWaterUI(); }
function resetWater(){ setWater(0); updateWaterUI(); }
function updateWaterUI(){
  const w=getWater(), pct=Math.min(w/5000*100,100);
  document.getElementById("waterAmt").textContent=w+" ml";
  document.getElementById("waterBar").style.width=pct+"%";
  document.getElementById("waterPct").textContent=Math.round(pct)+"%";
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CALORIES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getConsumed(){
  const chk=getChk();
  return meals.filter(m=>chk[m.id]).reduce((s,m)=>s+Number(m.calories),0);
}
function updateCalUI(){
  const total=Math.max(meals.reduce((s,m)=>s+Number(m.calories),0),2200);
  const cons=getConsumed();
  const pct=Math.min(cons/total*100,100);
  document.getElementById("calConsumed").textContent=cons;
  document.getElementById("calRemain").textContent=total-cons;
  document.getElementById("calTotalLbl").textContent="of "+total+" kcal planned";
  document.getElementById("calGoalLabel").textContent=total+" kcal";
  document.getElementById("calBar").style.width=pct+"%";
  document.getElementById("calPct").textContent=Math.round(pct)+"%";
  const chkCnt=Object.keys(getChk()).filter(k=>getChk()[k]).length;
  document.getElementById("navMealSub").textContent=
    meals.length>0 ? `${chkCnt}/${meals.length} meals done Â· ${cons} kcal` : "No plan loaded yet";
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NO MAIDA & CONFETTI TRIGGERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function markNoMaida(){
  const key=todayKey();
  const lbl=new Date().toLocaleDateString("en-IN",{weekday:"short",day:"numeric",month:"short"});
  if(!noMaida.find(d=>d.date===key)){ noMaida.push({date:key,label:lbl}); lsSet("np_nomaida",noMaida); }
  renderNoMaida();
  
  if(typeof confetti !== 'undefined') {
      var count = 400;
      var defaults = { origin: { y: 0.7 }, colors: ['#ff0000', '#ff7f00', '#ffff00', '#00ff00', '#0000ff', '#4b0082', '#9400d3'] };
      function fire(particleRatio, opts) {
          confetti(Object.assign({}, defaults, opts, { particleCount: Math.floor(count * particleRatio) }));
      }
      fire(0.25, { spread: 26, startVelocity: 55 });
      fire(0.2, { spread: 60 });
      fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
      fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
      fire(0.1, { spread: 120, startVelocity: 45 });
  }
}

function renderNoMaida(){
  const key=todayKey(), cnt=noMaida.length, marked=!!noMaida.find(d=>d.date===key);
  const cp=document.getElementById("maidaCntPage");
  const cm=document.getElementById("maidaCntMain");
  if(cp) cp.textContent=cnt;
  if(cm) cm.textContent=cnt;
  const btn=document.getElementById("maidaBtn");
  if(btn){ btn.textContent=marked?"ğŸ‰ Today Marked! Keep Going!":"âœ… Mark Today as No-Maida Day!"; btn.classList.toggle("marked",marked); }
  const chips=document.getElementById("maidaChips");
  if(chips) chips.innerHTML=noMaida.slice(-12).map(d=>`<div class="chip">âœ… ${d.label}</div>`).join("");
  const nav=document.getElementById("maidaNavSub");
  if(nav) nav.textContent=cnt>0?`${cnt} clean day${cnt>1?'s':''} ğŸŒŸ`:"Tap to mark today!";
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOGGLE MEAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleMeal(id){
  const chk=getChk(); chk[id]=!chk[id]; setChk(chk);
  
  if(chk[id] && typeof confetti !== 'undefined') {
      confetti({ 
          particleCount: 150, 
          spread: 80, 
          origin: { y: 0.6 }, 
          colors: ['#00E5A0', '#4D9EFF', '#C77DFF', '#FFD700'],
          scalar: 1.2
      });
  }
  
  renderMeals(); updateCalUI();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER MEALS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderMeals(){
  const container=document.getElementById("mealList");
  if(!container) return;
  const chk=getChk();
  const d=DOW[new Date().getDay()];
  const now=new Date();
  const curMins=now.getHours()*60+now.getMinutes();

  if(!meals.length){
    container.innerHTML=`<div class="empty-state">
      <div class="empty-icon">ğŸ½</div>
      <div style="font-size:16px;font-weight:700;font-family:var(--font-head);margin-bottom:8px">No plan for ${d}</div>
      <div style="font-size:13px">Use the Quick Add tool below to start tracking!</div>
    </div>`;
    const mp1=document.getElementById("mp-cons"); if(mp1) mp1.textContent=0;
    const mp2=document.getElementById("mp-rem");  if(mp2) mp2.textContent=0;
    return;
  }

  let nextIdx=-1;
  meals.forEach((m,i)=>{
    const mm=parseTimeMins(m.timeLabel);
    if(nextIdx===-1 && mm>curMins && !chk[m.id]) nextIdx=i;
  });
  if(nextIdx===-1){
    meals.forEach((m,i)=>{ if(nextIdx===-1 && !chk[m.id]) nextIdx=i; });
  }

  container.innerHTML=meals.map((m,i)=>{
    const isDone=!!chk[m.id];
    const isNext=(i===nextIdx);
    const color=PALETTE[i%PALETTE.length];
    const rgb=hexToRgb(color);
    const valid=(m.items||[]).filter(x=>x.food&&x.food.trim());
    const itemsHtml=valid.length
      ? valid.map(x=>`<div class="ing-row">
          <div class="ing-left"><div class="ing-bullet" style="background:${color}"></div><span>${x.food}</span></div>
          <div class="ing-tag">${x.weight||'â€”'}</div>
        </div>`).join('')
      : `<div class="ing-row" style="justify-content:center;border:none"><span style="color:var(--sub);font-size:.8rem;font-style:italic">Activity Checkpoint</span></div>`;

    return `<div class="meal-card ${isDone?'checked':''} ${isNext?'highlight':''}"
         id="meal-card-${i}" style="--accent-color:${color};--accent-rgb:${rgb};animation-delay:${i*.05}s">
      <div class="next-badge">Next Up</div>
      <div class="mc-content">
        <div class="mc-top">
          <span class="mc-time">${m.timeLabel||'â€”'}</span>
          <span class="mc-cal">${m.calories||0} kcal</span>
        </div>
        <div class="mc-title">${m.name}</div>
        <div>${itemsHtml}</div>
      </div>
      <div class="mchk ${isDone?'on':''}" onclick="toggleMeal(${m.id})">âœ“</div>
    </div>`;
  }).join('');

  const cons=getConsumed();
  const total=Math.max(meals.reduce((s,m)=>s+Number(m.calories),0),2200);
  const mp1=document.getElementById("mp-cons"); if(mp1) mp1.textContent=cons;
  const mp2=document.getElementById("mp-rem");  if(mp2) mp2.textContent=total-cons;
}

function scrollToNextMeal(){
  const el=document.querySelector('.meal-card.highlight');
  if(el) el.scrollIntoView({behavior:'smooth',block:'center'});
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SAVE TO HISTORY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function saveToHistory(){
  const key=todayKey();
  history[key]={calories:getConsumed(),water:getWater(),savedAt:new Date().toISOString()};
  lsSet("np_history",history);
  showToast("âœ… Progress Saved!");
  updateNavSubs();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER HISTORY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderHistory(){
  const container=document.getElementById("historyList");
  const keys=Object.keys(history).sort((a,b)=>b.localeCompare(a));
  if(!keys.length){
    container.innerHTML=`<div class="h-empty">
      <div class="h-empty-icon">ğŸ“Š</div>
      <div style="font-size:18px;font-family:var(--font-head);font-weight:700;margin-bottom:8px">No history yet</div>
      <div style="font-size:13px">Track your meals then save progress to build your log</div>
    </div>`;
    return;
  }
  container.innerHTML=keys.map((key,idx)=>{
    const d=new Date(key);
    const lbl=d.toLocaleDateString("en-IN",{weekday:"long",day:"numeric",month:"long",year:"numeric"});
    const data=history[key], nm=!!noMaida.find(n=>n.date===key);
    const cp=Math.min((data.calories/2200)*100,100), wp=Math.min((data.water/5000)*100,100);
    return `<div class="h-card" style="animation-delay:${idx*.06}s">
      ${nm?'<div class="h-badge">ğŸ†</div>':""}
      <div class="h-date">${lbl}</div>
      <div class="h-grid">
        <div class="h-stat"><div class="h-sn" style="color:var(--accent)">${data.calories}</div><div class="h-sl">kcal eaten</div></div>
        <div class="h-stat"><div class="h-sn" style="color:var(--water)">${data.water}</div><div class="h-sl">ml water</div></div>
      </div>
      <div style="margin-bottom:10px">
        <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--sub);margin-bottom:5px">
          <span>ğŸ”¥ Calories</span><span>${Math.round(cp)}%</span></div>
        <div class="pbar-wrap" style="height:8px"><div class="pbar pb-cal" style="width:${cp}%"></div></div>
      </div>
      <div>
        <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--sub);margin-bottom:5px">
          <span>ğŸ’§ Hydration</span><span>${Math.round(wp)}%</span></div>
        <div class="pbar-wrap" style="height:8px"><div class="pbar pb-water" style="width:${wp}%"></div></div>
      </div>
      ${nm?'<div style="margin-top:12px;background:#FFD70011;border:1px solid #FFD70033;border-radius:10px;padding:8px;font-size:12px;color:var(--gold);font-weight:600;text-align:center">ğŸ† No Maida Day!</div>':""}
    </div>`;
  }).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATE + NAV SUBS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateDate(){
  document.getElementById("hdrDate").textContent=
    new Date().toLocaleDateString("en-IN",{weekday:"long",day:"numeric",month:"long"});
}
function updateNavSubs(){
  const hCnt=Object.keys(history).length;
  if(hCnt>0) document.getElementById("navHistSub").textContent=`${hCnt} day${hCnt>1?"s":""} logged`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER HOME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderHome(){
  updateDate();
  updateDayHeaders();
  document.getElementById("streakNum").textContent=streak;
  applyTheme();
  updateCalUI();
  updateWaterUI();
  renderNoMaida();
  updateNavSubs();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
updateStreak();
loadDailyPlan();
renderHome();
</script>
</body>
</html>