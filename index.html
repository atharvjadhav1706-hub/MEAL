<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>NutriPulse</title>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<style>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê VARIABLES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
:root {
  --bg:#0C0C14; --surface:#13131F; --card:#1A1A2E; --card2:#1E1E32;
  --border:#2A2A45; --text:#EEEEff; --sub:#7777AA;
  --accent:#6C63FF; --accent2:#FF6584; --gold:#FFD700; --water:#29B6F6;
  
  --bg2: #0a0a0f; --surface-imp: rgba(255,255,255,0.03);
  --border-imp: rgba(255,255,255,0.07); --border-bright: rgba(255,255,255,0.14);
  --text-sec: rgba(240,240,248,0.45); --a-green: #00E5A0; --a-red: #FF4D6D;

  --font-head:'Playfair Display',serif; --font-body:'Plus Jakarta Sans',sans-serif;
  --r:22px;
}
.light{
  --bg:#F0F0FA; --surface:#FFFFFF; --card:#E8E8F8; --card2:#DDDDF0;
  --border:#C8C8E8; --text:#1A1A35; --sub:#6666AA;
  --bg2: #F8F8FC; --surface-imp: #FFFFFF; --border-imp: #C8C8E8; --border-bright: #A0A0C0; --text-sec: #6666AA;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
html{scroll-behavior:smooth;}
body{font-family:var(--font-body);background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;transition:background .4s,color .4s;}

/* ‚îÄ‚îÄ ORB BACKGROUND ‚îÄ‚îÄ */
.orb{position:fixed;border-radius:50%;filter:blur(90px);pointer-events:none;z-index:0;animation:drift 14s ease-in-out infinite alternate;}
.o1{width:320px;height:320px;background:radial-gradient(#6C63FF2E,transparent);top:-90px;left:-90px;}
.o2{width:260px;height:260px;background:radial-gradient(#FF65842E,transparent);bottom:80px;right:-70px;animation-delay:-7s;}
.o3{width:180px;height:180px;background:radial-gradient(#43E97B1A,transparent);top:45%;left:35%;animation-delay:-3s;}
@keyframes drift{0%{transform:translate(0,0) scale(1);}100%{transform:translate(28px,18px) scale(1.12);}}

/* ‚îÄ‚îÄ TOAST NOTIFICATION ‚îÄ‚îÄ */
#toastMsg {
  position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
  background: rgba(20,20,25,0.95); padding: 12px 22px; border-radius: 40px;
  border: 1px solid var(--border-bright); color: var(--text);
  font-size: 0.88rem; font-weight: bold; display: none; z-index: 10000;
  box-shadow: 0 4px 20px rgba(0,0,0,0.5); font-family: var(--font-body);
}

/* ‚îÄ‚îÄ PAGE SYSTEM ‚îÄ‚îÄ */
#home{position:relative;z-index:1;max-width:440px;margin:0 auto;min-height:100vh;padding-bottom:90px;}
.page{
  position:fixed;inset:0;z-index:100;background:var(--bg);
  transform:translateX(100%);transition:transform .38s cubic-bezier(.4,0,.2,1);
  display:flex;flex-direction:column;overflow:hidden;
}
.page.active{transform:translateX(0);}
.page-inner{max-width:440px;margin:0 auto;width:100%;display:flex;flex-direction:column;height:100%;}
.page-scroll{flex:1;overflow-y:auto;padding-bottom:40px;}
.page-scroll::-webkit-scrollbar{width:3px;}
.page-scroll::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px;}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.hdr{position:sticky;top:0;z-index:200;background:var(--bg);padding:18px 20px 14px;backdrop-filter:blur(12px);}
.hdr-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;}
.logo{font-family:var(--font-head);font-size:27px;font-weight:900;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.logo-date{font-size:11px;color:var(--sub);letter-spacing:.5px;margin-top:-2px;}
.hdr-right{display:flex;gap:10px;align-items:center;}

.streak-pill{display:flex;align-items:center;gap:7px;background:linear-gradient(135deg,#6C63FF22,#FF658422);border:1px solid #6C63FF44;border-radius:16px;padding:7px 14px;}
.s-fire{font-size:22px;animation:fireA 1.6s ease-in-out infinite;}
@keyframes fireA{0%,100%{transform:scale(1) rotate(-3deg);}50%{transform:scale(1.18) rotate(3deg);}}
.s-num{font-family:var(--font-head);font-size:21px;font-weight:900;color:var(--accent);line-height:1;}
.s-lbl{font-size:9px;color:var(--sub);text-transform:uppercase;letter-spacing:1px;}

.icon-btn{width:42px;height:42px;background:var(--card);border:1px solid var(--border);border-radius:14px;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .22s;color:var(--text);}
.icon-btn:hover{transform:scale(1.08);border-color:var(--accent);}

/* ‚îÄ‚îÄ GENERAL BUTTONS & TOGGLES ‚îÄ‚îÄ */
.tog-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:20px;border-bottom:1px solid var(--border);}
.tog-lbl{font-size:14px;font-weight:500;}
.tog{width:54px;height:30px;border-radius:15px;background:var(--border);cursor:pointer;position:relative;transition:background .3s;border:none;}
.tog.on{background:linear-gradient(135deg,var(--accent),var(--accent2));}
.tog-knob{position:absolute;top:4px;left:4px;width:22px;height:22px;border-radius:50%;background:#fff;transition:left .3s;box-shadow:0 2px 6px #0005;}
.tog.on .tog-knob{left:28px;}
.fsec{font-size:11px;font-weight:700;color:var(--accent);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:11px;}
.fgrp{display:flex;flex-direction:column;gap:8px;margin-bottom:14px;}
.btn{width:100%;padding:13px;border:none;border-radius:14px;font-family:var(--font-body);font-weight:700;font-size:14px;cursor:pointer;color:#fff;transition:all .25s;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:0 4px 15px #6C63FF33;}
.btn:hover{transform:translateY(-2px);box-shadow:0 8px 24px #6C63FF55;}
.btn3{background:transparent;border:1px solid var(--sub);color:var(--text);box-shadow:none;}
.btn3:hover{background:var(--border);transform:translateY(0);}
.btn-danger{border-color:#FF3B30;color:#FF3B30;}
.btn-danger:hover{background:#FF3B3015;color:#FF3B30;}

/* ‚îÄ‚îÄ MODAL IMPORTER STYLES ‚îÄ‚îÄ */
.modal-box { background: var(--bg2); padding: 30px 20px; width: 100%; border-radius: 28px; border: 1px solid var(--border-imp); margin-bottom: 14px; }
.modal-box h3 { font-size: 1.1rem; margin-bottom: 8px; font-family: var(--font-body); font-weight: 700; color: var(--text); }
.modal-box p { font-size: 0.8rem; color: var(--text-sec); margin-bottom: 12px; line-height: 1.4; }
.import-textarea { width: 100%; height: 100px; padding: 16px; background: var(--surface-imp); border: 1px solid var(--border-imp); color: var(--a-green); border-radius: 14px; margin-bottom: 12px; font-family: monospace; font-size: 0.8rem; resize: none; box-sizing: border-box; transition: border-color 0.2s; outline: none; }
.import-textarea:focus { border-color: var(--border-bright); outline: none; }
.import-btn { width: 100%; padding: 14px; background: transparent; border: 1px solid var(--border-imp); color: var(--text-sec); font-weight: bold; font-size: 0.9rem; border-radius: 16px; cursor: pointer; transition: all 0.2s; margin-bottom: 10px; }
.import-btn:hover { border-color: var(--border-bright); color: var(--text); }
.import-btn:active { transform: scale(0.98); }
.section-divider { border: none; border-top: 1px solid var(--border-imp); margin: 20px 0 24px 0; }

/* ‚îÄ‚îÄ HOME CONTENT ‚îÄ‚îÄ */
.content{padding:0 20px;}
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:20px;margin-bottom:14px;position:relative;overflow:hidden;animation:fadeUp .4s ease both;}
.card::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,#6C63FF06,transparent 60%);pointer-events:none;}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px);}to{opacity:1;transform:translateY(0);}}

/* ‚îÄ‚îÄ CALORIE CARD ‚îÄ‚îÄ */
.cal-row{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px;}
.cal-big{font-family:var(--font-head);font-size:46px;font-weight:900;color:var(--accent);line-height:1;}
.cal-unit{font-size:12px;color:var(--sub);margin-top:4px;}
.cal-right{text-align:right;}
.cal-rem{font-family:var(--font-head);font-size:24px;font-weight:700;color:var(--accent2);}
.cal-rlbl{font-size:11px;color:var(--sub);}
.pbar-wrap{height:12px;background:var(--border);border-radius:12px;overflow:hidden;margin-bottom:6px;}
.pbar{height:100%;border-radius:12px;transition:width .8s cubic-bezier(.4,0,.2,1);position:relative;}
.pbar::after{content:'';position:absolute;right:0;top:0;height:100%;width:30px;background:linear-gradient(90deg,transparent,#ffffff2A);animation:shim 2s linear infinite;}
@keyframes shim{0%{opacity:0;}50%{opacity:1;}100%{opacity:0;}}
.pb-cal{background:linear-gradient(90deg,var(--accent),var(--accent2));box-shadow:0 0 12px #6C63FF55;}
.pb-water{background:linear-gradient(90deg,#29B6F6,#0288D1);box-shadow:0 0 12px #29B6F655;}
.plabel{display:flex;justify-content:space-between;font-size:11px;color:var(--sub);}

/* ‚îÄ‚îÄ WATER CARD ‚îÄ‚îÄ */
.water-big{font-family:var(--font-head);font-size:36px;font-weight:900;color:var(--water);}
.water-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:14px;}
.water-btn{background:linear-gradient(135deg,#29B6F622,#0288D122);border:1px solid #29B6F644;border-radius:14px;padding:12px 4px;color:var(--water);font-family:var(--font-head);font-weight:700;font-size:15px;cursor:pointer;transition:all .22s;text-align:center;}
.water-btn span{display:block;font-size:10px;font-family:var(--font-body);font-weight:400;opacity:.7;}
.water-btn:hover{transform:translateY(-3px) scale(1.05);box-shadow:0 6px 18px #29B6F644;}
.water-btn:active{transform:scale(.95);}
.water-reset{margin-top:8px;width:100%;background:transparent;border:1px solid var(--border);border-radius:10px;padding:7px;color:var(--sub);font-family:var(--font-body);font-size:12px;cursor:pointer;transition:all .2s;}
.water-reset:hover{border-color:var(--accent2);color:var(--accent2);}

/* ‚îÄ‚îÄ NO MAIDA STYLES ‚îÄ‚îÄ */
.btn-mark{width:100%;padding:14px;border-radius:16px;border:1.5px solid #FFD70044;cursor:pointer;font-family:var(--font-head);font-size:15px;font-weight:700;background:linear-gradient(135deg,#FFD70018,#FFA50018);color:var(--gold);transition:all .28s;}
.btn-mark:hover{background:linear-gradient(135deg,#FFD70030,#FFA50030);transform:translateY(-2px);box-shadow:0 6px 20px #FFD70033;}
.btn-mark.marked{border-color:var(--gold);}
.chips{display:flex;flex-wrap:wrap;gap:6px;margin-top:12px;}
.chip{background:#FFD70011;border:1px solid #FFD70044;border-radius:10px;padding:5px 10px;font-size:11px;color:var(--gold);font-weight:600;}

/* ‚îÄ‚îÄ NAVIGATION CARDS ‚îÄ‚îÄ */
.nav-card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:18px 20px;margin-bottom:14px;display:flex;align-items:center;gap:16px;cursor:pointer;transition:all .26s;animation:fadeUp .4s ease both;position:relative;overflow:hidden;}
.nav-card::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,#6C63FF06,transparent 60%);pointer-events:none;}
.nav-card:hover{transform:translateY(-3px);border-color:var(--accent);box-shadow:0 8px 28px #6C63FF22;}
.nav-card:active{transform:scale(.98);}
.nav-icon{width:52px;height:52px;border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:26px;flex-shrink:0;}
.ni-meals{background:linear-gradient(135deg,var(--accent),var(--accent2));}
.ni-history{background:linear-gradient(135deg,var(--gold),#FF8E53);}
.ni-maida{background:linear-gradient(135deg,#FFD700,#FFA500);}
.nav-info{flex:1;}
.nav-title{font-family:var(--font-head);font-size:17px;font-weight:700;margin-bottom:2px;}
.nav-sub{font-size:12px;color:var(--sub);}
.nav-arrow{font-size:22px;color:var(--sub);transition:transform .22s;}
.nav-card:hover .nav-arrow{transform:translateX(5px);color:var(--accent);}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SUB-PAGE SHARED ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.page-hdr{display:flex;align-items:center;gap:14px;padding:18px 20px 14px;position:sticky;top:0;z-index:50;background:var(--bg);backdrop-filter:blur(12px);}
.back-btn{width:40px;height:40px;background:var(--card);border:1px solid var(--border);border-radius:13px;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .22s;color:var(--text);flex-shrink:0;}
.back-btn:hover{border-color:var(--accent);transform:scale(1.06);}
.page-title{font-family:var(--font-head);font-size:22px;font-weight:900;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.pcontent{padding:0 20px 40px;}
.sec-lbl{font-family:var(--font-head);font-size:15px;font-weight:700;margin-bottom:10px;display:flex;align-items:center;gap:8px;}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HISTORY PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.h-card{background:var(--card2);border:1px solid var(--border);border-radius:20px;padding:18px;margin-bottom:12px;position:relative;overflow:hidden;animation:fadeUp .4s ease both;}
.h-card::before{content:'';position:absolute;top:-40px;right:-40px;width:110px;height:110px;border-radius:50%;background:radial-gradient(#6C63FF11,transparent);pointer-events:none;}
.h-date{font-family:var(--font-head);font-size:15px;font-weight:700;}
.h-day{font-size:11px;color:var(--sub);margin-bottom:14px;margin-top:2px;}
.h-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px;}
.h-stat{background:var(--card);border-radius:14px;padding:12px;border:1px solid var(--border);}
.h-sn{font-family:var(--font-head);font-size:26px;font-weight:900;}
.h-sl{font-size:10px;color:var(--sub);text-transform:uppercase;letter-spacing:1px;margin-top:2px;}
.h-badge{position:absolute;top:14px;right:14px;font-size:22px;}
.h-empty{text-align:center;padding:60px 20px;color:var(--sub);}
.h-empty-icon{font-size:54px;margin-bottom:14px;}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NEW MEALS PAGE UI ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.mini-cal{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:14px 18px;margin-bottom:16px;display:flex;justify-content:space-between;align-items:center;}
.mc-num{font-family:var(--font-head);font-size:28px;font-weight:900;color:var(--accent);}
.mc-lbl{font-size:11px;color:var(--sub);}
.meal-list { display: flex; flex-direction: column; gap: 14px; }

.meal-card {
  background: var(--card2);
  border: 1px solid var(--border);
  border-radius: 20px;
  position: relative;
  overflow: hidden;
  padding-left: 4px;
  transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  animation: fadeUp .4s ease both;
}
.meal-card::before {
  content: ''; position: absolute; left: 0; top: 0; bottom: 0;
  width: 4px; background: var(--accent-color, var(--border));
  border-radius: 4px 0 0 4px;
}
.meal-card:hover { border-color: var(--border-bright); transform: translateY(-2px); }
.meal-card.checked { opacity: 0.4; filter: grayscale(0.8); }

@keyframes pulseRing { 
  0%, 100% { box-shadow: 0 0 0 0 rgba(255,255,255,0.2); } 
  50% { box-shadow: 0 0 0 6px rgba(255,255,255,0); } 
}
.meal-card.highlight {
  border: 1px solid var(--accent-color) !important;
  box-shadow: 0 0 0 1px var(--accent-color), 0 8px 32px rgba(var(--accent-rgb), 0.15) !important;
  animation: pulseRing 2.5s ease-in-out infinite;
}

.next-badge {
  display: none; position: absolute; top: 0; right: 60px;
  background: var(--accent-color); color: #000; font-size: 0.55rem;
  font-weight: 900; padding: 5px 12px; border-bottom-left-radius: 10px;
  border-bottom-right-radius: 10px; text-transform: uppercase; letter-spacing: 1px; z-index: 10;
}
.meal-card.highlight .next-badge { display: block; }

.mc-content { padding: 18px; position: relative; }
.mc-top { display: flex; align-items: center; margin-bottom: 8px; gap: 10px; padding-right: 44px; }
.mc-time { color: var(--accent-color); font-weight: 700; font-size: 0.78rem; text-transform: uppercase; letter-spacing: 1px; flex-shrink: 0; }
.mc-cal { background: rgba(128,128,128,0.08); color: var(--text-sec); padding: 4px 10px; border-radius: 8px; font-weight: 600; font-size: 0.7rem; border: 1px solid var(--border); flex-shrink: 0; }
.mc-title { font-size: 1.25rem; font-weight: 700; color: var(--text); margin-bottom: 14px; letter-spacing: -0.3px; line-height: 1.3; padding-right: 40px;}

.ing-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid var(--border); gap: 10px; }
.ing-row:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
.ing-left { display: flex; align-items: center; color: var(--text-sec); font-size: 0.9rem; flex: 1; }
.ing-bullet { width: 5px; height: 5px; border-radius: 50%; background: var(--accent-color); margin-right: 10px; opacity: 0.7; }
.ing-tag { background: var(--surface); font-weight: 600; font-size: 0.75rem; padding: 4px 10px; border-radius: 8px; border: 1px solid var(--border); color: var(--sub); }

.mchk {
  position: absolute; top: 16px; right: 16px;
  width: 34px; height: 34px; border-radius: 50%; border: 1.5px solid var(--border); background: var(--surface);
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); font-size: 1rem; color: transparent; user-select: none; z-index: 20;
}
.mchk:active { transform: scale(0.85); }
.mchk.on { background: var(--a-green); border-color: var(--a-green); color: #000; box-shadow: 0 0 16px rgba(0,229,160,0.4); }

</style>
</head>
<body>

<div id="toastMsg"></div>

<div class="orb o1"></div>
<div class="orb o2"></div>
<div class="orb o3"></div>

<div id="home">
  <div class="hdr">
    <div class="hdr-top">
      <div>
        <div class="logo">NutriPulse</div>
        <div class="logo-date" id="hdrDate"></div>
      </div>
      <div class="hdr-right">
        <div class="streak-pill">
          <span class="s-fire">üî•</span>
          <div>
            <div class="s-num" id="streakNum">0</div>
            <div class="s-lbl">streak</div>
          </div>
        </div>
        <button class="icon-btn" onclick="openPage('settingsPage')">‚öôÔ∏è</button>
      </div>
    </div>
  </div>

  <div class="content">

    <div class="card" style="animation-delay:.05s">
      <div class="cal-row">
        <div>
          <div class="cal-big" id="calConsumed">0</div>
          <div class="cal-unit">kcal consumed today</div>
        </div>
        <div class="cal-right">
          <div class="cal-rem" id="calRemain">0</div>
          <div class="cal-rlbl">remaining</div>
          <div class="cal-rlbl" id="calTotalLbl" style="margin-top:4px;font-size:10px"></div>
        </div>
      </div>
      <div class="pbar-wrap"><div class="pbar pb-cal" id="calBar" style="width:0%"></div></div>
      <div class="plabel"><span>0</span><span id="calPct">0%</span><span id="calGoalLabel">2200 kcal goal</span></div>
    </div>

    <div class="card" style="animation-delay:.1s">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <div class="sec-lbl" style="margin-bottom:0">üíß Hydration</div>
        <div style="font-size:12px;color:var(--sub)">Goal 5000 ml</div>
      </div>
      <div class="water-big" id="waterAmt">0 ml</div>
      <div class="pbar-wrap" style="margin:10px 0 6px"><div class="pbar pb-water" id="waterBar" style="width:0%"></div></div>
      <div class="plabel"><span>0</span><span id="waterPct">0%</span><span>5000 ml</span></div>
      <div class="water-grid">
        <button class="water-btn" onclick="addWater(200)">+200<span>ml</span></button>
        <button class="water-btn" onclick="addWater(300)">+300<span>ml</span></button>
        <button class="water-btn" onclick="addWater(400)">+400<span>ml</span></button>
        <button class="water-btn" onclick="addWater(500)">+500<span>ml</span></button>
      </div>
      <button class="water-reset" onclick="resetWater()">‚Ü∫ Reset Water</button>
    </div>

    <div class="nav-card" style="animation-delay:.15s" onclick="openPage('mealsPage')">
      <div class="nav-icon ni-meals">üçΩ</div>
      <div class="nav-info">
        <div class="nav-title" id="navMealTitle">Today's Meals</div>
        <div class="nav-sub" id="navMealSub">Tap to view &amp; track your meals</div>
      </div>
      <div class="nav-arrow">‚Ä∫</div>
    </div>

    <div class="nav-card" style="animation-delay:.2s" onclick="openPage('maidaPage')">
      <div class="nav-icon ni-maida">üèÜ</div>
      <div class="nav-info">
        <div class="nav-title">No Maida Days</div>
        <div class="nav-sub">Tap to mark &amp; view history</div>
      </div>
      <div style="font-family:var(--font-head);font-size:26px;font-weight:900;color:var(--gold);margin-right:8px;" id="maidaCntMain">0</div>
      <div class="nav-arrow">‚Ä∫</div>
    </div>

    <div class="nav-card" style="animation-delay:.25s" onclick="openPage('historyPage')">
      <div class="nav-icon ni-history">üìÖ</div>
      <div class="nav-info">
        <div class="nav-title">History</div>
        <div class="nav-sub" id="navHistSub">View past days &amp; your progress</div>
      </div>
      <div class="nav-arrow">‚Ä∫</div>
    </div>

  </div>
</div>

<div class="page" id="mealsPage">
  <div class="page-inner">
    <div class="page-hdr">
      <button class="back-btn" onclick="closePage('mealsPage')">‚Üê</button>
      <div class="page-title" id="mealsPageTitle">Today's Meals</div> 
    </div>
    <div class="page-scroll">
      <div class="pcontent">
        <div class="mini-cal">
          <div>
            <div class="mc-num" id="mp-cons">0</div>
            <div class="mc-lbl">kcal consumed</div>
          </div>
          <div style="text-align:right">
            <div class="mc-num" id="mp-rem" style="color:var(--accent2)">0</div>
            <div class="mc-lbl">remaining</div>
          </div>
        </div>
        <div class="sec-lbl">üçΩ Your Meal Plan</div>
        <div id="mealList" class="meal-list"></div>
        <button class="btn" style="margin-top:14px" id="saveBtn" onclick="saveToHistory()">üíæ Save Today's Progress</button>
      </div>
    </div>
  </div>
</div>

<div class="page" id="maidaPage">
  <div class="page-inner">
    <div class="page-hdr">
      <button class="back-btn" onclick="closePage('maidaPage')">‚Üê</button>
      <div class="page-title">No Maida Challenge</div>
    </div>
    <div class="page-scroll">
      <div class="pcontent">
        <div style="text-align:center; padding: 40px 20px;">
          <div style="font-size:80px; margin-bottom:10px; animation: mPulse 3s infinite;">üèÜ</div>
          <div class="cal-big" id="maidaCntPage" style="color:var(--gold); font-size:60px;">0</div>
          <div class="sec-lbl" style="justify-content:center; margin-top:10px; color:var(--sub)">Days of Clean Eating</div>
        </div>
        <button class="btn-mark" id="maidaBtn" onclick="markNoMaida()">‚úÖ Mark Today as No-Maida Day!</button>
        <div class="sec-lbl" style="margin-top:30px">Recent Milestones</div>
        <div class="chips" id="maidaChips"></div>
      </div>
    </div>
  </div>
</div>

<div class="page" id="historyPage">
  <div class="page-inner">
    <div class="page-hdr">
      <button class="back-btn" onclick="closePage('historyPage')">‚Üê</button>
      <div class="page-title">History</div>
    </div>
    <div class="page-scroll">
      <div class="pcontent">
        <div id="historyList"></div>
      </div>
    </div>
  </div>
</div>

<div class="page" id="settingsPage">
  <div class="page-inner">
    <div class="page-hdr">
      <button class="back-btn" onclick="closePage('settingsPage')">‚Üê</button>
      <div class="page-title">Settings & Data</div>
    </div>
    <div class="page-scroll">
      <div class="pcontent">
        
        <div class="card">
          <div class="tog-row" style="margin-bottom:0; padding-bottom:0; border:none;">
            <span class="tog-lbl" id="togLbl">üåô Night Mode</span>
            <button class="tog on" id="togBtn" onclick="toggleTheme()">
              <div class="tog-knob"></div>
            </button>
          </div>
        </div>

        <div class="modal-box">
          <h3>Import Meal Plans</h3>
          <p>Paste a Weekly Object or Daily Array structure below:</p>
          <textarea id="importPlanArea" class="import-textarea" placeholder='{ "Monday": [...], "Tuesday": [...] } OR [...]'></textarea>
          <button class="import-btn" onclick="importPlanData()">Import Plan</button>

          <hr class="section-divider">

          <h3>Import Food Database</h3>
          <p>Paste an array of custom foods with their calories:</p>
          <textarea id="importCustomArea" class="import-textarea" placeholder='[{"n": "Apple", "c": 95}, {"n": "Whey Protein", "c": 120}]'></textarea>
          <button class="import-btn" style="margin-bottom:0;" onclick="importCustomData()">Save to Database</button>
        </div>

        <div class="card" style="border-color: #FF3B3044; background: linear-gradient(135deg, #FF3B3008, transparent);">
          <div class="fsec" style="color:#FF3B30">‚ö†Ô∏è Danger Zone</div>
          <div class="fgrp">
            <button class="btn btn3" onclick="clearAllMeals()">üóëÔ∏è Clear Current Plan</button>
            <button class="btn btn3 btn-danger" onclick="hardResetApp()">üí• Hard Reset All App Data</button>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<script>
/* ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ */
const ls    = (k,fb) => { try{const v=localStorage.getItem(k);return v!=null?JSON.parse(v):fb;}catch{return fb;} };
const lsSet = (k,v)  => { try{localStorage.setItem(k,JSON.stringify(v));}catch{} };
const todayKey = () => new Date().toISOString().split("T")[0];
const daysOfWeek = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
const colorPalette = ['#FF4D6D', '#00D4FF', '#FF9F0A', '#C77DFF', '#00E5A0', '#4D9EFF'];

/* ‚îÄ‚îÄ STATE ‚îÄ‚îÄ */
let dark     = ls("np_dark",true);
let streak   = ls("np_streak",0);
let lastVis  = ls("np_lastvisit","");

let foodDB     = ls("np_foodDB", []);
let weeklyPlan = ls("np_weeklyPlan", {});
let meals      = ls("np_meals", []); 

let allChk   = ls("np_checked",{});
let allWater = ls("np_water",{});
let noMaida  = ls("np_nomaida",[]);
let history  = ls("np_history",{});

const getChk   = () => allChk[todayKey()] || {};
const getWater = () => allWater[todayKey()] || 0;
const setChk   = v => { allChk[todayKey()]=v;   lsSet("np_checked",allChk); };
const setWater = v => { allWater[todayKey()]=v;  lsSet("np_water",allWater); };

/* ‚îÄ‚îÄ STREAK ‚îÄ‚îÄ */
function updateStreak(){
  const t = new Date().toDateString();
  if(lastVis===t) return;
  const yest=new Date(); yest.setDate(yest.getDate()-1);
  streak = lastVis===yest.toDateString() ? streak+1 : 1;
  lastVis=t; lsSet("np_streak",streak); lsSet("np_lastvisit",lastVis);
}

/* ‚îÄ‚îÄ MIDNIGHT RESET ‚îÄ‚îÄ */
let _lk=todayKey();
setInterval(()=>{ 
  if(todayKey()!==_lk){
    _lk=todayKey();
    loadDailyPlan(); 
    renderHome();
  } 
},30000);

/* ‚îÄ‚îÄ UI TOGGLES ‚îÄ‚îÄ */
function applyTheme(){
  document.body.classList.toggle("light",!dark);
  const b=document.getElementById("togBtn"),l=document.getElementById("togLbl");
  b.classList.toggle("on",dark);
  l.textContent=dark?"üåô Night Mode":"‚òÄÔ∏è Day Mode";
}
function toggleTheme(){ dark=!dark; lsSet("np_dark",dark); applyTheme(); }

/* ‚îÄ‚îÄ PAGE NAVIGATION ‚îÄ‚îÄ */
function openPage(id){
  document.getElementById(id).classList.add("active");
  if(id==="mealsPage") {
    renderMeals();
    setTimeout(scrollToNextMeal, 350); 
  }
  if(id==="historyPage") renderHistory();
}
function closePage(id){ document.getElementById(id).classList.remove("active"); }

/* ‚îÄ‚îÄ HARD RESET ‚îÄ‚îÄ */
function hardResetApp() {
  if(confirm("üö® WARNING: This will delete ALL your saved meals, water tracking, history, and streaks permanently. Are you absolutely sure?")) {
    localStorage.clear();
    location.reload();
  }
}

/* ‚îÄ‚îÄ TOAST NOTIFICATION ‚îÄ‚îÄ */
function showToast(msg, color = "var(--a-green)") {
  let toast = document.getElementById('toastMsg');
  toast.style.color = color;
  toast.innerText = msg;
  toast.style.display = 'block';
  setTimeout(() => { toast.style.display = 'none'; }, 3000);
}

/* ‚îÄ‚îÄ STRING CLEANER ‚îÄ‚îÄ */
function cleanInputString(input) {
  let clean = input.trim();
  if (clean.includes('=')) clean = clean.split('=').slice(1).join('=').trim();
  if (clean.endsWith(';')) clean = clean.slice(0, -1);
  return clean;
}

function parseTimeMins(val) {
  if (!val) return 0;
  let clean = val.toLowerCase().replace(/\s+/g, '');
  let isPM = clean.includes('pm'), isAM = clean.includes('am');
  let m = clean.match(/(\d+):(\d+)/);
  if (!m) return 0;
  let h = parseInt(m[1]), min = parseInt(m[2]);
  if (isPM && h !== 12) h += 12;
  if (isAM && h === 12) h = 0;
  return h * 60 + min;
}

function hexToRgb(hex) {
  let r = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return r ? `${parseInt(r[1], 16)}, ${parseInt(r[2], 16)}, ${parseInt(r[3], 16)}` : '255,255,255';
}

/* ‚îÄ‚îÄ IMPORTER 1: MEAL PLANS ‚îÄ‚îÄ */
function importPlanData() {
  let input = document.getElementById('importPlanArea').value;
  if (!input.trim()) { showToast("Paste code first", "var(--a-red)"); return; }
  
  let d = daysOfWeek[new Date().getDay()]; 

  try {
    let clean = cleanInputString(input);
    let newData = new Function("return " + clean)();
    let newDaily = [];

    if (Array.isArray(newData)) {
      weeklyPlan[d] = newData; 
      lsSet("np_weeklyPlan", weeklyPlan);
      newDaily = newData;
      showToast(`‚úÖ Plan set for ${d}!`);

    } else if (typeof newData === 'object') {
      const formattedWeeklyPlan = {};
      for(let key in newData) {
        let capKey = key.charAt(0).toUpperCase() + key.slice(1).toLowerCase();
        formattedWeeklyPlan[capKey] = newData[key];
      }
      
      weeklyPlan = formattedWeeklyPlan; 
      lsSet("np_weeklyPlan", weeklyPlan);
      newDaily = weeklyPlan[d] || [];
      showToast("‚úÖ Full Weekly Plan updated!");
      
    } else { 
      showToast("‚ùå Invalid format", "var(--a-red)"); 
      return;
    }

    applyDailyPlanToMeals(newDaily);
    document.getElementById('importPlanArea').value = '';

  } catch (e) { 
    showToast("‚ùå Error parsing code", "var(--a-red)"); 
    console.error(e); 
  }
}

/* ‚îÄ‚îÄ REFRESH DAILY PLAN HELPER ‚îÄ‚îÄ */
function loadDailyPlan() {
  let d = daysOfWeek[new Date().getDay()]; 
  let currentDaily = weeklyPlan[d] || [];
  applyDailyPlanToMeals(currentDaily);
}

function applyDailyPlanToMeals(dailyArray) {
  meals = dailyArray.map((slot, index) => {
    return {
      id: Date.now() + index,
      timeLabel: slot.time,
      calories: parseInt(slot.calories) || 0,
      name: slot.name || slot.food || "Meal",
      items: slot.items || (slot.food ? [{food: slot.food, weight: slot.weight || "‚Äî"}] : [])
    };
  });
  lsSet("np_meals", meals);
  updateCalUI();
  updateDayHeaders();
  if(document.getElementById("mealsPage").classList.contains("active")) renderMeals();
}

/* ‚îÄ‚îÄ DYNAMIC DAY HEADERS ‚îÄ‚îÄ */
function updateDayHeaders() {
  const d = daysOfWeek[new Date().getDay()];
  const pageTitle = document.getElementById("mealsPageTitle");
  const navTitle = document.getElementById("navMealTitle");
  
  if(pageTitle) pageTitle.textContent = `${d}'s Meals`;
  if(navTitle) navTitle.textContent = `${d}'s Meals`;
}

/* ‚îÄ‚îÄ IMPORTER 2: FOOD DATABASE ‚îÄ‚îÄ */
function importCustomData() {
  let input = document.getElementById('importCustomArea').value;
  if (!input.trim()) { showToast("Paste database code first", "var(--a-red)"); return; }

  try {
    let clean = cleanInputString(input);
    let newData = new Function("return " + clean)();

    if (Array.isArray(newData)) {
      let valid = newData.filter(item => item.n && item.c);
      if (valid.length > 0) {
        foodDB = valid;
        lsSet("np_foodDB", foodDB);
        document.getElementById('importCustomArea').value = '';
        showToast(`‚úÖ ${valid.length} foods saved to Database!`);
      } else { 
        showToast("‚ùå No valid foods found.", "var(--a-red)"); 
      }
    } else { 
      showToast("‚ùå Must be an Array", "var(--a-red)"); 
    }
  } catch (e) { 
    showToast("‚ùå Error parsing code", "var(--a-red)"); 
    console.error(e); 
  }
}

function clearAllMeals() {
  if(confirm("Are you sure you want to clear your current meal plan?")) {
    meals = [];
    lsSet("np_meals", meals);
    updateCalUI();
    showToast("Plan cleared.", "var(--sub)");
    if(document.getElementById("mealsPage").classList.contains("active")) renderMeals();
  }
}

/* ‚îÄ‚îÄ WATER ‚îÄ‚îÄ */
function addWater(ml){ 
  setWater(Math.min(getWater() + ml, 6000)); 
  updateWaterUI(); 
}
function resetWater(){ setWater(0); updateWaterUI(); }
function updateWaterUI(){
  const w=getWater(), pct=Math.min(w/5000*100,100);
  document.getElementById("waterAmt").textContent=w+" ml";
  document.getElementById("waterBar").style.width=pct+"%";
  document.getElementById("waterPct").textContent=Math.round(pct)+"%";
}

/* ‚îÄ‚îÄ CALORIES ‚îÄ‚îÄ */
function getConsumed(){
  const chk=getChk();
  return meals.filter(m=>chk[m.id]).reduce((s,m)=>s+Number(m.calories),0);
}
function updateCalUI(){
  let dynamicTotal = meals.reduce((s,m)=>s+Number(m.calories),0);
  let total = dynamicTotal > 0 ? dynamicTotal : 2200; 

  const cons=getConsumed();
  const pct=total?Math.min(cons/total*100,100):0;
  
  document.getElementById("calConsumed").textContent=cons;
  document.getElementById("calRemain").textContent=total-cons;
  document.getElementById("calTotalLbl").textContent="of "+total+" kcal total";
  document.getElementById("calGoalLabel").textContent=total+" kcal goal";
  document.getElementById("calBar").style.width=pct+"%";
  document.getElementById("calPct").textContent=Math.round(pct)+"%";
  
  const chkCnt=Object.keys(getChk()).filter(k=>getChk()[k]).length;
  document.getElementById("navMealSub").textContent= meals.length > 0 ? `${chkCnt}/${meals.length} meals done ¬∑ ${cons} kcal` : "No meals for today.";
}

/* ‚îÄ‚îÄ NO MAIDA ‚îÄ‚îÄ */
function markNoMaida(){
  const key=todayKey();
  const lbl=new Date().toLocaleDateString("en-IN",{weekday:"short",day:"numeric",month:"short"});
  if(!noMaida.find(d=>d.date===key)){ noMaida.push({date:key,label:lbl}); lsSet("np_nomaida",noMaida); }
  renderNoMaida(); 
  blast(); 
}
function renderNoMaida(){
  const key=todayKey(), cnt=noMaida.length, marked=!!noMaida.find(d=>d.date===key);
  document.getElementById("maidaCntPage").textContent=cnt;
  document.getElementById("maidaCntMain").textContent=cnt;
  
  const btn=document.getElementById("maidaBtn");
  if(btn) {
    btn.textContent=marked?"üéâ Today Marked! Keep Going!":"‚úÖ Mark Today as No-Maida Day!";
    btn.classList.toggle("marked",marked);
  }
  
  const chips = document.getElementById("maidaChips");
  if(chips) {
    chips.innerHTML=noMaida.slice(-12).map(d=>`<div class="chip">‚úÖ ${d.label}</div>`).join("");
  }
}

/* ‚îÄ‚îÄ TOGGLE MEAL CHECKBOX ‚îÄ‚îÄ */
function toggleMeal(id){
  const chk=getChk(); chk[id]=!chk[id]; setChk(chk);
  
  if(chk[id]) {
    confetti({ 
      particleCount: 80, spread: 65, origin: { y: 0.6 }, 
      colors: ['#00E5A0', '#4D9EFF', '#C77DFF'], zIndex: 9999
    });
  }
  
  renderMeals(); updateCalUI();
}

function blast() {
  confetti({
    particleCount: 120, spread: 100, origin: { y: 0.5 },
    colors: ['#6C63FF', '#FF6584', '#43E97B', '#FFD700', '#29B6F6'], zIndex: 9999
  });
}

/* ‚îÄ‚îÄ RENDER MEALS (NEW UI LOGIC) ‚îÄ‚îÄ */
function renderMeals() {
  const container = document.getElementById("mealList");
  if (!container) return;
  
  const chk = getChk();
  const d = daysOfWeek[new Date().getDay()]; 
  const now = new Date();
  const currentMins = now.getHours() * 60 + now.getMinutes(); 
  
  let nextIdx = -1;

  if (meals.length === 0) {
    container.innerHTML = `<div style="text-align:center; padding: 30px; color: var(--sub); font-size: 14px;">No plan loaded for ${d}.<br><br>Open settings to import your diet structure.</div>`;
    return;
  }

  let htmlString = meals.map((m, i) => {
    let isChk = chk[m.id];
    let color = colorPalette[i % colorPalette.length]; 
    let mealMins = parseTimeMins(m.timeLabel);
    
    if (nextIdx === -1 && mealMins > currentMins && !isChk) {
      nextIdx = i; 
    }
    
    let isNext = (i === nextIdx);

    const validItems = m.items ? m.items.filter(item => item.food && item.food.trim() !== "") : [];
    let itemsHtml = '';
    if (validItems.length > 0) {
      itemsHtml = validItems.map(x => `
        <div class="ing-row">
          <div class="ing-left">
            <div class="ing-bullet" style="background:${color}"></div>
            <span>${x.food}</span>
          </div>
          <div class="ing-tag">${x.weight}</div>
        </div>`).join('');
    } else {
      itemsHtml = `<div class="ing-row" style="justify-content:center; border:none;"><span style="color:var(--sub); font-size:0.8rem; font-style:italic;">Diet Checkpoint</span></div>`;
    }

    // Attempt to extract a title, fallback to "Meal X"
    let mealTitle = m.name;
    if(!mealTitle || mealTitle === "Meal") mealTitle = `Meal ${i+1}`;

    return `
      <div class="meal-card ${isChk ? 'checked' : ''} ${isNext ? 'highlight' : ''}" 
           id="meal-card-${i}"
           style="--accent-color:${color}; --accent-rgb:${hexToRgb(color)}">
        
        <div class="next-badge">Next Up</div>
        
        <div class="mc-content">
          <div class="mc-top">
            <span class="mc-time" style="color:${color}">${m.timeLabel}</span>
            <span class="mc-cal">${m.calories || 0} kcal</span>
          </div>
          
          <div class="mc-title">${mealTitle}</div>
          <div>${itemsHtml}</div>
        </div>

        <div class="mchk ${isChk ? "on" : ""}" onclick="toggleMeal(${m.id})">‚úì</div>
      </div>`;
  }).join('');

  container.innerHTML = htmlString;

  const cons=getConsumed(), total = meals.reduce((s,m)=>s+Number(m.calories),0) || 2200;
  const mp1=document.getElementById("mp-cons"), mp2=document.getElementById("mp-rem");
  if(mp1) mp1.textContent=cons;
  if(mp2) mp2.textContent=total-cons;
}

function scrollToNextMeal() {
  let targetEl = document.querySelector('.meal-card.highlight');
  if (targetEl) {
    targetEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }
}

/* ‚îÄ‚îÄ SAVE TO HISTORY ‚îÄ‚îÄ */
function saveToHistory(){
  const key=todayKey();
  history[key]={ calories:getConsumed(), water:getWater(), savedAt:new Date().toISOString() };
  lsSet("np_history",history);
  showToast("‚úÖ Progress Saved!");
  const hCnt=Object.keys(history).length;
  document.getElementById("navHistSub").textContent=`${hCnt} day${hCnt>1?"s":""} logged`;
}

/* ‚îÄ‚îÄ RENDER HISTORY ‚îÄ‚îÄ */
function renderHistory(){
  const container=document.getElementById("historyList");
  const keys=Object.keys(history).sort((a,b)=>b.localeCompare(a));
  if(!keys.length){
    container.innerHTML=`<div class="h-empty">
      <div class="h-empty-icon">üìä</div>
      <div style="font-size:18px;font-family:var(--font-head);font-weight:700;margin-bottom:8px">No history yet</div>
      <div style="font-size:13px">Go to Today's Meals, check off your meals, then save your progress!</div>
    </div>`;
    return;
  }
  container.innerHTML=keys.map((key,idx)=>{
    const d=new Date(key);
    const lbl=d.toLocaleDateString("en-IN",{weekday:"long",day:"numeric",month:"long",year:"numeric"});
    const data=history[key], nm=!!noMaida.find(n=>n.date===key);
    const cp=Math.min((data.calories/2200)*100,100), wp=Math.min((data.water/5000)*100,100);
    return `<div class="h-card" style="animation-delay:${idx*.06}s">
      ${nm?'<div class="h-badge">üèÜ</div>':""}
      <div class="h-date">${lbl}</div>
      <div class="h-grid">
        <div class="h-stat"><div class="h-sn" style="color:var(--accent)">${data.calories}</div><div class="h-sl">kcal eaten</div></div>
        <div class="h-stat"><div class="h-sn" style="color:var(--water)">${data.water}</div><div class="h-sl">ml water</div></div>
      </div>
      <div style="margin-bottom:10px">
        <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--sub);margin-bottom:5px"><span>üî• Calories</span><span>${Math.round(cp)}%</span></div>
        <div class="pbar-wrap" style="height:8px"><div class="pbar pb-cal" style="width:${cp}%"></div></div>
      </div>
      <div>
        <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--sub);margin-bottom:5px"><span>üíß Hydration</span><span>${Math.round(wp)}%</span></div>
        <div class="pbar-wrap" style="height:8px"><div class="pbar pb-water" style="width:${wp}%"></div></div>
      </div>
      ${nm?'<div style="margin-top:12px;background:#FFD70011;border:1px solid #FFD70033;border-radius:10px;padding:8px;font-size:12px;color:var(--gold);font-weight:600;text-align:center">üèÜ No Maida Day!</div>':""}
    </div>`;
  }).join("");
}

/* ‚îÄ‚îÄ DATE HEADER ‚îÄ‚îÄ */
function updateDate(){
  document.getElementById("hdrDate").textContent=
    new Date().toLocaleDateString("en-IN",{weekday:"long",day:"numeric",month:"long"});
}

/* ‚îÄ‚îÄ UPDATE NAV SUBS ‚îÄ‚îÄ */
function updateNavSubs(){
  const hCnt=Object.keys(history).length;
  if(hCnt>0) document.getElementById("navHistSub").textContent=`${hCnt} day${hCnt>1?"s":""} logged`;
}

/* ‚îÄ‚îÄ RENDER HOME ‚îÄ‚îÄ */
function renderHome(){
  updateDate();
  updateDayHeaders();
  document.getElementById("streakNum").textContent=streak;
  applyTheme();
  updateCalUI();
  updateWaterUI();
  renderNoMaida();
  updateNavSubs();
}

/* ‚îÄ‚îÄ INIT ‚îÄ‚îÄ */
updateStreak();
renderHome();
// Force load today's plan from the weekly database on initial boot
loadDailyPlan();
</script>
</body>
</html>