<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="theme-color" content="#060608"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<title>80 KG Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800;900&display=swap');

:root {
  --bg: #060608;
  --surface: #0D0D12;
  --card: rgba(18,18,28,0.75);
  --card2: rgba(22,22,34,0.85);
  --border: rgba(255,255,255,0.07);
  --text: #F0F0F8;
  --sub: #7878AA;
  --glass-shadow: 0 8px 40px rgba(0,0,0,0.5);
  --accent: #7B5CFF;
  --accent2: #FF5F7E;
  --gold: #FFD060;
  --water: #22D3EE;
  --green: #10F080;
  --border-bright: rgba(255,255,255,0.14);
  --text-sec: rgba(240,240,250,0.5);
  --a-red: #FF3D5A;
  --font: 'Plus Jakarta Sans', sans-serif;
  --r: 20px;
  --page-transition: 0.38s cubic-bezier(0.4,0,0.2,1);
}

.light {
  --bg: #F2F2FA;
  --surface: #FFFFFF;
  --card: rgba(255,255,255,0.8);
  --card2: rgba(255,255,255,0.92);
  --border: rgba(0,0,0,0.07);
  --text: #12122A;
  --sub: #6060AA;
  --glass-shadow: 0 8px 32px rgba(20,20,80,0.08);
  --border-bright: #BBBBD8;
  --text-sec: #6060AA;
  --a-red: #E0002A;
  --green: #00B858;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; -webkit-tap-highlight-color: transparent; }

body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
  transition: background 0.35s ease, color 0.35s ease;
  -webkit-font-smoothing: antialiased;
}

/* ‚îÄ‚îÄ NOISE TEXTURE ‚îÄ‚îÄ */
body::before {
  content: '';
  position: fixed; inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.035'/%3E%3C/svg%3E");
  pointer-events: none; z-index: 0; opacity: 0.28;
}

/* ‚îÄ‚îÄ ORB SYSTEM ‚îÄ‚îÄ */
.orb { position: fixed; border-radius: 50%; filter: blur(100px); pointer-events: none; z-index: 0; will-change: transform; }
.o1 { width: 520px; height: 520px; background: radial-gradient(rgba(123,92,255,0.16), transparent 70%); top: -150px; left: -150px; animation: orb1 20s ease-in-out infinite alternate; }
.o2 { width: 420px; height: 420px; background: radial-gradient(rgba(255,95,126,0.13), transparent 70%); bottom: 60px; right: -100px; animation: orb2 25s ease-in-out infinite alternate; }
.o3 { width: 320px; height: 320px; background: radial-gradient(rgba(16,240,128,0.09), transparent 70%); top: 40%; left: 15%; animation: orb3 17s ease-in-out infinite alternate-reverse; }
@keyframes orb1 { 0%{transform:translate(0,0)scale(1)} 100%{transform:translate(60px,40px)scale(1.12)} }
@keyframes orb2 { 0%{transform:translate(0,0)scale(1)} 100%{transform:translate(-50px,-35px)scale(1.1)} }
@keyframes orb3 { 0%{transform:translate(0,0)scale(1)} 100%{transform:translate(40px,-30px)scale(1.08)} }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
#toast {
  position: fixed; top: 20px; left: 50%;
  transform: translateX(-50%) translateY(-120px) scale(0.9);
  background: rgba(14,14,22,0.97); padding: 11px 22px; border-radius: 40px;
  border: 1px solid var(--border-bright); color: var(--text);
  font-size: 0.84rem; font-weight: 700; z-index: 10000;
  box-shadow: 0 16px 48px rgba(0,0,0,0.7);
  transition: transform 0.42s cubic-bezier(0.34,1.56,0.64,1), opacity 0.3s;
  pointer-events: none; white-space: nowrap; letter-spacing: 0.1px; opacity: 0;
}
#toast.show {
  transform: translateX(-50%) translateY(0) scale(1); opacity: 1;
}

#offlineBadge {
  position: fixed; top: 12px; right: 14px; z-index: 9999;
  background: #FF3D5A; color: #fff; font-size: 10px; font-weight: 800;
  padding: 4px 12px; border-radius: 20px; display: none; letter-spacing: 1px;
}

/* ‚îÄ‚îÄ PAGE SYSTEM ‚îÄ‚îÄ */
#home { position: relative; z-index: 1; max-width: 460px; margin: 0 auto; min-height: 100vh; padding-bottom: 90px; }

.page {
  position: fixed; inset: 0; z-index: 100; background: var(--bg);
  transform: translateX(100%);
  transition: transform var(--page-transition), opacity 0.3s;
  display: flex; flex-direction: column; overflow: hidden; opacity: 0;
}
.page.active {
  transform: translateX(0); opacity: 1;
}
.page.closing {
  transform: translateX(100%); opacity: 0;
}

.page-inner { max-width: 460px; margin: 0 auto; width: 100%; display: flex; flex-direction: column; height: 100%; }
.page-scroll { flex: 1; overflow-y: auto; padding-bottom: 60px; -webkit-overflow-scrolling: touch; overscroll-behavior: contain; }
.page-scroll::-webkit-scrollbar { width: 0; }

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.hdr {
  position: sticky; top: 0; z-index: 200;
  background: var(--bg);
  padding: 18px 18px 14px;
  backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);
  border-bottom: 1px solid var(--border);
}
.hdr-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; }

.logo {
  font-size: 28px; font-weight: 900;
  background: linear-gradient(130deg, #9B7FFF 0%, var(--accent2) 60%, #FF9F50 100%);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  letter-spacing: -1.5px;
  filter: drop-shadow(0 2px 12px rgba(123,92,255,0.35));
}
.logo-date { font-size: 11px; color: var(--sub); letter-spacing: 0.3px; margin-top: 1px; font-weight: 600; }
.hdr-right { display: flex; gap: 8px; align-items: center; }

.streak-pill {
  display: flex; align-items: center; gap: 8px;
  background: linear-gradient(135deg, rgba(123,92,255,0.1), rgba(255,95,126,0.1));
  border: 1px solid rgba(123,92,255,0.2); border-radius: 22px; padding: 8px 14px;
  transition: transform 0.2s, box-shadow 0.2s;
}
.streak-pill:active { transform: scale(0.96); }
.s-num { font-size: 20px; font-weight: 900; color: var(--accent); line-height: 1; }
.s-lbl { font-size: 9px; color: var(--sub); text-transform: uppercase; letter-spacing: 1.2px; font-weight: 700; }
.s-fire { font-size: 20px; display: inline-block; animation: firePulse 1.8s ease-in-out infinite; }

.icon-btn {
  width: 42px; height: 42px; background: var(--card); border: 1px solid var(--border);
  border-radius: 13px; font-size: 18px; cursor: pointer; display: flex; align-items: center;
  justify-content: center; transition: all 0.22s cubic-bezier(0.34,1.56,0.64,1); color: var(--text); flex-shrink: 0;
}
.icon-btn:hover { transform: scale(1.1); border-color: var(--accent); box-shadow: 0 4px 18px rgba(123,92,255,0.25); }
.icon-btn:active { transform: scale(0.92); }

/* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
@keyframes firePulse {
  0%,100% { transform: scale(1) rotate(-4deg); }
  50% { transform: scale(1.2) rotate(5deg); filter: drop-shadow(0 0 12px rgba(255,95,126,0.8)); }
}
@keyframes floatUp {
  0%,100% { transform: translateY(0); }
  50% { transform: translateY(-6px); filter: drop-shadow(0 12px 20px var(--glow-c, rgba(123,92,255,0.4))); }
}
@keyframes goldPulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.06);filter:drop-shadow(0 0 18px rgba(255,208,96,0.6))} }
@keyframes checkPop { 0%{transform:scale(0.5);opacity:0} 65%{transform:scale(1.2)} 100%{transform:scale(1);opacity:1} }
@keyframes fadeUp { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }
@keyframes shimmer { 0%{background-position:-200% center} 100%{background-position:200% center} }
@keyframes spin { to{transform:rotate(360deg)} }
@keyframes pulse-ring { 0%{transform:scale(0.95);box-shadow:0 0 0 0 rgba(16,240,128,0.5)} 70%{transform:scale(1);box-shadow:0 0 0 10px rgba(16,240,128,0)} 100%{transform:scale(0.95);box-shadow:0 0 0 0 rgba(16,240,128,0)} }
@keyframes slideIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }

.shimmer-text {
  background: linear-gradient(90deg, var(--accent), var(--accent2), #22D3EE, var(--accent));
  background-size: 300% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text; animation: shimmer 5s linear infinite;
}
.float-num { display: inline-block; animation: floatUp 4s ease-in-out infinite; }

/* ‚îÄ‚îÄ STATS BAR ‚îÄ‚îÄ */
.stats-bar { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 14px; }
.stat-pill {
  background: var(--card); backdrop-filter: blur(20px); border: 1px solid var(--border);
  border-radius: 18px; padding: 15px 8px; text-align: center;
  box-shadow: var(--glass-shadow); animation: fadeUp 0.45s both;
  transition: transform 0.2s, box-shadow 0.2s;
}
.stat-pill:active { transform: scale(0.96); }
.stat-pill-num { font-size: 20px; font-weight: 900; letter-spacing: -0.5px; }
.stat-pill-lbl { font-size: 9px; color: var(--sub); text-transform: uppercase; letter-spacing: 0.8px; margin-top: 5px; font-weight: 700; }
.sp-cal { color: var(--accent); }
.sp-water { color: var(--water); }
.sp-streak { color: var(--gold); }

/* ‚îÄ‚îÄ QUOTE ‚îÄ‚îÄ */
.quote-card {
  background: linear-gradient(135deg, rgba(123,92,255,0.07), rgba(255,95,126,0.07));
  border: 1px solid rgba(123,92,255,0.15);
  backdrop-filter: blur(20px); border-radius: var(--r);
  padding: 16px 20px; margin-bottom: 14px;
  animation: fadeUp 0.45s 0.05s both;
}
.quote-text { font-size: 13.5px; font-weight: 600; color: var(--text); line-height: 1.65; margin-bottom: 5px; font-style: italic; }
.quote-author { font-size: 10.5px; color: var(--sub); font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }

/* ‚îÄ‚îÄ GLASS CARD ‚îÄ‚îÄ */
.card {
  background: var(--card); backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
  border: 1px solid var(--border); box-shadow: var(--glass-shadow);
  border-radius: var(--r); padding: 20px; margin-bottom: 14px;
  position: relative; overflow: hidden; animation: fadeUp 0.45s both;
  transition: box-shadow 0.25s, border-color 0.25s;
}
.card::before {
  content: ''; position: absolute; inset: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.04), transparent 55%);
  pointer-events: none; border-radius: var(--r);
}

/* ‚îÄ‚îÄ CALORIE CARD ‚îÄ‚îÄ */
.cal-row { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; }
.cal-big {
  font-size: 52px; font-weight: 900; color: var(--accent); line-height: 1;
  letter-spacing: -2.5px; --glow-c: rgba(123,92,255,0.5);
}
.cal-unit { font-size: 11px; color: var(--sub); margin-top: 5px; font-weight: 600; letter-spacing: 0.3px; }
.cal-right { text-align: right; }
.cal-rem { font-size: 26px; font-weight: 900; color: var(--accent2); letter-spacing: -1px; }
.cal-rlbl { font-size: 11px; color: var(--sub); font-weight: 600; }

/* ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ */
.pbar-wrap {
  height: 10px; background: rgba(255,255,255,0.05); border-radius: 10px;
  overflow: hidden; margin-bottom: 8px; border: 1px solid var(--border);
}
.light .pbar-wrap { background: rgba(0,0,0,0.05); }
.pbar {
  height: 100%; border-radius: 10px;
  transition: width 1.1s cubic-bezier(0.34,1.2,0.64,1);
  position: relative; overflow: hidden;
}
.pbar::after {
  content: ''; position: absolute; inset: 0;
  background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
  background-size: 200% auto; animation: shimmer 2.2s linear infinite;
}
.pb-cal { background: linear-gradient(90deg, #7B5CFF, #FF5F7E); box-shadow: 0 0 16px rgba(123,92,255,0.4); }
.pb-water { background: linear-gradient(90deg, #0EA5E9, #22D3EE); box-shadow: 0 0 16px rgba(34,211,238,0.4); }
.plabel { display: flex; justify-content: space-between; font-size: 11px; color: var(--sub); font-weight: 700; }

/* ‚îÄ‚îÄ WATER CARD ‚îÄ‚îÄ */
.water-big {
  font-size: 42px; font-weight: 900; color: var(--water);
  letter-spacing: -1.5px; --glow-c: rgba(34,211,238,0.5);
}
.water-grid { display: grid; grid-template-columns: repeat(4,1fr); gap: 8px; margin-top: 16px; }
.water-btn {
  background: rgba(34,211,238,0.06); border: 1px solid rgba(34,211,238,0.2);
  border-radius: 14px; padding: 14px 4px; color: var(--water); font-family: var(--font);
  font-weight: 900; font-size: 16px; cursor: pointer;
  transition: all 0.25s cubic-bezier(0.34,1.56,0.64,1); text-align: center;
}
.water-btn span { display: block; font-size: 9px; font-weight: 700; opacity: .65; margin-top: 2px; }
.water-btn:hover { transform: translateY(-5px) scale(1.05); box-shadow: 0 8px 22px rgba(34,211,238,0.22); background: rgba(34,211,238,0.14); border-color: var(--water); }
.water-btn:active { transform: scale(0.88); }
.water-reset {
  margin-top: 10px; width: 100%; background: transparent; border: 1px solid var(--border);
  border-radius: 11px; padding: 9px; color: var(--sub); font-family: var(--font);
  font-weight: 700; font-size: 12px; cursor: pointer; transition: all 0.22s;
}
.water-reset:hover { border-color: var(--accent2); color: var(--accent2); background: rgba(255,95,126,0.07); }
.water-reset:active { transform: scale(0.97); }

/* ‚îÄ‚îÄ NAV CARDS ‚îÄ‚îÄ */
.nav-card {
  background: var(--card); backdrop-filter: blur(24px); border: 1px solid var(--border);
  box-shadow: var(--glass-shadow); border-radius: var(--r); padding: 18px;
  margin-bottom: 12px; position: relative; overflow: hidden;
  display: flex; align-items: center; gap: 16px; cursor: pointer;
  transition: transform 0.28s cubic-bezier(0.16,1,0.3,1), border-color 0.25s, box-shadow 0.28s;
  animation: fadeUp 0.45s both; -webkit-tap-highlight-color: transparent;
}
.nav-card::before {
  content: ''; position: absolute; inset: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.04), transparent 55%);
  pointer-events: none;
}
.nav-card:hover { transform: translateY(-4px); border-color: rgba(123,92,255,0.35); box-shadow: 0 16px 45px rgba(123,92,255,0.14); }
.nav-card:active { transform: scale(0.97); }

.nav-icon {
  width: 54px; height: 54px; border-radius: 16px; display: flex; align-items: center;
  justify-content: center; font-size: 28px; flex-shrink: 0; box-shadow: 0 5px 18px rgba(0,0,0,0.25);
  transition: transform 0.28s cubic-bezier(0.34,1.56,0.64,1);
}
.nav-card:hover .nav-icon { transform: scale(1.08) rotate(-3deg); }
.nav-info { flex: 1; }
.nav-title { font-size: 16px; font-weight: 800; margin-bottom: 3px; letter-spacing: -0.2px; }
.nav-sub { font-size: 11.5px; color: var(--sub); font-weight: 500; }
.nav-arrow {
  font-size: 22px; color: var(--sub);
  transition: transform 0.28s cubic-bezier(0.34,1.56,0.64,1), color 0.22s;
}
.nav-card:hover .nav-arrow { transform: translateX(5px); color: var(--accent); }

.ni-meals { background: linear-gradient(135deg, #7B5CFF, #FF5F7E); }
.ni-history { background: linear-gradient(135deg, #FFD060, #FF8E53); }
.ni-maida { background: linear-gradient(135deg, #FFD060, #FFA500); }

.nav-accent-bar {
  position: absolute; left: 0; top: 50%; transform: translateY(-50%);
  width: 3px; height: 55%; border-radius: 0 3px 3px 0;
  background: linear-gradient(180deg, var(--accent), var(--accent2));
  opacity: 0; transition: opacity 0.25s, height 0.25s;
}
.nav-card:hover .nav-accent-bar { opacity: 1; height: 65%; }

/* ‚îÄ‚îÄ SUB-PAGE SHARED ‚îÄ‚îÄ */
.page-hdr {
  display: flex; align-items: center; gap: 12px; padding: 18px 18px 14px;
  position: sticky; top: 0; z-index: 50;
  background: var(--bg); backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);
  border-bottom: 1px solid var(--border);
}
.back-btn {
  width: 42px; height: 42px; background: var(--card); border: 1px solid var(--border);
  border-radius: 13px; font-size: 20px; cursor: pointer; display: flex; align-items: center;
  justify-content: center; transition: all 0.22s cubic-bezier(0.34,1.56,0.64,1); color: var(--text); flex-shrink: 0;
}
.back-btn:hover { border-color: var(--accent); transform: scale(1.08) translateX(-2px); box-shadow: 0 4px 15px rgba(123,92,255,0.2); }
.back-btn:active { transform: scale(0.92); }
.page-title {
  font-size: 22px; font-weight: 900;
  background: linear-gradient(130deg, var(--accent), var(--accent2));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  letter-spacing: -0.5px;
}
.pcontent { padding: 20px 18px 60px; }
.sec-lbl {
  font-size: 14px; font-weight: 800; margin-bottom: 12px;
  display: flex; align-items: center; gap: 7px; letter-spacing: -0.2px;
}

/* ‚îÄ‚îÄ SETTINGS TOGGLE ‚îÄ‚îÄ */
.tog-row { display: flex; justify-content: space-between; align-items: center; }
.tog-lbl { font-size: 15px; font-weight: 700; }
.tog {
  width: 54px; height: 30px; border-radius: 15px; background: rgba(255,255,255,0.08);
  border: 1px solid var(--border); cursor: pointer; position: relative;
  transition: all 0.3s cubic-bezier(0.34,1.56,0.64,1);
}
.tog.on { background: linear-gradient(135deg, var(--accent), var(--accent2)); border-color: transparent; box-shadow: 0 3px 14px rgba(123,92,255,0.35); }
.tog-knob {
  position: absolute; top: 4px; left: 4px; width: 20px; height: 20px; border-radius: 50%;
  background: #fff; transition: left 0.3s cubic-bezier(0.34,1.56,0.64,1); box-shadow: 0 2px 6px rgba(0,0,0,0.3);
}
.tog.on .tog-knob { left: 28px; }

/* ‚îÄ‚îÄ IMPORT/EXPORT ‚îÄ‚îÄ */
.import-box {
  background: var(--card); backdrop-filter: blur(16px); border: 1px solid var(--border);
  border-radius: var(--r); padding: 20px; margin-bottom: 14px;
}
.import-box h3 { font-size: 14px; font-weight: 800; color: var(--text); margin-bottom: 5px; }
.import-box p { font-size: 12px; color: var(--sub); margin-bottom: 14px; line-height: 1.65; }

.import-tabs {
  display: flex; background: rgba(0,0,0,0.18); border-radius: 11px; padding: 4px; gap: 4px;
  border: 1px solid var(--border); margin-bottom: 14px;
}
.light .import-tabs { background: rgba(0,0,0,0.05); }
.imp-tab {
  flex: 1; padding: 9px 0; border-radius: 7px; border: none;
  font-family: var(--font); font-weight: 700; font-size: 13px; cursor: pointer;
  transition: all 0.25s; background: transparent; color: var(--sub);
}
.imp-tab.active {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  color: #fff; box-shadow: 0 4px 14px rgba(123,92,255,0.35);
}

.import-textarea {
  width: 100%; height: 130px; padding: 14px;
  background: rgba(0,0,0,0.22); border: 1px solid var(--border);
  color: var(--green); border-radius: 13px; margin-bottom: 10px;
  font-family: monospace; font-size: 0.8rem; resize: none; outline: none;
  transition: border-color 0.25s, box-shadow 0.25s; line-height: 1.6;
}
.light .import-textarea { background: rgba(255,255,255,0.6); }
.import-textarea:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(123,92,255,0.1); }

.import-hint {
  font-size: 11.5px; color: var(--sub); margin-bottom: 10px; line-height: 1.65;
  background: rgba(255,255,255,0.025); border-radius: 11px; padding: 11px 13px; border: 1px solid var(--border);
}
.import-hint code { color: var(--green); font-size: 10.5px; }

.import-btn {
  width: 100%; padding: 13px; background: rgba(255,255,255,0.04);
  border: 1px solid var(--border-bright); color: var(--text);
  font-weight: 700; font-size: 13.5px; border-radius: 13px; cursor: pointer;
  transition: all 0.25s; font-family: var(--font);
}
.import-btn:hover { border-color: var(--accent); color: #fff; background: var(--accent); box-shadow: 0 6px 22px rgba(123,92,255,0.35); }
.import-btn:active { transform: scale(0.97); }

/* ‚îÄ‚îÄ DANGER ZONE ‚îÄ‚îÄ */
.danger-card {
  background: linear-gradient(135deg, rgba(255,61,90,0.06), transparent);
  border: 1px solid rgba(255,61,90,0.22); border-radius: var(--r); padding: 20px; margin-top: 18px;
}
.danger-title { font-size: 10.5px; font-weight: 900; color: #FF3D5A; letter-spacing: 1.8px; text-transform: uppercase; margin-bottom: 12px; }
.btn-danger {
  width: 100%; padding: 13px; border-radius: 11px; border: 1px solid rgba(255,61,90,0.3);
  background: rgba(255,61,90,0.04); color: #FF3D5A; font-family: var(--font);
  font-weight: 700; font-size: 13.5px; cursor: pointer; transition: all 0.25s; margin-bottom: 9px;
}
.btn-danger:last-child { margin-bottom: 0; }
.btn-danger:hover { background: rgba(255,61,90,0.12); border-color: #FF3D5A; transform: translateY(-2px); box-shadow: 0 5px 18px rgba(255,61,90,0.2); }
.btn-danger:active { transform: scale(0.97); }
.btn-warning { color: #FF9F0A; border-color: rgba(255,159,10,0.28); background: rgba(255,159,10,0.04); }
.btn-warning:hover { background: rgba(255,159,10,0.12); border-color: #FF9F0A; box-shadow: 0 5px 18px rgba(255,159,10,0.2); }

/* ‚îÄ‚îÄ QUICK ADD FORM ‚îÄ‚îÄ */
.quick-form {
  display: flex; flex-direction: column; gap: 10px;
  background: var(--card); backdrop-filter: blur(16px); border: 1px solid var(--border);
  padding: 20px; border-radius: var(--r); position: relative;
}
.quick-form input {
  background: rgba(0,0,0,0.18); border: 1px solid var(--border); color: var(--text);
  border-radius: 13px; padding: 13px 16px; font-family: var(--font);
  font-size: 13.5px; outline: none; width: 100%; transition: all 0.25s; font-weight: 600;
}
.light .quick-form input { background: rgba(255,255,255,0.6); }
.quick-form input::placeholder { color: var(--sub); font-weight: 500; }
.quick-form input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(123,92,255,0.1); background: rgba(123,92,255,0.04); }
.qf-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

.time-label-row {
  display: flex; align-items: center; gap: 11px;
  background: rgba(0,0,0,0.18); border: 1px solid var(--border); border-radius: 13px;
  padding: 13px 16px; cursor: pointer; transition: all 0.25s; position: relative;
}
.light .time-label-row { background: rgba(255,255,255,0.6); }
.time-label-row:focus-within { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(123,92,255,0.1); }
.time-icon { font-size: 17px; flex-shrink: 0; }
.time-input-wrapper { flex: 1; display: flex; flex-direction: column; gap: 1px; }
.time-label-text { font-size: 9.5px; color: var(--sub); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 800; }
.time-display { font-size: 13.5px; font-weight: 700; color: var(--text); }
.time-real-input { position: absolute; opacity: 0; width: 1px; height: 1px; left: 0; }

/* ‚îÄ‚îÄ AUTOCOMPLETE ‚îÄ‚îÄ */
.autocomplete-items {
  position: absolute; top: calc(100% + 8px); left: 0; right: 0;
  z-index: 1000; max-height: 260px; overflow-y: auto;
  display: none; flex-direction: column; gap: 6px;
  background: rgba(12,12,22,0.98); backdrop-filter: blur(35px);
  border: 1px solid var(--border-bright); border-radius: 18px;
  box-shadow: 0 20px 55px rgba(0,0,0,0.7); padding: 10px;
  animation: slideIn 0.2s ease;
}
.autocomplete-items::-webkit-scrollbar { width: 3px; }
.autocomplete-items::-webkit-scrollbar-thumb { background: var(--border-bright); border-radius: 3px; }

.ac-card {
  background: rgba(255,255,255,0.025); border: 1px solid var(--border); border-radius: 13px;
  padding: 12px 14px; cursor: pointer; transition: all 0.22s cubic-bezier(0.16,1,0.3,1);
  display: flex; justify-content: space-between; align-items: center; gap: 10px;
}
.ac-card:hover { border-color: var(--accent); background: rgba(123,92,255,0.1); transform: translateY(-1px); }
.ac-card:active { transform: scale(0.97); }
.ac-info { display: flex; flex-direction: column; gap: 5px; flex: 1; overflow: hidden; }
.ac-title-row { display: flex; align-items: center; gap: 7px; }
.ac-title { font-size: 0.93rem; font-weight: 700; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.ac-type-badge {
  font-size: 0.6rem; font-weight: 900; text-transform: uppercase; letter-spacing: 0.8px;
  background: rgba(123,92,255,0.14); color: var(--accent); padding: 3px 8px; border-radius: 7px;
}
.ac-stats { display: flex; flex-direction: column; align-items: flex-end; flex-shrink: 0; }
.ac-cal { font-size: 1.1rem; font-weight: 900; color: var(--text); }
.ac-unit { font-size: 0.68rem; color: var(--sub); font-weight: 600; margin-top: 1px; }

/* ‚îÄ‚îÄ MEALS PAGE ‚îÄ‚îÄ */
.mini-cal {
  background: var(--card); backdrop-filter: blur(20px); border: 1px solid var(--border);
  border-radius: var(--r); padding: 18px 22px; margin-bottom: 20px;
  display: flex; justify-content: space-between; align-items: center;
  box-shadow: var(--glass-shadow);
}
.mc-num { font-size: 32px; font-weight: 900; line-height: 1.1; letter-spacing: -1px; }
.mc-lbl { font-size: 11.5px; color: var(--sub); font-weight: 600; margin-top: 3px; }
.meal-list { display: flex; flex-direction: column; gap: 14px; }

/* ‚îÄ‚îÄ MEAL CARD ‚îÄ‚îÄ */
.meal-card {
  background: var(--card2); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--border); border-radius: var(--r);
  position: relative; overflow: hidden; display: flex;
  transition: transform 0.3s cubic-bezier(0.25,1,0.5,1), box-shadow 0.3s, border-color 0.3s, opacity 0.3s;
  box-shadow: 0 6px 22px rgba(0,0,0,0.14); animation: fadeUp 0.45s both;
}
.meal-card::before {
  content: ''; width: 4px; background: var(--accent-color, var(--border)); flex-shrink: 0;
  transition: background 0.35s ease;
}
.meal-card:hover { transform: translateY(-3px); box-shadow: 0 14px 36px rgba(0,0,0,0.22); }

/* Checked state */
.meal-card.checked {
  background: rgba(18,18,26,0.4); border-color: transparent;
  box-shadow: none; opacity: 0.72;
}
.meal-card.checked::before { background: var(--green); opacity: 0.45; }
.meal-card.checked .mc-title,
.meal-card.checked .ing-left span { text-decoration: line-through; color: var(--sub); opacity: 0.6; }
.meal-card.checked .mc-time, .meal-card.checked .mc-cal, .meal-card.checked .ing-tag { opacity: 0.45; }

/* Highlight state */
.next-badge {
  display: none; position: absolute; top: 0; right: 56px;
  background: var(--accent-color); color: #000; font-size: 8.5px;
  font-weight: 900; padding: 5px 12px; border-bottom-left-radius: 10px;
  border-bottom-right-radius: 10px; text-transform: uppercase; letter-spacing: 1.2px; z-index: 10;
}
.meal-card.highlight {
  border-color: var(--accent-color);
  box-shadow: 0 0 0 1px var(--accent-color), 0 10px 40px rgba(var(--accent-rgb), 0.22);
  transform: scale(1.015);
}
.meal-card.highlight .next-badge { display: block; }

.mc-content { flex: 1; padding: 20px; display: flex; flex-direction: column; }
.mc-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
.mc-time-cal { display: flex; gap: 9px; align-items: center; }
.mc-time { color: var(--accent-color); font-weight: 800; font-size: 0.78rem; text-transform: uppercase; letter-spacing: 1.1px; }
.mc-cal { background: rgba(128,128,128,0.1); color: var(--text); padding: 4px 11px; border-radius: 9px; font-weight: 700; font-size: 0.73rem; border: 1px solid var(--border); }

.del-meal {
  width: 30px; height: 30px; border-radius: 9px; border: 1px solid transparent; background: rgba(255,61,90,0.07);
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  font-size: 13px; color: #FF3D5A; transition: all 0.25s cubic-bezier(0.25,1,0.5,1);
}
.del-meal:hover { background: #FF3D5A; color: #fff; transform: scale(1.1) rotate(90deg); box-shadow: 0 3px 12px rgba(255,61,90,0.4); }
.del-meal:active { transform: scale(0.88); }

.mc-body { display: flex; justify-content: space-between; align-items: center; gap: 14px; }
.mc-info { flex: 1; }
.mc-title { font-size: 1.18rem; font-weight: 800; color: var(--text); margin-bottom: 12px; letter-spacing: -0.3px; line-height: 1.3; }

.ing-list { display: flex; flex-direction: column; gap: 7px; }
.ing-row { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
.ing-left { display: flex; align-items: center; color: var(--text); font-size: 0.88rem; font-weight: 500; flex: 1; }
.ing-bullet { width: 5px; height: 5px; border-radius: 50%; background: var(--accent-color); margin-right: 10px; flex-shrink: 0; box-shadow: 0 0 7px var(--accent-color); }
.ing-tag { background: rgba(255,255,255,0.04); font-weight: 700; font-size: 0.72rem; padding: 3px 9px; border-radius: 7px; border: 1px solid var(--border); color: var(--sub); white-space: nowrap; }

.mchk {
  width: 44px; height: 44px; flex-shrink: 0; border-radius: 50%; border: 2px solid var(--border);
  background: rgba(0,0,0,0.2); cursor: pointer; display: flex; align-items: center; justify-content: center;
  transition: all 0.35s cubic-bezier(0.34,1.56,0.64,1); font-size: 1.1rem; color: transparent; user-select: none;
}
.mchk:active { transform: scale(0.82); }
.mchk.on {
  background: var(--green); border-color: var(--green); color: #000;
  box-shadow: 0 0 22px rgba(16,240,128,0.4); animation: checkPop 0.4s cubic-bezier(0.34,1.56,0.64,1);
}

.empty-state { text-align: center; padding: 55px 20px; color: var(--sub); }
.empty-icon { font-size: 65px; margin-bottom: 14px; opacity: .75; }

.btn-main {
  width: 100%; padding: 17px; border: none; border-radius: 16px;
  font-family: var(--font); font-weight: 900; font-size: 14.5px; cursor: pointer;
  color: #fff; transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  box-shadow: 0 9px 28px rgba(123,92,255,0.4); letter-spacing: 0.2px; margin-top: 14px;
}
.btn-main:hover { transform: translateY(-4px); box-shadow: 0 14px 42px rgba(123,92,255,0.55); }
.btn-main:active { transform: scale(0.96); }

/* ‚îÄ‚îÄ MAIDA PAGE ‚îÄ‚îÄ */
.btn-mark {
  width: 100%; padding: 19px; border-radius: 20px; border: 2px solid rgba(255,208,96,0.28);
  cursor: pointer; font-family: var(--font); font-size: 17px; font-weight: 800;
  background: linear-gradient(135deg, rgba(255,208,96,0.07), rgba(255,165,0,0.07)); color: var(--gold);
  transition: all 0.35s cubic-bezier(0.34,1.56,0.64,1); letter-spacing: -0.3px;
}
.btn-mark:hover { background: linear-gradient(135deg, rgba(255,208,96,0.17), rgba(255,165,0,0.17)); transform: translateY(-5px); box-shadow: 0 14px 38px rgba(255,208,96,0.28); border-color: var(--gold); }
.btn-mark:active { transform: scale(0.96); }
.btn-mark.marked { border-color: var(--gold); background: linear-gradient(135deg, rgba(255,208,96,0.2), rgba(255,165,0,0.2)); box-shadow: 0 0 28px rgba(255,208,96,0.32); }
.chips { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 14px; }
.chip {
  background: rgba(255,208,96,0.07); border: 1px solid rgba(255,208,96,0.25);
  border-radius: 10px; padding: 7px 13px; font-size: 11.5px; color: var(--gold); font-weight: 700;
  animation: fadeUp 0.4s both;
}

/* ‚îÄ‚îÄ HISTORY ‚îÄ‚îÄ */
.h-card {
  background: var(--card2); backdrop-filter: blur(16px); border: 1px solid var(--border);
  border-radius: var(--r); padding: 22px; margin-bottom: 14px; position: relative; overflow: hidden;
  animation: fadeUp 0.45s both; box-shadow: var(--glass-shadow);
  transition: transform 0.25s, box-shadow 0.25s;
}
.h-card:hover { transform: translateY(-2px); box-shadow: 0 14px 40px rgba(0,0,0,0.2); }
.h-card::after {
  content: ''; position: absolute; top: -50px; right: -50px; width: 140px; height: 140px;
  border-radius: 50%; background: radial-gradient(rgba(123,92,255,0.1), transparent); pointer-events: none;
}
.h-date { font-size: 15px; font-weight: 800; margin-bottom: 12px; letter-spacing: -0.3px; }
.h-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 14px 0; }
.h-stat {
  background: rgba(0,0,0,0.18); border-radius: 14px; padding: 16px 10px; border: 1px solid var(--border); text-align: center;
}
.light .h-stat { background: rgba(255,255,255,0.5); }
.h-sn { font-size: 26px; font-weight: 900; }
.h-sl { font-size: 10px; color: var(--sub); text-transform: uppercase; letter-spacing: 1px; margin-top: 3px; font-weight: 800; }
.h-badge { position: absolute; top: 16px; right: 16px; font-size: 24px; filter: drop-shadow(0 3px 7px rgba(255,208,96,0.5)); }
.h-empty { text-align: center; padding: 75px 20px; color: var(--sub); }
.h-empty-icon { font-size: 65px; margin-bottom: 14px; opacity: .75; }

/* ‚îÄ‚îÄ WEIGHT TRACKER ‚îÄ‚îÄ */
.weight-tracker-card {
  background: var(--card); backdrop-filter: blur(20px); border: 1px solid var(--border);
  border-radius: var(--r); padding: 24px; margin-bottom: 14px; box-shadow: var(--glass-shadow);
  animation: fadeUp 0.45s both;
}
.weight-entry-row { display: flex; gap: 10px; margin-top: 16px; }
.weight-input {
  flex: 1; background: rgba(0,0,0,0.18); border: 1px solid var(--border);
  color: var(--text); border-radius: 14px; padding: 15px;
  font-family: var(--font); font-size: 15px; font-weight: 800; outline: none; transition: all 0.25s;
}
.light .weight-input { background: rgba(255,255,255,0.6); }
.weight-input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(123,92,255,0.1); }
.weight-log-btn {
  padding: 15px 20px; border: none; border-radius: 14px;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  color: #fff; font-weight: 900; font-size: 14px; cursor: pointer;
  transition: all 0.28s cubic-bezier(0.34,1.56,0.64,1);
  font-family: var(--font); white-space: nowrap; box-shadow: 0 5px 18px rgba(123,92,255,0.35);
}
.weight-log-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 28px rgba(123,92,255,0.5); }
.weight-log-btn:active { transform: scale(0.95); }

.weight-history-list { margin-top: 14px; display: flex; flex-direction: column; gap: 9px; }
.weight-entry {
  display: flex; justify-content: space-between; align-items: center;
  background: rgba(255,255,255,0.025); border: 1px solid var(--border);
  border-radius: 14px; padding: 13px 16px;
  transition: transform 0.22s, border-color 0.22s, background 0.22s;
}
.weight-entry:hover { transform: translateY(-2px); border-color: rgba(255,255,255,0.1); background: rgba(255,255,255,0.045); }
.we-date { font-size: 11.5px; color: var(--sub); font-weight: 600; }
.we-val { font-size: 17px; font-weight: 900; }
.we-diff { font-size: 11px; font-weight: 800; padding: 3px 9px; border-radius: 9px; }
.we-down { color: var(--green); background: rgba(16,240,128,0.09); border: 1px solid rgba(16,240,128,0.18); }
.we-up { color: #FF3D5A; background: rgba(255,61,90,0.09); border: 1px solid rgba(255,61,90,0.18); }
.we-same { color: var(--sub); background: rgba(255,255,255,0.04); border: 1px solid var(--border); }

.weight-goal-bar { margin-top: 18px; }
.wg-label { display: flex; justify-content: space-between; font-size: 11.5px; color: var(--sub); margin-bottom: 7px; font-weight: 700; }
.current-wt-big {
  font-size: 48px; font-weight: 900;
  background: linear-gradient(130deg, var(--accent), var(--water));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  --glow-c: rgba(34,211,238,0.3); letter-spacing: -2px;
}
.target-info { font-size: 12.5px; color: var(--sub); margin-top: 9px; font-weight: 500; }
.to-go { color: var(--green); font-weight: 800; }

/* ‚îÄ‚îÄ STRATEGY PAGE ‚îÄ‚îÄ */
.docket-card {
  background: var(--card2); backdrop-filter: blur(16px); border-radius: var(--r);
  margin-bottom: 18px; padding: 22px; box-shadow: var(--glass-shadow);
  transition: transform 0.25s;
}
.docket-card:hover { transform: translateY(-2px); }
.border-standard { border: 1px solid var(--border); }
.border-green { border: 1px solid rgba(16,240,128,0.22); background: linear-gradient(180deg, rgba(16,240,128,0.035), transparent 40%); }
.border-blue { border: 1px solid rgba(34,211,238,0.22); background: linear-gradient(180deg, rgba(34,211,238,0.035), transparent 40%); }
.week-container { border-top: 1px dashed rgba(255,255,255,0.07); padding-top: 16px; margin-top: 16px; margin-bottom: 16px; }
.week-container:first-child { border-top: none; padding-top: 0; margin-top: 0; }
.week-container:last-child { margin-bottom: 0; }
.week-title { font-size: 13.5px; font-weight: 800; color: var(--text); margin-bottom: 11px; }
.comparison-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.scenario-box { background: rgba(0,0,0,0.18); border: 1px solid var(--border); border-radius: 13px; padding: 14px; }
.light .scenario-box { background: rgba(255,255,255,0.5); }
.scenario-title { font-size: 10.5px; text-transform: uppercase; color: var(--sub); font-weight: 800; margin-bottom: 9px; border-bottom: 1px solid var(--border); padding-bottom: 7px; letter-spacing: 0.5px; }
.data-line { display: flex; justify-content: space-between; align-items: center; margin-bottom: 7px; }
.data-line:last-child { margin-bottom: 0; }
.data-label { font-size: 10.5px; color: var(--sub); text-transform: uppercase; font-weight: 700; }
.data-value { font-size: 12.5px; font-weight: 800; color: var(--text); }
.val-cal { color: var(--gold); }
.val-wt { color: var(--water); }
</style>
</head>
<body>

<div id="offlineBadge">üìµ OFFLINE</div>
<div id="toast"></div>
<div class="orb o1"></div>
<div class="orb o2"></div>
<div class="orb o3"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HOME ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="home">
  <div class="hdr">
    <div class="hdr-top">
      <div>
        <div class="logo shimmer-text">80 KG</div>
        <div class="logo-date" id="hdrDate"></div>
      </div>
      <div class="hdr-right">
        <div class="streak-pill">
          <span class="s-fire">üî•</span>
          <div>
            <div class="s-num" id="streakNum">0</div>
            <div class="s-lbl">streak</div>
          </div>
        </div>
        <button class="icon-btn" onclick="openPage('settingsPage')" title="Settings">‚öôÔ∏è</button>
      </div>
    </div>
  </div>

  <div class="content" style="padding:0 16px">

    <div class="stats-bar" style="margin-top:14px">
      <div class="stat-pill">
        <div class="stat-pill-num sp-cal" id="statAvgCal">‚Äî</div>
        <div class="stat-pill-lbl">avg kcal</div>
      </div>
      <div class="stat-pill">
        <div class="stat-pill-num sp-water" id="statDaysLogged">0</div>
        <div class="stat-pill-lbl">days logged</div>
      </div>
      <div class="stat-pill">
        <div class="stat-pill-num sp-streak">üèÜ <span id="statMaida">0</span></div>
        <div class="stat-pill-lbl">no maida</div>
      </div>
    </div>

    <div class="quote-card">
      <div class="quote-text" id="quoteText"></div>
      <div class="quote-author" id="quoteAuthor"></div>
    </div>

    <div class="card" style="animation-delay:.04s">
      <div class="cal-row">
        <div>
          <div class="cal-big float-num" id="calConsumed" style="--glow-c:rgba(123,92,255,0.5)">0</div>
          <div class="cal-unit">kcal consumed today</div>
        </div>
        <div class="cal-right">
          <div class="cal-rem" id="calRemain">0</div>
          <div class="cal-rlbl">remaining</div>
          <div class="cal-rlbl" id="calTotalLbl" style="margin-top:5px;font-size:10px;opacity:.75"></div>
        </div>
      </div>
      <div class="pbar-wrap"><div class="pbar pb-cal" id="calBar" style="width:0%"></div></div>
      <div class="plabel">
        <span>0</span>
        <span id="calPct">0%</span>
        <span id="calGoalLabel" onclick="editCalTarget()" style="cursor:pointer;text-decoration:underline dotted;" title="Tap to edit">2800 ‚úé</span>
      </div>
    </div>

    <div class="card" style="animation-delay:.07s">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <div class="sec-lbl" style="margin-bottom:0">üíß Hydration</div>
        <div style="font-size:11px;color:var(--sub);font-weight:700">Goal: 5000 ml</div>
      </div>
      <div class="water-big float-num" id="waterAmt" style="--glow-c:rgba(34,211,238,0.5)">0 ml</div>
      <div class="pbar-wrap" style="margin:14px 0 9px"><div class="pbar pb-water" id="waterBar" style="width:0%"></div></div>
      <div class="plabel"><span>0</span><span id="waterPct">0%</span><span>5000 ml</span></div>
      <div class="water-grid">
        <button class="water-btn" onclick="addWater(200)">+200<span>ml</span></button>
        <button class="water-btn" onclick="addWater(300)">+300<span>ml</span></button>
        <button class="water-btn" onclick="addWater(400)">+400<span>ml</span></button>
        <button class="water-btn" onclick="addWater(500)">+500<span>ml</span></button>
      </div>
      <button class="water-reset" onclick="resetWater()">‚Ü∫ Reset Water</button>
    </div>

    <div class="nav-card" style="animation-delay:.10s" onclick="openPage('mealsPage')">
      <div class="nav-accent-bar"></div>
      <div class="nav-icon ni-meals">üçΩ</div>
      <div class="nav-info">
        <div class="nav-title" id="navMealTitle">Today's Meals</div>
        <div class="nav-sub" id="navMealSub">Tap to view &amp; track your meals</div>
      </div>
      <div class="nav-arrow">‚Ä∫</div>
    </div>

    <div class="nav-card" style="animation-delay:.13s" onclick="openPage('weightPage')">
      <div class="nav-accent-bar"></div>
      <div class="nav-icon" style="background:linear-gradient(135deg,#10F080,#22D3EE)">‚öñÔ∏è</div>
      <div class="nav-info">
        <div class="nav-title">Weight Tracker</div>
        <div class="nav-sub" id="weightNavSub">Log your daily weight</div>
      </div>
      <div class="nav-arrow">‚Ä∫</div>
    </div>

    <div class="nav-card" style="animation-delay:.16s" onclick="openPage('maidaPage')">
      <div class="nav-accent-bar"></div>
      <div class="nav-icon ni-maida">üèÜ</div>
      <div class="nav-info">
        <div class="nav-title">No Maida Days</div>
        <div class="nav-sub" id="maidaNavSub">Tap to mark &amp; view history</div>
      </div>
      <div style="font-size:26px;font-weight:900;color:var(--gold);margin-right:2px;animation:goldPulse 3s ease-in-out infinite" id="maidaCntMain">0</div>
      <div class="nav-arrow">‚Ä∫</div>
    </div>

    <div class="nav-card" style="animation-delay:.19s" onclick="openPage('historyPage')">
      <div class="nav-accent-bar"></div>
      <div class="nav-icon ni-history">üìÖ</div>
      <div class="nav-info">
        <div class="nav-title">History</div>
        <div class="nav-sub" id="navHistSub">View past days &amp; your progress</div>
      </div>
      <div class="nav-arrow">‚Ä∫</div>
    </div>

    <div class="nav-card" style="animation-delay:.22s" onclick="openPage('strategyPage')">
      <div class="nav-accent-bar"></div>
      <div class="nav-icon" style="background:linear-gradient(135deg,var(--water),#0EA5E9)">üéØ</div>
      <div class="nav-info">
        <div class="nav-title">Milestone Strategy</div>
        <div class="nav-sub">Central Calorie Committee Updates</div>
      </div>
      <div class="nav-arrow">‚Ä∫</div>
    </div>

  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MEALS PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="mealsPage">
  <div class="page-inner">
    <div class="page-hdr">
      <button class="back-btn" onclick="closePage('mealsPage')">‚Üê</button>
      <div class="page-title" id="mealsPageTitle">Today's Meals</div>
    </div>
    <div class="page-scroll">
      <div class="pcontent">
        <div class="mini-cal">
          <div>
            <div class="mc-num float-num" id="mp-cons" style="color:var(--accent);--glow-c:rgba(123,92,255,0.4)">0</div>
            <div class="mc-lbl">kcal consumed</div>
          </div>
          <div style="text-align:right">
            <div class="mc-num float-num" id="mp-rem" style="color:var(--accent2);--glow-c:rgba(255,95,126,0.4)">0</div>
            <div class="mc-lbl">remaining</div>
          </div>
        </div>
        <div class="sec-lbl">üçΩ Your Meal Plan</div>
        <div id="mealList" class="meal-list"></div>
        <div style="margin-top:28px;margin-bottom:28px">
          <div class="sec-lbl">‚ö° Add Extra Food</div>
          <div class="import-hint" style="margin-bottom:10px">Search your food database. Enter weight to auto-calculate calories!</div>
          <div class="quick-form">
            <div class="time-label-row" onclick="document.getElementById('qTimeReal').showPicker()">
              <span class="time-icon">üïê</span>
              <div class="time-input-wrapper">
                <span class="time-label-text">Meal Time</span>
                <span class="time-display" id="timeDisplay">Tap to set time</span>
              </div>
              <input type="time" id="qTimeReal" class="time-real-input" oninput="updateTimeDisplay()"/>
            </div>
            <div style="position:relative">
              <input type="text" id="qName" placeholder="üîç Search food (e.g. Paneer, Oats)" oninput="searchFood()" autocomplete="off"/>
              <div id="autocomplete-list" class="autocomplete-items"></div>
            </div>
            <div class="qf-row">
              <input type="number" id="qWeight" placeholder="Weight (grams)" oninput="calcCals()"/>
              <input type="number" id="qCal" placeholder="Total kcal"/>
            </div>
            <button class="import-btn" style="margin-top:2px" onclick="submitQuickMeal()">+ Add to Today's List</button>
          </div>
        </div>
        <button class="btn-main" id="saveBtn" onclick="saveToHistory()">üíæ Save Today's Progress</button>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIDA PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="maidaPage">
  <div class="page-inner">
    <div class="page-hdr">
      <button class="back-btn" onclick="closePage('maidaPage')">‚Üê</button>
      <div class="page-title">No Maida Challenge</div>
    </div>
    <div class="page-scroll">
      <div class="pcontent">
        <div style="text-align:center;padding:38px 20px 38px">
          <div style="font-size:76px;margin-bottom:14px;display:inline-block;animation:goldPulse 3s ease-in-out infinite">üèÜ</div>
          <div style="font-size:70px;font-weight:900;color:var(--gold);letter-spacing:-3px;display:block;animation:goldPulse 3s 0.5s ease-in-out infinite" id="maidaCntPage">0</div>
          <div style="font-size:12px;color:var(--sub);margin-top:12px;font-weight:800;letter-spacing:1.5px;text-transform:uppercase">Days of Clean Eating</div>
        </div>
        <button class="btn-mark" id="maidaBtn" onclick="markNoMaida()">‚úÖ Mark Today as No-Maida Day!</button>
        <div class="sec-lbl" style="margin-top:38px">Recent Milestones</div>
        <div class="chips" id="maidaChips"></div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HISTORY PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="historyPage">
  <div class="page-inner">
    <div class="page-hdr">
      <button class="back-btn" onclick="closePage('historyPage')">‚Üê</button>
      <div class="page-title">History</div>
    </div>
    <div class="page-scroll">
      <div class="pcontent">
        <div id="historyList"></div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê WEIGHT PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="weightPage">
  <div class="page-inner">
    <div class="page-hdr">
      <button class="back-btn" onclick="closePage('weightPage')">‚Üê</button>
      <div class="page-title">Weight Tracker</div>
    </div>
    <div class="page-scroll">
      <div class="pcontent">
        <div class="weight-tracker-card">
          <div class="sec-lbl" style="margin-bottom:9px">‚öñÔ∏è Current Weight</div>
          <div class="current-wt-big float-num" id="currentWtDisplay" style="--glow-c:rgba(34,211,238,0.3)">‚Äî kg</div>
          <div class="target-info">Target: <span class="to-go">80.0 kg</span> ¬∑ <span id="toGoKg" class="to-go">‚Äî kg to go</span></div>
          <div class="weight-goal-bar" id="wtGoalBarWrap" style="display:none">
            <div class="wg-label"><span>80 kg (goal)</span><span id="wtStartLbl">‚Äî</span></div>
            <div class="pbar-wrap"><div class="pbar" id="wtGoalBar" style="width:0%;background:linear-gradient(90deg,var(--green),var(--water));box-shadow:0 0 14px rgba(16,240,128,0.45)"></div></div>
          </div>
          <div class="weight-entry-row">
            <input type="number" step="0.1" class="weight-input" id="weightInput" placeholder="Enter weight in kg"/>
            <button class="weight-log-btn" onclick="logWeight()">üìå Log</button>
          </div>
        </div>
        <div class="sec-lbl">üìä Weight Log</div>
        <div class="weight-history-list" id="weightHistList"></div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STRATEGY PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="strategyPage">
  <div class="page-inner">
    <div class="page-hdr">
      <button class="back-btn" onclick="closePage('strategyPage')">‚Üê</button>
      <div class="page-title">Milestone Strategy</div>
    </div>
    <div class="page-scroll">
      <div class="pcontent">
        <div class="docket-card border-standard">
          <div class="week-container">
            <div class="week-title">Week 1 (Feb 23 ‚Äì Mar 1)</div>
            <div class="comparison-grid">
              <div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym (2 Hrs)</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,500 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">103.0 ‚ûî 102.0 kg</span></div></div>
              <div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,400 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">103.0 ‚ûî 101.5 kg</span></div></div>
            </div>
          </div>
          <div class="week-container">
            <div class="week-title">Week 2 (Mar 2 ‚Äì Mar 8)</div>
            <div class="comparison-grid">
              <div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym (2 Hrs)</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,500 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">102.0 ‚ûî 101.0 kg</span></div></div>
              <div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,400 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">101.5 ‚ûî 100.5 kg</span></div></div>
            </div>
          </div>
        </div>
        <div class="docket-card border-green">
          <div class="week-container"><div class="week-title">Week 3 (Mar 9 ‚Äì Mar 15)</div><div class="comparison-grid"><div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,400 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">101.0 ‚ûî 100.0 kg</span></div></div><div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,100 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">100.5 ‚ûî 99.7 kg</span></div></div></div></div>
          <div class="week-container"><div class="week-title">Week 4 (Mar 16 ‚Äì Mar 22)</div><div class="comparison-grid"><div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,300 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">100.0 ‚ûî 99.0 kg</span></div></div><div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,100 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">99.7 ‚ûî 98.9 kg</span></div></div></div></div>
          <div class="week-container"><div class="week-title">Week 5 (Mar 23 ‚Äì Mar 29)</div><div class="comparison-grid"><div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,300 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">99.0 ‚ûî 98.0 kg</span></div></div><div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,100 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">98.9 ‚ûî 98.1 kg</span></div></div></div></div>
          <div class="week-container"><div class="week-title">Week 6 (Mar 30 ‚Äì Apr 5)</div><div class="comparison-grid"><div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,300 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">98.0 ‚ûî 97.0 kg</span></div></div><div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,100 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">98.1 ‚ûî 97.3 kg</span></div></div></div></div>
        </div>
        <div class="docket-card border-blue">
          <div class="week-container"><div class="week-title">Weeks 7‚Äì10 (Apr 6 ‚Äì May 3)</div><div class="comparison-grid"><div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,200 kcal</span></div><div class="data-line"><span class="data-label">Month End</span><span class="data-value val-wt">97.0 ‚ûî 93.5 kg</span></div></div><div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">1,800 kcal</span></div><div class="data-line"><span class="data-label">Month End</span><span class="data-value val-wt">97.3 ‚ûî 93.8 kg</span></div></div></div></div>
          <div class="week-container"><div class="week-title">Weeks 11‚Äì14 (May 4 ‚Äì May 31)</div><div class="comparison-grid"><div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,200 kcal</span></div><div class="data-line"><span class="data-label">Month End</span><span class="data-value val-wt">93.5 ‚ûî 90.0 kg</span></div></div><div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">1,800 kcal</span></div><div class="data-line"><span class="data-label">Month End</span><span class="data-value val-wt">93.8 ‚ûî 90.3 kg</span></div></div></div></div>
          <div class="week-container"><div class="week-title">Weeks 15‚Äì18 (Jun 1 ‚Äì Jun 28)</div><div class="comparison-grid"><div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,200 kcal</span></div><div class="data-line"><span class="data-label">Month End</span><span class="data-value val-wt">90.0 ‚ûî 86.5 kg</span></div></div><div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">1,800 kcal</span></div><div class="data-line"><span class="data-label">Month End</span><span class="data-value val-wt">90.3 ‚ûî 86.8 kg</span></div></div></div></div>
          <div class="week-container"><div class="week-title">Weeks 19‚Äì22 (Jun 29 ‚Äì Jul 26)</div><div class="comparison-grid"><div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,200 kcal</span></div><div class="data-line"><span class="data-label">Month End</span><span class="data-value val-wt">86.5 ‚ûî 83.0 kg</span></div></div><div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">1,800 kcal</span></div><div class="data-line"><span class="data-label">Month End</span><span class="data-value val-wt">86.8 ‚ûî 83.3 kg</span></div></div></div></div>
          <div class="week-container"><div class="week-title">Weeks 23‚Äì27 (Jul 27 ‚Äì Aug 30)</div><div class="comparison-grid"><div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,200 kcal</span></div><div class="data-line"><span class="data-label">Final Target</span><span class="data-value val-wt" style="color:var(--green)">83.0 ‚ûî 80.0 kg ‚úÖ</span></div></div><div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">1,800 kcal</span></div><div class="data-line"><span class="data-label">Final Target</span><span class="data-value val-wt" style="color:var(--green)">83.3 ‚ûî 80.0 kg ‚úÖ</span></div></div></div></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SETTINGS PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="settingsPage">
  <div class="page-inner">
    <div class="page-hdr">
      <button class="back-btn" onclick="closePage('settingsPage')">‚Üê</button>
      <div class="page-title">Settings &amp; Tools</div>
    </div>
    <div class="page-scroll">
      <div class="pcontent">
        <div class="card" style="margin-bottom:12px">
          <div class="tog-row">
            <span class="tog-lbl" id="togLbl">üåô Night Mode</span>
            <button class="tog on" id="togBtn" onclick="toggleTheme()">
              <div class="tog-knob"></div>
            </button>
          </div>
        </div>

        <div class="import-box" style="border-color:var(--green)">
          <h3 style="color:var(--green)">üíæ Backup Your Data</h3>
          <p>Download your complete History, Weight Log, Food DB, and Plan securely.</p>
          <button class="import-btn" style="border-color:var(--green);color:var(--green)" onclick="exportData()">‚¨á Download JSON Backup</button>
        </div>

        <div class="import-box">
          <div class="import-tabs">
            <button class="imp-tab active" id="tab-plan" onclick="switchTab('plan')">Daily Plan</button>
            <button class="imp-tab" id="tab-db" onclick="switchTab('db')">Food DB</button>
          </div>
          <div id="panel-plan">
            <div class="import-hint">Paste your structured meal JSON array below.</div>
            <textarea id="importPlanArea" class="import-textarea"
              placeholder='[{ "time":"08:00 AM", "name":"Breakfast", "calories":320, "items":[{"food":"Oats","weight":"80g"}] }]'></textarea>
            <button class="import-btn" onclick="importPlanData()">‚¨Ü Import Plan</button>
          </div>
          <div id="panel-db" style="display:none">
            <div class="import-hint">
              Format: <code>[{"n":"Food Name","c":100,"g":100,"type":"sabji"}]</code>
            </div>
            <textarea id="importDbArea" class="import-textarea"
              placeholder='[{ "n": "Palak Paneer", "c": 221, "g": 100, "type": "sabji" }]'></textarea>
            <button class="import-btn" onclick="importFoodDB()">üíæ Save Food Database</button>
            <div id="dbStatusText" style="margin-top:9px;font-size:12px;color:var(--sub);text-align:center"></div>
          </div>
        </div>

        <div class="danger-card">
          <div class="danger-title">‚ö†Ô∏è Danger Zone</div>
          <button class="btn-danger btn-warning" onclick="resetTodayData()">üßπ Reset Today's Meals &amp; Data</button>
          <button class="btn-danger" onclick="hardResetApp()">üí• Hard Reset ‚Äî Delete All Data</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* ‚ïê‚ïê HAPTIC ‚ïê‚ïê */
const haptic = (ms = 40) => navigator.vibrate && navigator.vibrate(ms);

/* ‚ïê‚ïê OFFLINE ‚ïê‚ïê */
const updateOnlineStatus = () => {
  const b = document.getElementById('offlineBadge');
  if (b) b.style.display = navigator.onLine ? 'none' : 'block';
};
window.addEventListener('online', updateOnlineStatus);
window.addEventListener('offline', updateOnlineStatus);
updateOnlineStatus();

/* ‚ïê‚ïê STORAGE ‚ïê‚ïê */
const ls    = (k, fb) => { try { const v = localStorage.getItem(k); return v != null ? JSON.parse(v) : fb; } catch { return fb; } };
const lsSet = (k, v)  => { try { localStorage.setItem(k, JSON.stringify(v)); } catch {} };

/* ‚ïê‚ïê TODAY KEY ‚ïê‚ïê */
const todayKey = () => {
  const d = new Date();
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
};

const DOW = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
const PALETTE = ['#FF5F7E','#22D3EE','#FFD060','#C084FC','#10F080','#60A5FA','#FB923C','#F472B6'];

function hexToRgb(h) {
  const r = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(h);
  return r ? `${parseInt(r[1],16)},${parseInt(r[2],16)},${parseInt(r[3],16)}` : '123,92,255';
}

function parseTimeMins(val) {
  if (!val) return 0;
  let c = val.toLowerCase().replace(/\s+/g,'');
  const pm = c.includes('pm'), am = c.includes('am');
  const m = c.match(/(\d+):(\d+)/);
  if (!m) return 0;
  let h = parseInt(m[1]), min = parseInt(m[2]);
  if (pm && h !== 12) h += 12;
  if (am && h === 12) h = 0;
  return h * 60 + min;
}

function safeParseJSON(raw) {
  const t = raw.trim();
  const s = t.indexOf('['), e = t.lastIndexOf(']');
  if (s === -1 || e === -1 || e <= s) throw new Error("No valid JSON array found.");
  return JSON.parse(t.substring(s, e + 1));
}

/* ‚ïê‚ïê TOAST ‚ïê‚ïê */
let _toastTimer;
function showToast(msg, color = 'var(--green)') {
  const el = document.getElementById('toast');
  if (!el) return;
  el.textContent = msg; el.style.color = color;
  el.classList.add('show');
  clearTimeout(_toastTimer);
  _toastTimer = setTimeout(() => el.classList.remove('show'), 2600);
}

/* ‚ïê‚ïê STATE ‚ïê‚ïê */
let dark         = ls("np_dark", true);
let streak       = ls("np_streak", 0);
let lastVis      = ls("np_lastvisit", "");
let weeklyPlan   = ls("np_weeklyPlan", {});
let meals        = ls("np_meals", []);
let allChk       = ls("np_checked", {});
let allWater     = ls("np_water", {});
let noMaida      = ls("np_nomaida", []);
let appHistory   = ls("np_history", {});
let foodDB       = ls("np_foodDB", []);
let calTarget    = ls("np_calTarget", 2800);
let lastLoadDate = ls("np_lastLoadDate", "");
let weightLog    = ls("np_weightLog", []);

const getChk   = () => allChk[todayKey()] || {};
const getWater = () => allWater[todayKey()] || 0;
const setChk   = v  => { allChk[todayKey()] = v; lsSet("np_checked", allChk); };
const setWater = v  => { allWater[todayKey()] = v; lsSet("np_water", allWater); };

/* ‚ïê‚ïê QUOTES ‚ïê‚ïê */
const QUOTES = [
  { text: "The body achieves what the mind believes.", author: "‚Äî Unknown" },
  { text: "Discipline is the bridge between goals and accomplishment.", author: "‚Äî Jim Rohn" },
  { text: "Your body can stand almost anything. It's your mind you have to convince.", author: "‚Äî Unknown" },
  { text: "Small daily improvements are the key to staggering long-term results.", author: "‚Äî Unknown" },
  { text: "Take care of your body. It's the only place you have to live.", author: "‚Äî Jim Rohn" },
  { text: "Every workout is progress. Every meal is a choice.", author: "‚Äî 80 KG HQ" },
  { text: "The secret of getting ahead is getting started.", author: "‚Äî Mark Twain" },
  { text: "Success is the sum of small efforts, repeated day in and day out.", author: "‚Äî Robert Collier" }
];
function renderQuote() {
  const idx = new Date().getDate() % QUOTES.length;
  const q = QUOTES[idx];
  const qt = document.getElementById('quoteText');
  const qa = document.getElementById('quoteAuthor');
  if (qt) qt.textContent = `"${q.text}"`;
  if (qa) qa.textContent = q.author;
}

/* ‚ïê‚ïê STREAK ‚ïê‚ïê */
function updateStreak() {
  const t = new Date().toDateString();
  if (lastVis !== t) {
    const yest = new Date(); yest.setDate(yest.getDate() - 1);
    if (!lastVis) streak = 1;
    else if (lastVis === yest.toDateString()) streak++;
    else streak = 1;
    lastVis = t;
    lsSet("np_streak", streak);
    lsSet("np_lastvisit", lastVis);
  }
  const fireEl = document.querySelector('.s-fire');
  if (fireEl) {
    const extra = Math.min(streak * 0.7, 14);
    const speed = Math.max(0.5, 1.8 - (streak * 0.04));
    fireEl.style.fontSize = (20 + extra) + 'px';
    fireEl.style.animationDuration = speed + 's';
  }
}

/* ‚ïê‚ïê THEME ‚ïê‚ïê */
function applyTheme() {
  document.body.classList.toggle("light", !dark);
  const b = document.getElementById("togBtn"), l = document.getElementById("togLbl");
  if (b) b.classList.toggle("on", dark);
  if (l) l.textContent = dark ? "üåô Night Mode" : "‚òÄÔ∏è Day Mode";
}
function toggleTheme() { haptic(20); dark = !dark; lsSet("np_dark", dark); applyTheme(); }

/* ‚ïê‚ïê PAGE NAV ‚Äî FIXED smooth transitions ‚ïê‚ïê */
function openPage(id) {
  haptic(22);
  const page = document.getElementById(id);
  if (!page) return;
  // Remove any lingering closing state
  page.classList.remove('closing');
  // Force a reflow so the transition triggers properly
  void page.offsetWidth;
  page.classList.add('active');

  if (id === 'mealsPage')   { renderMeals(); setTimeout(scrollToNextMeal, 400); }
  if (id === 'historyPage') renderHistory();
  if (id === 'maidaPage')   renderNoMaida();
  if (id === 'weightPage')  renderWeightPage();
}

function closePage(id) {
  haptic(22);
  const page = document.getElementById(id);
  if (!page) return;
  page.classList.add('closing');
  page.classList.remove('active');
  // Clean up closing class after transition completes
  setTimeout(() => page.classList.remove('closing'), 420);
}

function switchTab(tab) {
  haptic(15);
  ['plan', 'db'].forEach(t => {
    document.getElementById(`tab-${t}`)?.classList.toggle('active', tab === t);
    const panel = document.getElementById(`panel-${t}`);
    if (panel) panel.style.display = (tab === t) ? 'block' : 'none';
  });
  if (tab === 'db') {
    const s = document.getElementById('dbStatusText');
    if (s) s.textContent = `Current DB: ${foodDB.length} items`;
  }
}

/* ‚ïê‚ïê WATER ‚ïê‚ïê */
function addWater(ml) {
  haptic(30);
  setWater(Math.min(getWater() + ml, 6000));
  updateWaterUI();
  showToast(`üíß +${ml} ml added!`, 'var(--water)');
}
function resetWater() {
  if (!confirm("Reset today's water intake to 0?")) return;
  haptic(40); setWater(0); updateWaterUI();
}
function updateWaterUI() {
  const w = getWater(), pct = Math.min(w / 5000 * 100, 100);
  const e1 = document.getElementById("waterAmt");
  const e2 = document.getElementById("waterBar");
  const e3 = document.getElementById("waterPct");
  if (e1) e1.textContent = w + " ml";
  if (e2) e2.style.width = pct + "%";
  if (e3) e3.textContent = Math.round(pct) + "%";
}

/* ‚ïê‚ïê TIME ‚ïê‚ïê */
function updateTimeDisplay() {
  const inp = document.getElementById('qTimeReal');
  const disp = document.getElementById('timeDisplay');
  if (!inp || !disp) return;
  const val = inp.value;
  if (!val) { disp.textContent = 'Tap to set time'; return; }
  const [hh, mm] = val.split(':');
  let h = parseInt(hh), ap = h >= 12 ? 'PM' : 'AM';
  if (h > 12) h -= 12; if (h === 0) h = 12;
  disp.textContent = `${h}:${mm} ${ap}`;
}
function setDefaultTime() {
  const now = new Date();
  const el = document.getElementById('qTimeReal');
  if (el) {
    el.value = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
    updateTimeDisplay();
  }
}

/* ‚ïê‚ïê FOOD DB ‚ïê‚ïê */
function importFoodDB() {
  const raw = document.getElementById('importDbArea').value.trim();
  if (!raw) { showToast("Paste database code first", "var(--a-red)"); return; }
  try {
    const parsed = safeParseJSON(raw);
    if (!Array.isArray(parsed)) { showToast("‚ùå Format must be an array", "var(--a-red)"); return; }
    const valid = parsed.filter(i => i.n && i.c !== undefined && i.g !== undefined);
    if (!valid.length) { showToast("‚ùå Objects must have {n,c,g}", "var(--a-red)"); return; }
    foodDB = valid;
    lsSet("np_foodDB", foodDB);
    document.getElementById('importDbArea').value = '';
    const s = document.getElementById('dbStatusText');
    if (s) s.textContent = `‚úÖ Saved ${foodDB.length} items`;
    showToast(`‚úÖ Saved ${foodDB.length} foods!`);
    haptic([30, 50, 30]);
  } catch (e) { showToast("‚ùå Invalid JSON", "var(--a-red)"); }
}

/* ‚ïê‚ïê AUTOCOMPLETE ‚ïê‚ïê */
let currentBaseCal = 0, currentBaseWeight = 0;

function searchFood() {
  const inp = document.getElementById('qName');
  if (!inp) return;
  const val = inp.value.toLowerCase().trim();
  const list = document.getElementById('autocomplete-list');
  list.innerHTML = '';
  if (!val || val.length < 1) { list.style.display = 'none'; return; }

  let matches = foodDB.filter(f => f.n.toLowerCase().includes(val));
  matches.sort((a, b) => {
    const aS = a.n.toLowerCase().startsWith(val), bS = b.n.toLowerCase().startsWith(val);
    if (aS && !bS) return -1; if (!aS && bS) return 1;
    return a.n.localeCompare(b.n);
  });
  matches = matches.slice(0, 8); // Limit to 8 results for perf

  if (!matches.length) { list.style.display = 'none'; return; }

  const iconMap = { sabji:'üç≤', sweet:'üßÅ', street:'üåÆ', roti:'ü´ì', fruit:'üçé', drink:'ü•õ', snack:'üçø', protein:'üí™' };
  matches.forEach(m => {
    const card = document.createElement('div');
    card.className = 'ac-card';
    const unit = m.unit || `${m.g}g`;
    const icon = iconMap[m.type] || 'üçΩÔ∏è';
    const badge = m.type ? `<div class="ac-type-badge">${m.type}</div>` : '';
    card.innerHTML = `
      <div class="ac-info">
        <div class="ac-title-row"><span>${icon}</span><span class="ac-title">${m.n}</span>${badge}</div>
      </div>
      <div class="ac-stats">
        <div class="ac-cal">${m.c} <span style="font-size:.68rem;color:var(--sub)">kcal</span></div>
        <div class="ac-unit">per ${unit}</div>
      </div>`;
    card.onclick = (e) => { haptic(15); e.stopPropagation(); selectFood(m.n, m.c, m.g); };
    list.appendChild(card);
  });
  list.style.display = 'flex';
}

function selectFood(name, baseCal, baseWeight) {
  document.getElementById('qName').value = name;
  currentBaseCal = baseCal; currentBaseWeight = baseWeight;
  document.getElementById('autocomplete-list').style.display = 'none';
  document.getElementById('qWeight').value = baseWeight;
  calcCals();
  document.getElementById('qWeight').focus();
}

function calcCals() {
  const w = parseFloat(document.getElementById('qWeight')?.value) || 0;
  const cEl = document.getElementById('qCal');
  if (!cEl) return;
  if (currentBaseCal > 0 && currentBaseWeight > 0 && w > 0)
    cEl.value = Math.round((currentBaseCal / currentBaseWeight) * w);
}

document.addEventListener("click", e => {
  if (e.target.id !== "qName") {
    const l = document.getElementById("autocomplete-list");
    if (l) l.style.display = "none";
  }
});

/* ‚ïê‚ïê QUICK MEAL SUBMIT ‚ïê‚ïê */
function submitQuickMeal() {
  const nameEl = document.getElementById('qName');
  if (!nameEl) return;
  const name   = nameEl.value.trim();
  const weight = document.getElementById('qWeight').value.trim();
  const cal    = parseInt(document.getElementById('qCal').value) || 0;
  const timeval = document.getElementById('qTimeReal').value;

  if (!name) { showToast("Please select/enter a food", "var(--a-red)"); haptic([50, 50]); return; }

  let timeLabel = "Now";
  if (timeval) {
    const [hh, mm] = timeval.split(':');
    let h = parseInt(hh), ap = h >= 12 ? 'PM' : 'AM';
    if (h > 12) h -= 12; if (h === 0) h = 12;
    timeLabel = `${h}:${mm} ${ap}`;
  } else {
    const now = new Date();
    let h = now.getHours(), min = String(now.getMinutes()).padStart(2, '0'), ap = h >= 12 ? 'PM' : 'AM';
    if (h > 12) h -= 12; if (h === 0) h = 12;
    timeLabel = `${h}:${min} ${ap}`;
  }

  const meal = {
    id: String(Date.now()), timeLabel, name, calories: cal,
    items: [{ food: name, weight: weight ? weight + "g" : "‚Äî" }]
  };
  meals.push(meal);
  lsSet("np_meals", meals);

  // Clear form
  nameEl.value = '';
  document.getElementById('qWeight').value = '';
  document.getElementById('qCal').value = '';
  currentBaseCal = 0; currentBaseWeight = 0;

  setDefaultTime();
  updateCalUI();
  updateDayHeaders();
  showToast(`‚úÖ ${name} added!`);
  haptic([30, 50, 30]);

  if (typeof confetti !== 'undefined')
    confetti({ particleCount: 80, spread: 65, origin: { y: 0.65 }, scalar: 0.9 });

  if (document.getElementById("mealsPage").classList.contains("active")) renderMeals();
}

/* ‚ïê‚ïê DELETE MEAL ‚ïê‚ïê */
function deleteMeal(id) {
  haptic(40);
  if (!confirm("Remove this meal?")) return;
  meals = meals.filter(m => String(m.id) !== String(id));
  const chk = getChk();
  delete chk[String(id)];
  setChk(chk);
  lsSet("np_meals", meals);
  updateCalUI(); updateDayHeaders();
  renderMeals();
  showToast("üóë Meal removed", "var(--sub)");
}

/* ‚ïê‚ïê IMPORT PLAN ‚ïê‚ïê */
function importPlanData() {
  const raw = document.getElementById('importPlanArea').value.trim();
  if (!raw) { showToast("Paste your plan code first", "var(--a-red)"); return; }
  try {
    const parsed = safeParseJSON(raw);
    const today = DOW[new Date().getDay()];
    let daily = [];
    if (Array.isArray(parsed)) {
      weeklyPlan[today] = parsed;
      lsSet("np_weeklyPlan", weeklyPlan);
      daily = parsed;
      showToast(`‚úÖ Plan set for ${today}!`);
    } else if (parsed && typeof parsed === 'object') {
      const fmt = {};
      for (let k in parsed) fmt[k.charAt(0).toUpperCase() + k.slice(1).toLowerCase()] = parsed[k];
      weeklyPlan = fmt;
      lsSet("np_weeklyPlan", weeklyPlan);
      daily = weeklyPlan[today] || [];
      showToast("‚úÖ Full weekly plan imported!");
    } else { showToast("‚ùå Unrecognised format", "var(--a-red)"); return; }
    applyDailyPlanToMeals(daily);
    lastLoadDate = todayKey();
    lsSet("np_lastLoadDate", lastLoadDate);
    document.getElementById('importPlanArea').value = '';
    haptic([30, 50, 30]);
  } catch (e) { showToast("‚ùå Invalid JSON ‚Äî " + e.message, "var(--a-red)"); }
}

/* ‚ïê‚ïê PLAN HELPERS ‚ïê‚ïê */
function loadDailyPlan() {
  if (lastLoadDate === todayKey()) { updateCalUI(); updateDayHeaders(); return; }
  const d = DOW[new Date().getDay()];
  const daily = weeklyPlan[d] || [];
  if (daily.length > 0) applyDailyPlanToMeals(daily);
  else { meals = []; lsSet("np_meals", meals); updateCalUI(); updateDayHeaders(); }
  lastLoadDate = todayKey();
  lsSet("np_lastLoadDate", lastLoadDate);
}

function applyDailyPlanToMeals(arr) {
  meals = arr.map((slot, i) => ({
    id: String(slot.id || Date.now() + i),
    timeLabel: slot.time || slot.timeLabel || "‚Äî",
    name: slot.name || slot.food || `Meal ${i + 1}`,
    calories: parseInt(slot.calories) || 0,
    items: slot.items || (slot.food ? [{ food: slot.food, weight: slot.weight || "‚Äî" }] : [])
  }));
  lsSet("np_meals", meals);
  updateCalUI(); updateDayHeaders();
  if (document.getElementById("mealsPage").classList.contains("active")) renderMeals();
}

function updateDayHeaders() {
  const d = DOW[new Date().getDay()];
  const t = `${d}'s Meals`;
  const pt = document.getElementById("mealsPageTitle");
  const nt = document.getElementById("navMealTitle");
  if (pt) pt.textContent = t;
  if (nt) nt.textContent = t;
}

/* ‚ïê‚ïê EDIT CAL TARGET ‚ïê‚ïê */
function editCalTarget() {
  const v = prompt("Enter your daily calorie target:", calTarget);
  if (v !== null && !isNaN(v) && +v > 0) {
    calTarget = parseInt(v);
    lsSet("np_calTarget", calTarget);
    updateCalUI();
    showToast(`üéØ Target set to ${calTarget} kcal`);
    if (document.getElementById("mealsPage").classList.contains("active")) renderMeals();
  }
}

/* ‚ïê‚ïê CALORIES ‚ïê‚ïê */
function getConsumed() {
  const chk = getChk();
  return meals.filter(m => chk[String(m.id)]).reduce((s, m) => s + Number(m.calories), 0);
}
function getCheckedCount() {
  const chk = getChk();
  return meals.filter(m => chk[String(m.id)]).length;
}

function updateCalUI() {
  const total = calTarget, cons = getConsumed(), pct = Math.min(cons / total * 100, 100);
  const cc  = document.getElementById("calConsumed");
  const cr  = document.getElementById("calRemain");
  const ctl = document.getElementById("calTotalLbl");
  const cgl = document.getElementById("calGoalLabel");
  const cb  = document.getElementById("calBar");
  const cp  = document.getElementById("calPct");
  const nms = document.getElementById("navMealSub");
  if (cc) cc.textContent = cons;
  if (cr) cr.textContent = total - cons;
  if (ctl) ctl.textContent = "of " + total + " kcal";
  if (cgl) cgl.innerHTML = total + " ‚úé";
  if (cb) cb.style.width = pct + "%";
  if (cp) cp.textContent = Math.round(pct) + "%";
  const chkCnt = getCheckedCount();
  if (nms) nms.textContent = meals.length > 0
    ? `${chkCnt}/${meals.length} meals ¬∑ ${cons} kcal`
    : "No plan loaded yet";
}

/* ‚ïê‚ïê NO MAIDA ‚ïê‚ïê */
function markNoMaida() {
  haptic(40);
  const key = todayKey();
  const lbl = new Date().toLocaleDateString("en-IN", { weekday: "short", day: "numeric", month: "short" });
  if (!noMaida.find(d => d.date === key)) {
    noMaida.push({ date: key, label: lbl });
    lsSet("np_nomaida", noMaida);
  }
  renderNoMaida(); updateStatsBar();
  if (typeof confetti !== 'undefined') {
    const c = 350, def = { origin: { y: .65 }, colors: ['#ff0','#f0f','#0ff','#0f0','#f60'] };
    const fire = (r, o) => confetti(Object.assign({}, def, o, { particleCount: Math.floor(c * r) }));
    fire(.25, { spread: 26, startVelocity: 55 }); fire(.2, { spread: 60 });
    fire(.35, { spread: 100, decay: .91, scalar: .8 }); fire(.1, { spread: 120, startVelocity: 25, decay: .92, scalar: 1.2 });
  }
  showToast("üèÜ Clean day marked!", "var(--gold)");
}

function renderNoMaida() {
  const key = todayKey(), cnt = noMaida.length, marked = !!noMaida.find(d => d.date === key);
  const cp = document.getElementById("maidaCntPage"), cm = document.getElementById("maidaCntMain");
  if (cp) cp.textContent = cnt;
  if (cm) cm.textContent = cnt;
  const btn = document.getElementById("maidaBtn");
  if (btn) {
    btn.textContent = marked ? "üéâ Today Marked! Keep Going!" : "‚úÖ Mark Today as No-Maida Day!";
    btn.classList.toggle("marked", marked);
  }
  const chips = document.getElementById("maidaChips");
  if (chips) chips.innerHTML = noMaida.slice(-12).reverse().map(d =>
    `<div class="chip">‚úÖ ${d.label}</div>`).join("");
  const nav = document.getElementById("maidaNavSub");
  if (nav) nav.textContent = cnt > 0 ? `${cnt} clean day${cnt > 1 ? 's' : ''} üåü` : "Tap to mark today!";
}

/* ‚ïê‚ïê TOGGLE MEAL ‚ïê‚ïê */
function toggleMeal(id) {
  const chk = getChk();
  const key = String(id);
  chk[key] = !chk[key];
  setChk(chk);
  haptic(chk[key] ? 55 : 20);
  if (chk[key] && typeof confetti !== 'undefined') {
    confetti({ particleCount: 120, spread: 75, origin: { y: .65 }, colors: ['#10F080', '#60A5FA', '#C084FC', '#FFD060'], scalar: 1.1 });
  }
  renderMeals(); updateCalUI();
}

/* ‚ïê‚ïê RENDER MEALS ‚ïê‚ïê */
function renderMeals() {
  const container = document.getElementById("mealList");
  if (!container) return;
  const chk = getChk();
  const d = DOW[new Date().getDay()];
  const now = new Date();
  const curMins = now.getHours() * 60 + now.getMinutes();

  if (!meals.length) {
    container.innerHTML = `<div class="empty-state">
      <div class="empty-icon">üçΩ</div>
      <div style="font-size:17px;font-weight:900;margin-bottom:7px">No plan for ${d}</div>
      <div style="font-size:12.5px">Use Quick Add below to start tracking!</div>
    </div>`;
    const mp1 = document.getElementById("mp-cons"); if (mp1) mp1.textContent = 0;
    const mp2 = document.getElementById("mp-rem");  if (mp2) mp2.textContent = calTarget;
    return;
  }

  // Find next unchecked meal
  let nextIdx = -1;
  meals.forEach((m, i) => {
    const mm = parseTimeMins(m.timeLabel);
    if (nextIdx === -1 && mm > curMins && !chk[String(m.id)]) nextIdx = i;
  });
  if (nextIdx === -1) meals.forEach((m, i) => {
    if (nextIdx === -1 && !chk[String(m.id)]) nextIdx = i;
  });

  container.innerHTML = meals.map((m, i) => {
    const isDone = !!chk[String(m.id)];
    const isNext = (i === nextIdx);
    const color = PALETTE[i % PALETTE.length];
    const rgb = hexToRgb(color);
    const valid = (m.items || []).filter(x => x.food && x.food.trim());

    const itemsHtml = valid.length
      ? valid.map(x => `<div class="ing-row">
          <div class="ing-left"><div class="ing-bullet" style="background:${color};box-shadow:0 0 7px ${color}"></div><span>${x.food}</span></div>
          <div class="ing-tag">${x.weight || '‚Äî'}</div>
        </div>`).join('')
      : `<div class="ing-row" style="justify-content:center"><span style="color:var(--sub);font-size:.78rem;font-style:italic">Activity Checkpoint</span></div>`;

    return `<div class="meal-card ${isDone ? 'checked' : ''} ${isNext ? 'highlight' : ''}"
         style="--accent-color:${color};--accent-rgb:${rgb};animation-delay:${i * 0.05}s">
      <div class="next-badge">Next Up</div>
      <div class="mc-content">
        <div class="mc-top">
          <div class="mc-time-cal">
            <span class="mc-time">${m.timeLabel || '‚Äî'}</span>
            <span class="mc-cal">${m.calories || 0} kcal</span>
          </div>
          <button class="del-meal" onclick="deleteMeal('${m.id}')" title="Remove">‚úï</button>
        </div>
        <div class="mc-body">
          <div class="mc-info">
            <div class="mc-title">${m.name}</div>
            <div class="ing-list">${itemsHtml}</div>
          </div>
          <div class="mchk ${isDone ? 'on' : ''}" onclick="toggleMeal('${m.id}')">‚úì</div>
        </div>
      </div>
    </div>`;
  }).join('');

  const cons = getConsumed(), total = calTarget;
  const mp1 = document.getElementById("mp-cons"); if (mp1) mp1.textContent = cons;
  const mp2 = document.getElementById("mp-rem");  if (mp2) mp2.textContent = total - cons;
}

function scrollToNextMeal() {
  const el = document.querySelector('.meal-card.highlight');
  if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

/* ‚ïê‚ïê SAVE TO HISTORY ‚ïê‚ïê */
function saveToHistory() {
  haptic(40);
  const key = todayKey();
  appHistory[key] = { calories: getConsumed(), water: getWater(), target: calTarget, savedAt: new Date().toISOString() };
  lsSet("np_history", appHistory);
  showToast("‚úÖ Progress Saved!");
  updateNavSubs(); updateStatsBar();
  if (typeof confetti !== 'undefined')
    confetti({ particleCount: 60, spread: 50, origin: { y: .6 } });
}

/* ‚ïê‚ïê RENDER HISTORY ‚ïê‚ïê */
function renderHistory() {
  const container = document.getElementById("historyList");
  if (!container) return;
  const keys = Object.keys(appHistory).sort((a, b) => b.localeCompare(a));
  if (!keys.length) {
    container.innerHTML = `<div class="h-empty">
      <div class="h-empty-icon">üìä</div>
      <div style="font-size:17px;font-weight:900;margin-bottom:7px">No history yet</div>
      <div style="font-size:13px">Track meals then save progress to build your log</div>
    </div>`;
    return;
  }
  container.innerHTML = keys.map((key, idx) => {
    const d = new Date(key + 'T12:00:00');
    const lbl = d.toLocaleDateString("en-IN", { weekday: "long", day: "numeric", month: "long", year: "numeric" });
    const data = appHistory[key], nm = !!noMaida.find(n => n.date === key);
    const target = data.target || 2800;
    const cp = Math.min((data.calories / target) * 100, 100), wp = Math.min((data.water / 5000) * 100, 100);
    return `<div class="h-card" style="animation-delay:${idx * 0.05}s">
      ${nm ? '<div class="h-badge">üèÜ</div>' : ''}
      <div class="h-date">${lbl}</div>
      <div class="h-grid">
        <div class="h-stat"><div class="h-sn" style="color:var(--accent)">${data.calories}</div><div class="h-sl">kcal eaten</div></div>
        <div class="h-stat"><div class="h-sn" style="color:var(--water)">${data.water}</div><div class="h-sl">ml water</div></div>
      </div>
      <div style="margin-bottom:9px">
        <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--sub);margin-bottom:5px;font-weight:700"><span>üî• Calories</span><span>${Math.round(cp)}%</span></div>
        <div class="pbar-wrap" style="height:9px"><div class="pbar pb-cal" style="width:${cp}%"></div></div>
      </div>
      <div>
        <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--sub);margin-bottom:5px;font-weight:700"><span>üíß Hydration</span><span>${Math.round(wp)}%</span></div>
        <div class="pbar-wrap" style="height:9px"><div class="pbar pb-water" style="width:${wp}%"></div></div>
      </div>
      ${nm ? `<div style="margin-top:14px;background:rgba(255,208,96,0.07);border:1px solid rgba(255,208,96,0.25);border-radius:11px;padding:9px;font-size:12px;color:var(--gold);font-weight:800;text-align:center">üèÜ No Maida Day!</div>` : ''}
    </div>`;
  }).join('');
}

/* ‚ïê‚ïê WEIGHT TRACKER ‚ïê‚ïê */
function logWeight() {
  haptic(20);
  const el = document.getElementById('weightInput');
  if (!el) return;
  const val = parseFloat(el.value);
  if (isNaN(val) || val < 30 || val > 300) {
    showToast("Enter valid weight (30‚Äì300 kg)", "var(--a-red)"); haptic([50, 50]); return;
  }
  const entry = { date: todayKey(), weight: val, ts: Date.now() };
  weightLog = weightLog.filter(e => e.date !== todayKey());
  weightLog.push(entry);
  weightLog.sort((a, b) => a.date.localeCompare(b.date));
  lsSet("np_weightLog", weightLog);
  el.value = '';
  renderWeightPage(); updateWeightNavSub();
  showToast(`‚öñÔ∏è ${val} kg logged!`);
  if (typeof confetti !== 'undefined')
    confetti({ particleCount: 70, spread: 48, origin: { y: .65 }, colors: ['#10F080', '#22D3EE'] });
}

function renderWeightPage() {
  const list = document.getElementById('weightHistList');
  const curDisp = document.getElementById('currentWtDisplay');
  const toGoEl = document.getElementById('toGoKg');
  const barWrap = document.getElementById('wtGoalBarWrap');
  if (!list || !curDisp || !toGoEl) return;
  const TARGET = 80.0;
  if (!weightLog.length) {
    curDisp.textContent = '‚Äî kg'; toGoEl.textContent = '‚Äî kg to go';
    list.innerHTML = '<div style="text-align:center;color:var(--sub);padding:28px 20px;font-size:13px">No entries yet. Log your first weight above!</div>';
    if (barWrap) barWrap.style.display = 'none';
    return;
  }
  const latest = weightLog[weightLog.length - 1];
  const toGo = Math.max(0, latest.weight - TARGET).toFixed(1);
  curDisp.textContent = `${latest.weight} kg`;
  toGoEl.textContent = `${toGo} kg to go`;
  if (barWrap) {
    const sw = weightLog[0].weight;
    const total = Math.max(1, sw - TARGET);
    const lost = sw - latest.weight;
    const pct = Math.min(Math.max(0, (lost / total) * 100), 100);
    barWrap.style.display = 'block';
    document.getElementById('wtGoalBar').style.width = pct + '%';
    document.getElementById('wtStartLbl').textContent = `${sw} kg (start)`;
  }
  const rev = [...weightLog].reverse();
  list.innerHTML = rev.map((e, i) => {
    const prev = rev[i + 1];
    let diffHtml = '';
    if (prev) {
      const diff = (e.weight - prev.weight).toFixed(1);
      const cls = diff < 0 ? 'we-down' : diff > 0 ? 'we-up' : 'we-same';
      const arrow = diff < 0 ? '‚ñº' : diff > 0 ? '‚ñ≤' : '‚Äî';
      diffHtml = `<span class="we-diff ${cls}">${arrow} ${Math.abs(diff)} kg</span>`;
    }
    const d = new Date(e.date + 'T12:00:00');
    const lbl = d.toLocaleDateString("en-IN", { weekday: "short", day: "numeric", month: "short" });
    const isToday = e.date === todayKey();
    return `<div class="weight-entry" ${isToday ? 'style="border-color:var(--accent)"' : ''}>
      <div><div class="we-date">${lbl}${isToday ? ' ¬∑ Today' : ''}</div></div>
      <div style="display:flex;align-items:center;gap:10px">
        ${diffHtml}
        <div class="we-val" style="color:${e.weight <= TARGET ? 'var(--green)' : 'var(--text)'}">${e.weight} kg</div>
      </div>
    </div>`;
  }).join('');
}

function updateWeightNavSub() {
  const el = document.getElementById('weightNavSub');
  if (!el) return;
  if (!weightLog.length) { el.textContent = 'Log your daily weight'; return; }
  const latest = weightLog[weightLog.length - 1];
  const toGo = Math.max(0, latest.weight - 80.0).toFixed(1);
  el.textContent = `Current: ${latest.weight} kg ¬∑ ${toGo} kg to goal`;
}

/* ‚ïê‚ïê STATS BAR ‚ïê‚ïê */
function updateStatsBar() {
  const keys = Object.keys(appHistory);
  const daysLogged = keys.length;
  let avgCal = '‚Äî';
  if (daysLogged > 0) {
    const sum = keys.reduce((s, k) => s + (appHistory[k].calories || 0), 0);
    avgCal = Math.round(sum / daysLogged);
  }
  const e1 = document.getElementById('statAvgCal');
  const e2 = document.getElementById('statDaysLogged');
  const sm = document.getElementById('statMaida');
  if (e1) e1.textContent = avgCal;
  if (e2) e2.textContent = daysLogged;
  if (sm) sm.textContent = noMaida.length;
}

/* ‚ïê‚ïê DATA BACKUP ‚ïê‚ïê */
function exportData() {
  haptic(30);
  const data = { appHistory, weightLog, foodDB, noMaida, weeklyPlan, meals, calTarget, streak, lastVis };
  const str = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data, null, 2));
  const a = document.createElement('a');
  a.setAttribute("href", str);
  a.setAttribute("download", "80kg_backup_" + todayKey() + ".json");
  document.body.appendChild(a); a.click(); a.remove();
  showToast("‚úÖ Backup Downloaded!");
}

function resetTodayData() {
  haptic([30, 50]);
  if (!confirm("üßπ Reset today's meals, calories, and water?\n\nYour DB and History remain safe.")) return;
  allChk[todayKey()] = {};
  allWater[todayKey()] = 0;
  lsSet("np_checked", allChk);
  lsSet("np_water", allWater);
  delete appHistory[todayKey()];
  lsSet("np_history", appHistory);
  meals = []; lsSet("np_meals", meals);
  lastLoadDate = todayKey(); lsSet("np_lastLoadDate", lastLoadDate);
  updateCalUI(); updateWaterUI(); updateStatsBar(); updateDayHeaders(); renderNoMaida();
  if (document.getElementById("mealsPage").classList.contains("active")) renderMeals();
  closePage('settingsPage');
  showToast("‚úÖ Today's data reset.");
}

function hardResetApp() {
  haptic([50, 100, 50]);
  if (confirm("üí• Delete ALL data forever? This cannot be undone.")) {
    localStorage.clear(); location.reload();
  }
}

/* ‚ïê‚ïê DATES & SUBS ‚ïê‚ïê */
function updateDate() {
  const el = document.getElementById("hdrDate");
  if (el) el.textContent = new Date().toLocaleDateString("en-IN", { weekday: "long", day: "numeric", month: "long" });
}
function updateNavSubs() {
  const cnt = Object.keys(appHistory).length;
  const el = document.getElementById("navHistSub");
  if (el && cnt > 0) el.textContent = `${cnt} day${cnt > 1 ? 's' : ''} logged`;
}

/* ‚ïê‚ïê INIT ‚ïê‚ïê */
function renderHome() {
  setDefaultTime();
  updateDate();
  updateDayHeaders();
  const sn = document.getElementById("streakNum");
  if (sn) sn.textContent = streak;
  applyTheme();
  updateCalUI();
  updateWaterUI();
  renderNoMaida();
  updateNavSubs();
  renderQuote();
  updateStatsBar();
  updateWeightNavSub();
}

/* ‚ïê‚ïê MIDNIGHT AUTO-REFRESH ‚ïê‚ïê */
let _lastKey = todayKey();
setInterval(() => {
  if (todayKey() !== _lastKey) {
    _lastKey = todayKey(); lastLoadDate = ''; lsSet("np_lastLoadDate", '');
    loadDailyPlan(); renderHome();
  }
}, 30000);

updateStreak();
loadDailyPlan();
renderHome();
</script>
</body>
</html>
