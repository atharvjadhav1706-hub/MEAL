<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="theme-color" content="#000000"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<title>80 KG Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap');

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CSS VARIABLES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
:root {
  /* DARK THEME - GLASSMORPHISM */
  --bg: #050505; 
  --surface: #0A0A0A; 
  --card: rgba(22, 22, 26, 0.55); 
  --card2: rgba(30, 30, 35, 0.6);
  --border: rgba(255, 255, 255, 0.08); 
  --text: #F5F5F5; 
  --sub: #999999;
  --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
  
  /* ACCENTS */
  --accent: #6C63FF; 
  --accent2: #FF6584; 
  --gold: #FFD700; 
  --water: #29B6F6;
  
  /* OVERLAYS & STATUS */
  --surface-imp: rgba(255,255,255,0.05);
  --border-imp: rgba(255,255,255,0.1); 
  --border-bright: rgba(255,255,255,0.2);
  --text-sec: rgba(240,240,240,0.5); 
  --a-green: #00E5A0; 
  --a-red: #FF4D6D;
  
  --font-head: 'Playfair Display', serif; 
  --font-body: 'Plus Jakarta Sans', sans-serif;
  --r: 24px;
}

.light{
  --bg: #EAEAF2; 
  --surface: #FFFFFF; 
  --card: rgba(255, 255, 255, 0.65); 
  --card2: rgba(255, 255, 255, 0.8);
  --border: rgba(0, 0, 0, 0.06); 
  --text: #1A1A35; 
  --sub: #6666AA;
  --glass-shadow: 0 8px 32px rgba(31, 38, 135, 0.07);
  --surface-imp: #FFFFFF; --border-imp: #C8C8E8;
  --border-bright: #A0A0C0; --text-sec: #6666AA; --a-red: #E0002A;
}

*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
html{scroll-behavior:smooth;}
body{font-family:var(--font-body);background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;transition:background .4s,color .4s;}

/* ‚îÄ‚îÄ ORB BACKGROUND ‚îÄ‚îÄ */
.orb{position:fixed;border-radius:50%;filter:blur(80px);pointer-events:none;z-index:0;animation:drift 14s ease-in-out infinite alternate;}
.o1{width:360px;height:360px;background:radial-gradient(rgba(108,99,255,0.25),transparent 70%);top:-80px;left:-80px;}
.o2{width:300px;height:300px;background:radial-gradient(rgba(255,101,132,0.2),transparent 70%);bottom:60px;right:-60px;animation-delay:-7s;}
.o3{width:250px;height:250px;background:radial-gradient(rgba(0,229,160,0.15),transparent 70%);top:38%;left:28%;animation-delay:-3s;}
@keyframes drift{0%{transform:translate(0,0) scale(1);}100%{transform:translate(35px,25px) scale(1.15);}}

/* ‚îÄ‚îÄ TOAST & ALERTS ‚îÄ‚îÄ */
#toast{
  position:fixed;top:20px;left:50%;transform:translateX(-50%) translateY(-80px);
  background:rgba(18,18,24,0.97);padding:13px 24px;border-radius:40px;
  border:1px solid var(--border-bright);color:var(--text);
  font-size:0.87rem;font-weight:700;z-index:10000;
  box-shadow:0 8px 32px rgba(0,0,0,0.5);font-family:var(--font-body);
  transition:transform .35s cubic-bezier(.34,1.56,.64,1);pointer-events:none;
  white-space:nowrap;
}
#toast.show{transform:translateX(-50%) translateY(0);}

#offlineBadge{
  position:fixed;top:12px;right:14px;z-index:9999;
  background:#FF4D6D;color:#fff;font-size:10px;font-weight:800;
  padding:4px 10px;border-radius:20px;display:none;letter-spacing:.5px;
  font-family:var(--font-body);
}

/* ‚îÄ‚îÄ PAGE SYSTEM ‚îÄ‚îÄ */
#home{position:relative;z-index:1;max-width:440px;margin:0 auto;min-height:100vh;padding-bottom:100px;}
.page{
  position:fixed;inset:0;z-index:100;background:var(--bg);
  transform:translateX(100%);transition:transform .38s cubic-bezier(.4,0,.2,1);
  display:flex;flex-direction:column;overflow:hidden;
}
.page.active{transform:translateX(0);}
.page-inner{max-width:440px;margin:0 auto;width:100%;display:flex;flex-direction:column;height:100%;}
.page-scroll{flex:1;overflow-y:auto;padding-bottom:40px;}
.page-scroll::-webkit-scrollbar{width:3px;}
.page-scroll::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px;}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.hdr{position:sticky;top:0;z-index:200;background:rgba(var(--bg), 0.5);padding:18px 20px 14px;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid var(--border);}
.hdr-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;}
.logo{font-family:var(--font-head);font-size:28px;font-weight:900;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text; filter:drop-shadow(0 2px 4px rgba(108,99,255,0.3));}
.logo-date{font-size:11px;color:var(--sub);letter-spacing:.5px;margin-top:-2px;font-weight:600;}
.hdr-right{display:flex;gap:10px;align-items:center;}

.streak-pill{display:flex;align-items:center;gap:7px;
  background:linear-gradient(135deg,rgba(108,99,255,0.15),rgba(255,101,132,0.15));
  border:1px solid rgba(108,99,255,0.3);border-radius:20px;padding:7px 14px;
  box-shadow: 0 4px 15px rgba(108,99,255,0.1);}
.s-num{font-family:var(--font-head);font-size:21px;font-weight:900;color:var(--accent);line-height:1;}
.s-lbl{font-size:9px;color:var(--sub);text-transform:uppercase;letter-spacing:1px;}

.icon-btn{width:42px;height:42px;background:var(--card);border:1px solid var(--border);
  border-radius:14px;font-size:20px;cursor:pointer;display:flex;align-items:center;
  justify-content:center;transition:all .22s;color:var(--text);flex-shrink:0; backdrop-filter:blur(10px);}
.icon-btn:hover{transform:scale(1.08);border-color:var(--accent);box-shadow:0 5px 15px rgba(108,99,255,0.2);}

/* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
@keyframes popBounce {
  0%, 100% { transform: scale(1) translateY(0); }
  20% { transform: scale(1.1, 0.9) translateY(2px); }
  50% { transform: scale(0.95, 1.05) translateY(-8px); filter: drop-shadow(0 8px 8px rgba(41,182,246,0.5)); }
  80% { transform: scale(1.02, 0.98) translateY(0); }
}

@keyframes depthFloat {
  0%, 100% { transform: translateY(0); filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
  50% { transform: translateY(-6px); filter: drop-shadow(0 12px 16px var(--glow-color)); }
}

@keyframes firePulse {
  0%, 100% { transform: scale(1) rotate(-4deg); filter: drop-shadow(0 0 5px rgba(255,101,132,0.4)); }
  50% { transform: scale(1.15) rotate(4deg); filter: drop-shadow(0 0 15px rgba(255,101,132,0.8)); }
}

@keyframes targetSpin{0%{transform:rotate(0deg) scale(1);}50%{transform:rotate(8deg) scale(1.1);}100%{transform:rotate(0deg) scale(1);}}
@keyframes checkPop{0%{transform:scale(0);}60%{transform:scale(1.3);}100%{transform:scale(1);}}
@keyframes mPulse{0%,100%{transform:scale(1);}50%{transform:scale(1.06); filter: drop-shadow(0 10px 20px rgba(255,215,0,0.4));}}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px);}to{opacity:1;transform:translateY(0);}}
@keyframes shimmer{0%{background-position:-200% center;}100%{background-position:200% center;}}

.s-fire{font-size:22px; display:inline-block; animation:firePulse 1.6s ease-in-out infinite;}
.water-emoji{display:inline-block; animation: popBounce 2.5s cubic-bezier(0.28, 0.84, 0.42, 1) infinite;}

.ni-meals-icon{display:inline-block; transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);}
.nav-card:hover .ni-meals-icon{transform: scale(1.2) rotate(-5deg);}
.ni-trophy-icon{display:inline-block; animation:mPulse 3s ease-in-out infinite;}
.ni-target-icon{display:inline-block; animation:targetSpin 4s ease-in-out infinite;}

.shimmer-text{
  background:linear-gradient(90deg,var(--accent),var(--accent2),var(--accent));
  background-size:200% auto;
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  animation:shimmer 3s linear infinite;
}

/* ‚îÄ‚îÄ GLASS CARDS ‚îÄ‚îÄ */
.card, .nav-card, .stat-pill, .quote-card {
  background: var(--card);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--border);
  box-shadow: var(--glass-shadow);
  border-radius: var(--r);
  padding: 20px;
  margin-bottom: 14px;
  position: relative;
  overflow: hidden;
  animation: fadeUp .5s cubic-bezier(0.16, 1, 0.3, 1) both;
}
.card::before, .nav-card::before{
  content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,rgba(255,255,255,0.05),transparent 60%);pointer-events:none;
}

/* ‚îÄ‚îÄ STATS SUMMARY BAR ‚îÄ‚îÄ */
.stats-bar{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:16px;}
.stat-pill{padding:14px 10px; text-align:center; border-radius:20px;}
.stat-pill-num{font-family:var(--font-head);font-size:22px;font-weight:900; letter-spacing:-0.5px;}
.stat-pill-lbl{font-size:9.5px;color:var(--sub);text-transform:uppercase;letter-spacing:.8px;margin-top:4px;font-weight:600;}
.sp-cal{color:var(--accent); text-shadow: 0 2px 10px rgba(108,99,255,0.3);}
.sp-water{color:var(--water); text-shadow: 0 2px 10px rgba(41,182,246,0.3);}
.sp-streak{color:var(--gold); text-shadow: 0 2px 10px rgba(255,215,0,0.3);}

/* ‚îÄ‚îÄ MOTIVATIONAL QUOTE ‚îÄ‚îÄ */
.quote-card{
  background: linear-gradient(135deg, rgba(108,99,255,0.1), rgba(255,101,132,0.1));
  border: 1px solid rgba(108,99,255,0.2);
  padding: 18px 22px;
}
.quote-text{font-family:var(--font-head);font-size:14.5px;font-weight:700;
  color:var(--text);line-height:1.5;margin-bottom:6px; font-style:italic;}
.quote-author{font-size:11px;color:var(--sub); font-weight:600; text-transform:uppercase; letter-spacing:1px;}

/* ‚îÄ‚îÄ CALORIE CARD (With Bouncing Number) ‚îÄ‚îÄ */
.cal-row{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px;}
.cal-big{
  font-family:var(--font-head);font-size:52px;font-weight:900;color:var(--accent);line-height:1;
  --glow-color: rgba(108,99,255,0.5);
  animation: depthFloat 4s ease-in-out infinite;
  display: inline-block;
}
.cal-unit{font-size:12px;color:var(--sub);margin-top:8px; font-weight:600;}
.cal-right{text-align:right;}
.cal-rem{font-family:var(--font-head);font-size:26px;font-weight:900;color:var(--accent2);
  text-shadow: 0 2px 15px rgba(255,101,132,0.4);}
.cal-rlbl{font-size:11px;color:var(--sub); font-weight:600;}
.pbar-wrap{height:14px;background:rgba(0,0,0,0.2);border-radius:14px;overflow:hidden;margin-bottom:8px; border:1px solid var(--border);}
.light .pbar-wrap { background:rgba(0,0,0,0.05); }
.pbar{height:100%;border-radius:14px;transition:width 1s cubic-bezier(.34,1.56,.64,1);position:relative;}
.pbar::after{content:'';position:absolute;right:0;top:0;height:100%;width:30px;
  background:linear-gradient(90deg,transparent,rgba(255,255,255,0.4));animation:shimmer 2s linear infinite;}
.pb-cal{background:linear-gradient(90deg,#6C63FF,#FF6584);box-shadow:0 0 15px rgba(108,99,255,0.6);}
.pb-water{background:linear-gradient(90deg,#0288D1,#00D4FF);box-shadow:0 0 15px rgba(41,182,246,0.6);}
.plabel{display:flex;justify-content:space-between;font-size:11.5px;color:var(--sub); font-weight:600;}

/* ‚îÄ‚îÄ WATER CARD (With Bouncing Number) ‚îÄ‚îÄ */
.water-big{
  font-family:var(--font-head);font-size:42px;font-weight:900;color:var(--water);
  --glow-color: rgba(41,182,246,0.5);
  animation: depthFloat 3.5s ease-in-out infinite; animation-delay: 0.5s;
  display: inline-block;
}
.water-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:16px;}
.water-btn{
  background: rgba(41,182,246,0.1); border:1px solid rgba(41,182,246,0.3);
  border-radius:16px;padding:14px 4px;color:var(--water);font-family:var(--font-head);
  font-weight:900;font-size:16px;cursor:pointer;transition:all .3s cubic-bezier(.34,1.56,.64,1);
  text-align:center; backdrop-filter:blur(5px);
}
.water-btn span{display:block;font-size:10px;font-family:var(--font-body);font-weight:600;opacity:.7; margin-top:2px;}
.water-btn:hover{transform:translateY(-4px) scale(1.05);box-shadow:0 8px 20px rgba(41,182,246,0.25); background: rgba(41,182,246,0.2);}
.water-btn:active{transform:scale(.92);}
.water-reset{margin-top:12px;width:100%;background:rgba(255,255,255,0.03);border:1px solid var(--border);
  border-radius:14px;padding:10px;color:var(--sub);font-family:var(--font-body);font-weight:600;
  font-size:12px;cursor:pointer;transition:all .2s;}
.water-reset:hover{border-color:var(--accent2);color:var(--accent2); background: rgba(255,101,132,0.1);}

/* ‚îÄ‚îÄ NAV CARDS ‚îÄ‚îÄ */
.nav-card{
  padding:20px; display:flex; align-items:center; gap:18px; cursor:pointer; 
  transition:all .3s cubic-bezier(0.16, 1, 0.3, 1);
}
.nav-card:hover{transform:translateY(-4px);border-color:rgba(108,99,255,0.4);box-shadow:0 12px 30px rgba(108,99,255,0.15);}
.nav-card:active{transform:scale(.97);}
.nav-icon{width:56px;height:56px;border-radius:18px;display:flex;align-items:center;
  justify-content:center;font-size:28px;flex-shrink:0; box-shadow: 0 4px 15px rgba(0,0,0,0.2);}
.ni-meals{background:linear-gradient(135deg,var(--accent),var(--accent2));}
.ni-history{background:linear-gradient(135deg,var(--gold),#FF8E53);}
.ni-maida{background:linear-gradient(135deg,#FFD700,#FFA500);}
.nav-info{flex:1;}
.nav-title{font-family:var(--font-head);font-size:18px;font-weight:900;margin-bottom:4px; letter-spacing:-0.3px;}
.nav-sub{font-size:12.5px;color:var(--sub); font-weight:500;}
.nav-arrow{font-size:24px;color:var(--sub);transition:transform .3s cubic-bezier(0.34, 1.56, 0.64, 1);}
.nav-card:hover .nav-arrow{transform:translateX(6px);color:var(--accent);}

/* ‚ïê‚ïê‚ïê SUB-PAGE SHARED ‚ïê‚ïê‚ïê */
.page-hdr{display:flex;align-items:center;gap:14px;padding:18px 20px 14px;
  position:sticky;top:0;z-index:50;background:rgba(var(--bg), 0.5);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px); border-bottom:1px solid var(--border);}
.back-btn{width:42px;height:42px;background:var(--card);border:1px solid var(--border);
  border-radius:14px;font-size:20px;cursor:pointer;display:flex;align-items:center;
  justify-content:center;transition:all .22s;color:var(--text);flex-shrink:0; backdrop-filter:blur(10px);}
.back-btn:hover{border-color:var(--accent);transform:scale(1.08);}
.page-title{font-family:var(--font-head);font-size:24px;font-weight:900;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.pcontent{padding:20px 20px 40px;}
.sec-lbl{font-family:var(--font-head);font-size:16px;font-weight:900;
  margin-bottom:12px;display:flex;align-items:center;gap:8px; letter-spacing:-0.3px;}

/* ‚ïê‚ïê‚ïê SETTINGS PAGE ‚ïê‚ïê‚ïê */
.tog-row{display:flex;justify-content:space-between;align-items:center;
  margin-bottom:0;padding-bottom:0;border:none;}
.tog-lbl{font-size:15px;font-weight:700; font-family:var(--font-head);}
.tog{width:56px;height:32px;border-radius:16px;background:rgba(255,255,255,0.1); border:1px solid var(--border);
  cursor:pointer;position:relative;transition:all .3s;}
.tog.on{background:linear-gradient(135deg,var(--accent),var(--accent2)); border-color:transparent;}
.tog-knob{position:absolute;top:3px;left:4px;width:24px;height:24px;border-radius:50%;
  background:#fff;transition:left .3s cubic-bezier(0.34, 1.56, 0.64, 1);box-shadow:0 2px 8px rgba(0,0,0,0.3);}
.tog.on .tog-knob{left:26px;}

/* ‚îÄ‚îÄ IMPORT/EXPORT BOXES ‚îÄ‚îÄ */
.import-box{background:var(--card); backdrop-filter:blur(16px); border:1px solid var(--border);
  border-radius:24px;padding:24px;margin-bottom:16px;}
.import-box h3{font-size:16px;font-weight:900;font-family:var(--font-head);
  color:var(--text);margin-bottom:8px;}
.import-box p{font-size:12.5px;color:var(--sub);margin-bottom:16px;line-height:1.5; font-weight:500;}

.import-tabs{display:flex;background:rgba(0,0,0,0.2);border-radius:14px;padding:4px;gap:4px;
  border:1px solid var(--border);margin-bottom:16px;}
.light .import-tabs { background:rgba(0,0,0,0.05); }
.imp-tab{flex:1;padding:10px 0;border-radius:10px;border:none;
  font-family:var(--font-body);font-weight:700;font-size:13px;cursor:pointer;
  transition:all .3s;background:transparent;color:var(--sub);}
.imp-tab.active{background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:#fff;box-shadow:0 4px 12px rgba(108,99,255,0.3);}

.import-textarea{width:100%;height:150px;padding:16px;
  background:rgba(0,0,0,0.3);border:1px solid var(--border);
  color:var(--a-green);border-radius:16px;margin-bottom:14px;
  font-family:monospace;font-size:0.85rem;resize:none;outline:none;
  transition:border-color .3s;line-height:1.5;}
.light .import-textarea { background: rgba(255,255,255,0.5); }
.import-textarea:focus{border-color:var(--accent); box-shadow: 0 0 0 3px rgba(108,99,255,0.1);}
.import-hint{font-size:11.5px;color:var(--sub);margin-bottom:12px;line-height:1.5;
  background:rgba(255,255,255,0.03);border-radius:12px;padding:12px 14px;border:1px solid var(--border);}
.import-hint code{color:var(--a-green);font-size:11px;}

.import-btn{width:100%;padding:14px;background:rgba(255,255,255,0.05);
  border:1px solid var(--border-bright);color:var(--text);
  font-weight:700;font-size:14px;border-radius:16px;cursor:pointer;
  transition:all .3s;font-family:var(--font-body);}
.import-btn:hover{border-color:var(--accent);color:#fff;background:var(--accent); box-shadow: 0 6px 20px rgba(108,99,255,0.3);}
.import-btn:active{transform:scale(.97);}

/* ‚îÄ‚îÄ DANGER ZONE ‚îÄ‚îÄ */
.danger-card{background:linear-gradient(135deg,rgba(255,59,48,0.08),transparent);border:1px solid rgba(255,59,48,0.3);border-radius:24px;padding:24px;margin-bottom:14px;margin-top:24px; backdrop-filter:blur(10px);}
.danger-title{font-size:12px;font-weight:800;color:#FF4D6D;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:16px;}
.btn-danger{width:100%;padding:14px;border-radius:14px;border:1px solid rgba(255,59,48,0.4);background:rgba(255,59,48,0.05);color:#FF4D6D;font-family:var(--font-body);font-weight:700;font-size:14px;cursor:pointer;transition:all .3s;margin-bottom:10px;}
.btn-danger:hover{background:rgba(255,59,48,0.15);border-color:#FF4D6D; transform:translateY(-2px); box-shadow: 0 4px 12px rgba(255,59,48,0.2);}
.btn-danger:active{transform:scale(0.97);}
.btn-warning{color:#FF9F0A; border-color:rgba(255,159,10,0.4); background:rgba(255,159,10,0.05);}
.btn-warning:hover{background:rgba(255,159,10,0.15); border-color:#FF9F0A; box-shadow: 0 4px 12px rgba(255,159,10,0.2);}

/* ‚îÄ‚îÄ QUICK ADD FORM ‚îÄ‚îÄ */
.quick-form{display:flex;flex-direction:column;gap:12px;position:relative;background:var(--card); backdrop-filter:blur(16px); border:1px solid var(--border);padding:20px;border-radius:24px;}
.quick-form input{
  background:rgba(0,0,0,0.2);border:1px solid var(--border);color:var(--text);
  border-radius:14px;padding:14px 16px;font-family:var(--font-body);
  font-size:14px;outline:none;width:100%;transition:all .3s;}
.light .quick-form input { background: rgba(255,255,255,0.5); }
.quick-form input::placeholder{color:var(--sub);}
.quick-form input:focus{border-color:var(--accent); box-shadow: 0 0 0 3px rgba(108,99,255,0.1);}
.qf-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}

.time-label-row{display:flex;align-items:center;gap:12px;
  background:rgba(0,0,0,0.2);border:1px solid var(--border);border-radius:14px;
  padding:14px 16px;cursor:pointer;transition:all .3s; position:relative;}
.light .time-label-row { background: rgba(255,255,255,0.5); }
.time-label-row:focus-within{border-color:var(--accent); box-shadow: 0 0 0 3px rgba(108,99,255,0.1);}
.time-icon{font-size:18px;flex-shrink:0;}
.time-input-wrapper{flex:1;display:flex;flex-direction:column;gap:2px;}
.time-label-text{font-size:10px;color:var(--sub);text-transform:uppercase;letter-spacing:0.5px;font-weight:700;}
.time-display{font-size:14px;font-weight:700;color:var(--text);}
.time-real-input{position:absolute;opacity:0;width:1px;height:1px;left:0;}

/* ‚îÄ‚îÄ AUTOCOMPLETE ‚îÄ‚îÄ */
.autocomplete-items {
  position:absolute;top:calc(100% + 8px);left:0;right:0;
  z-index:1000;max-height:260px;overflow-y:auto;
  display:none;flex-direction:column;gap:8px;
  background:var(--card); backdrop-filter:blur(25px); border:1px solid var(--border-bright);
  border-radius:20px;box-shadow:0 15px 40px rgba(0,0,0,0.6);
  padding:12px;
}
.autocomplete-items::-webkit-scrollbar{width:4px;}
.autocomplete-items::-webkit-scrollbar-thumb{background:var(--border-bright);border-radius:4px;}

.ac-card{
  background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:14px;
  padding:14px 16px;cursor:pointer;transition:all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  display:flex;justify-content:space-between;align-items:center;gap:12px;
}
.ac-card:hover{border-color:var(--accent);background:rgba(108,99,255,0.1);transform:translateY(-2px); box-shadow: 0 4px 12px rgba(108,99,255,0.1);}
.ac-card:active{transform:scale(0.98);}
.ac-info{display:flex;flex-direction:column;gap:8px;flex:1;overflow:hidden;}
.ac-title-row{display:flex;align-items:center;gap:10px;}
.ac-title{font-size:1rem;font-weight:800;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.ac-type-badge{font-size:0.65rem;font-weight:800;text-transform:uppercase;letter-spacing:0.8px;
  background:rgba(108,99,255,0.15);color:var(--accent);padding:4px 10px;border-radius:8px;width:fit-content;}
.ac-stats{display:flex;flex-direction:column;align-items:flex-end;flex-shrink:0;}
.ac-cal{font-family:var(--font-head);font-size:1.25rem;font-weight:900;color:var(--text);}
.ac-unit{font-size:0.75rem;color:var(--sub);font-weight:600;margin-top:2px;}

/* ‚ïê‚ïê‚ïê MEALS PAGE ‚ïê‚ïê‚ïê */
.mini-cal{background:var(--card); backdrop-filter:blur(20px); border:1px solid var(--border);
  border-radius:24px;padding:18px 22px;margin-bottom:20px;
  display:flex;justify-content:space-between;align-items:center; box-shadow: var(--glass-shadow);}
.mc-num{font-family:var(--font-head);font-size:32px;font-weight:900;color:var(--accent); line-height:1.1; --glow-color: rgba(108,99,255,0.4); animation: depthFloat 4s ease-in-out infinite; display:inline-block;}
.mc-lbl{font-size:12px;color:var(--sub); font-weight:600;}
.meal-list{display:flex;flex-direction:column;gap:14px;}

/* ‚îÄ‚îÄ MEAL CARD ‚îÄ‚îÄ */
.meal-card{
  background:var(--card2); backdrop-filter:blur(16px); border:1px solid var(--border);border-radius:24px;
  position:relative;overflow:hidden;padding-left:6px;
  transition:all .4s cubic-bezier(.16,1,.3,1);
  box-shadow:0 6px 20px rgba(0,0,0,0.15);animation:fadeUp .5s cubic-bezier(0.16, 1, 0.3, 1) both;
}
.meal-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:6px;
  background:var(--accent-color,var(--border));border-radius:6px 0 0 6px;}
.meal-card:hover{transform:translateY(-3px);border-color:rgba(255,255,255,0.15); box-shadow:0 12px 30px rgba(0,0,0,0.3);}
.meal-card.checked{opacity:.4;filter:grayscale(.8);}
.meal-card.highlight{
  border-color:var(--accent-color) !important;
  box-shadow:0 0 0 1px var(--accent-color),0 10px 40px rgba(var(--accent-rgb),.25) !important;
  transform: scale(1.02);
}
.next-badge{display:none;position:absolute;top:0;right:64px;
  background:var(--accent-color);color:#000;font-size:9.5px;
  font-weight:900;padding:6px 14px;border-bottom-left-radius:12px;
  border-bottom-right-radius:12px;text-transform:uppercase;letter-spacing:1px;z-index:10;}
.meal-card.highlight .next-badge{display:block;}
.mc-content{padding:20px;position:relative;}
.mc-top{display:flex;align-items:center;margin-bottom:10px;gap:10px;padding-right:50px;}
.mc-time{color:var(--accent-color);font-weight:800;font-size:.8rem;text-transform:uppercase;letter-spacing:1px;flex-shrink:0;}
.mc-cal{background:rgba(128,128,128,.15);color:var(--text);padding:5px 12px;
  border-radius:10px;font-weight:700;font-size:.75rem;border:1px solid var(--border);flex-shrink:0;}
.mc-title{font-size:1.25rem;font-weight:800;color:var(--text);margin-bottom:16px;
  letter-spacing:-.3px;line-height:1.3;padding-right:50px;}
.ing-row{display:flex;justify-content:space-between;align-items:center;
  margin-bottom:10px;padding-bottom:10px;border-bottom:1px solid rgba(255,255,255,0.05);gap:12px;}
.ing-row:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0;}
.ing-left{display:flex;align-items:center;color:var(--text);font-size:.9rem;font-weight:500;flex:1;}
.ing-bullet{width:6px;height:6px;border-radius:50%;
  background:var(--accent-color);margin-right:12px;opacity:.8;flex-shrink:0; box-shadow: 0 0 8px var(--accent-color);}
.ing-tag{background:rgba(255,255,255,0.05);font-weight:700;font-size:.75rem;
  padding:5px 12px;border-radius:10px;border:1px solid var(--border);color:var(--sub);white-space:nowrap;}
.mchk{position:absolute;top:18px;right:18px;width:38px;height:38px;
  border-radius:50%;border:2px solid var(--border);background:rgba(0,0,0,0.2);
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  transition:all .4s cubic-bezier(.34,1.56,.64,1);font-size:1.1rem;
  color:transparent;user-select:none;z-index:20;}
.mchk:active{transform:scale(.8);}
.mchk.on{background:var(--a-green);border-color:var(--a-green);color:#000;box-shadow:0 0 25px rgba(0,229,160,.5);animation:checkPop .4s cubic-bezier(.34,1.56,.64,1);}
.empty-state{text-align:center;padding:50px 20px;color:var(--sub);}
.empty-icon{font-size:64px;margin-bottom:16px;opacity:.8; filter: drop-shadow(0 10px 10px rgba(0,0,0,0.2));}
.btn-main{width:100%;padding:16px;border:none;border-radius:20px;
  font-family:var(--font-body);font-weight:800;font-size:15px;cursor:pointer;
  color:#fff;transition:all .3s cubic-bezier(.34,1.56,.64,1);
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  box-shadow:0 8px 25px rgba(108,99,255,0.4);}
.btn-main:hover{transform:translateY(-3px);box-shadow:0 12px 35px rgba(108,99,255,0.6);}
.btn-main:active{transform:scale(.96);}

/* ‚îÄ‚îÄ DELETE MEAL BTN ‚îÄ‚îÄ */
.del-meal{position:absolute;bottom:16px;right:18px;width:30px;height:30px;
  border-radius:50%;border:1px solid var(--border);background:rgba(0,0,0,0.2);
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  font-size:13px;color:var(--sub);transition:all .3s;z-index:21;}
.del-meal:hover{border-color:#FF4D6D;color:#FF4D6D;background:rgba(255,77,109,0.15); transform:scale(1.1);}

/* ‚ïê‚ïê‚ïê NO MAIDA PAGE ‚ïê‚ïê‚ïê */
.btn-mark{width:100%;padding:18px;border-radius:22px;border:2px solid rgba(255,215,0,0.3);
  cursor:pointer;font-family:var(--font-head);font-size:18px;font-weight:900;
  background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(255,165,0,0.1));color:var(--gold);
  transition:all .4s cubic-bezier(.34,1.56,.64,1); backdrop-filter:blur(10px);}
.btn-mark:hover{background:linear-gradient(135deg,rgba(255,215,0,0.2),rgba(255,165,0,0.2));transform:translateY(-4px);box-shadow:0 12px 35px rgba(255,215,0,0.3); border-color:var(--gold);}
.btn-mark:active{transform:scale(0.96);}
.btn-mark.marked{border-color:var(--gold);background:linear-gradient(135deg,rgba(255,215,0,0.25),rgba(255,165,0,0.25)); box-shadow:0 0 20px rgba(255,215,0,0.4);}
.chips{display:flex;flex-wrap:wrap;gap:10px;margin-top:16px;}
.chip{background:rgba(255,215,0,0.08);border:1px solid rgba(255,215,0,0.3);border-radius:12px;padding:8px 14px;font-size:12px;color:var(--gold);font-weight:700;}

/* ‚ïê‚ïê‚ïê HISTORY PAGE ‚ïê‚ïê‚ïê */
.h-card{background:var(--card2); backdrop-filter:blur(16px); border:1px solid var(--border);border-radius:24px;
  padding:22px;margin-bottom:16px;position:relative;overflow:hidden;animation:fadeUp .5s cubic-bezier(0.16, 1, 0.3, 1) both; box-shadow: var(--glass-shadow);}
.h-card::before{content:'';position:absolute;top:-50px;right:-50px;width:140px;height:140px;
  border-radius:50%;background:radial-gradient(rgba(108,99,255,0.15),transparent);pointer-events:none;}
.h-date{font-family:var(--font-head);font-size:17px;font-weight:900; margin-bottom:14px; letter-spacing:-0.3px;}
.h-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:16px 0;}
.h-stat{background:rgba(0,0,0,0.2);border-radius:16px;padding:16px 12px;border:1px solid var(--border); text-align:center;}
.light .h-stat { background:rgba(255,255,255,0.5); }
.h-sn{font-family:var(--font-head);font-size:28px;font-weight:900;}
.h-sl{font-size:10.5px;color:var(--sub);text-transform:uppercase;letter-spacing:1px;margin-top:4px; font-weight:700;}
.h-badge{position:absolute;top:18px;right:18px;font-size:26px; filter:drop-shadow(0 4px 6px rgba(255,215,0,0.4));}
.h-empty{text-align:center;padding:80px 20px;color:var(--sub);}
.h-empty-icon{font-size:64px;margin-bottom:16px; opacity:0.8; filter: drop-shadow(0 10px 10px rgba(0,0,0,0.2));}

/* ‚îÄ‚îÄ WEIGHT TRACKER ‚îÄ‚îÄ */
.weight-tracker-card{background:var(--card); backdrop-filter:blur(20px); border:1px solid var(--border);
  border-radius:24px;padding:24px;margin-bottom:16px;animation:fadeUp .5s cubic-bezier(0.16, 1, 0.3, 1) both; box-shadow: var(--glass-shadow);}
.weight-entry-row{display:flex;gap:12px;margin-top:16px;}
.weight-input{flex:1;background:rgba(0,0,0,0.2);border:1px solid var(--border);
  color:var(--text);border-radius:16px;padding:16px;
  font-family:var(--font-body);font-size:15px;font-weight:800;outline:none;transition:all .3s;}
.light .weight-input { background:rgba(255,255,255,0.5); }
.weight-input:focus{border-color:var(--accent); box-shadow: 0 0 0 3px rgba(108,99,255,0.1);}
.weight-log-btn{padding:16px 22px;border:none;border-radius:16px;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:#fff;font-weight:800;font-size:15px;cursor:pointer;transition:all .3s cubic-bezier(.34,1.56,.64,1);
  font-family:var(--font-body);white-space:nowrap; box-shadow: 0 6px 20px rgba(108,99,255,0.3);}
.weight-log-btn:hover{transform:translateY(-3px);box-shadow:0 10px 25px rgba(108,99,255,0.5);}
.weight-log-btn:active{transform:scale(.96);}
.weight-history-list{margin-top:16px;display:flex;flex-direction:column;gap:10px;}
.weight-entry{display:flex;justify-content:space-between;align-items:center;
  background:rgba(255,255,255,0.03);border:1px solid var(--border);
  border-radius:16px;padding:14px 18px; transition:transform 0.2s;}
.weight-entry:hover{transform:translateY(-2px); border-color:rgba(255,255,255,0.1); background:rgba(255,255,255,0.05);}
.we-date{font-size:12px;color:var(--sub); font-weight:600;}
.we-val{font-family:var(--font-head);font-size:18px;font-weight:900;}
.we-diff{font-size:11.5px;font-weight:800;padding:4px 10px;border-radius:10px;}
.we-down{color:var(--a-green);background:rgba(0,229,160,0.1); border:1px solid rgba(0,229,160,0.2);}
.we-up{color:#FF4D6D;background:rgba(255,77,109,0.1); border:1px solid rgba(255,77,109,0.2);}
.we-same{color:var(--sub);background:rgba(255,255,255,0.05); border:1px solid var(--border);}
.weight-goal-bar{margin-top:18px;}
.wg-label{display:flex;justify-content:space-between;font-size:12px;color:var(--sub);margin-bottom:8px; font-weight:600;}
.current-wt-big{
  font-family:var(--font-head);font-size:46px;font-weight:900;
  background:linear-gradient(135deg,var(--accent),var(--water));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  --glow-color: rgba(41,182,246,0.3); animation: depthFloat 4.5s ease-in-out infinite; display:inline-block;
}
.target-info{font-size:13px;color:var(--sub);margin-top:8px; font-weight:500;}
.to-go{color:var(--a-green);font-weight:800;}

/* ‚ïê‚ïê‚ïê STRATEGY PAGE ‚ïê‚ïê‚ïê */
.memo-intro{font-size:14px;margin-bottom:24px;color:var(--sub);line-height:1.6; font-weight:500;}
.docket-card{background:var(--card2); backdrop-filter:blur(16px); border-radius:24px;margin-bottom:24px;padding:24px; box-shadow:var(--glass-shadow);}
.border-standard{border:1px solid var(--border);}
.border-green{border:1px solid rgba(0,229,160,0.3); background:linear-gradient(180deg, rgba(0,229,160,0.05), transparent 40%);}
.border-blue{border:1px solid rgba(41,182,246,0.3); background:linear-gradient(180deg, rgba(41,182,246,0.05), transparent 40%);}
.docket-header{font-family:var(--font-head);font-weight:900;font-size:15px;letter-spacing:0.5px;text-transform:uppercase;margin-bottom:16px;display:flex;align-items:center;gap:10px;}
.text-white{color:var(--text);}
.text-green{color:var(--a-green); text-shadow: 0 0 10px rgba(0,229,160,0.3);}
.text-blue{color:var(--water); text-shadow: 0 0 10px rgba(41,182,246,0.3);}
.docket-body-text{font-size:13.5px;color:var(--sub);margin-bottom:24px;line-height:1.6; font-weight:500;}
.highlight-text{color:var(--a-green);font-size:14px;font-weight:700;line-height:1.6;margin-bottom:20px;}
.week-container{border-top:1px dashed rgba(255,255,255,0.1);padding-top:20px;margin-top:12px;margin-bottom:20px;}
.week-title{font-size:15px;font-weight:800;color:var(--text);margin-bottom:14px;}
.comparison-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
.scenario-box{background:rgba(0,0,0,0.2);border:1px solid var(--border);border-radius:16px;padding:16px;}
.light .scenario-box { background:rgba(255,255,255,0.5); }
.scenario-title{font-size:11.5px;text-transform:uppercase;color:var(--sub);font-weight:800;margin-bottom:10px;border-bottom:1px solid var(--border);padding-bottom:8px; letter-spacing:0.5px;}
.data-line{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.data-line:last-child{margin-bottom:0;}
.data-label{font-size:11.5px;color:var(--sub);text-transform:uppercase; font-weight:600;}
.data-value{font-size:14px;font-weight:800;color:var(--text);}
.val-cal{color:var(--gold);}
.val-wt{color:var(--water);}
</style>
</head>
<body>

<div id="offlineBadge">üìµ OFFLINE</div>
<div id="toast"></div>

<div class="orb o1"></div>
<div class="orb o2"></div>
<div class="orb o3"></div>

<div id="home">
  <div class="hdr">
    <div class="hdr-top">
      <div>
        <div class="logo shimmer-text">80 KG</div>
        <div class="logo-date" id="hdrDate"></div>
      </div>
      <div class="hdr-right">
        <div class="streak-pill">
          <span class="s-fire">üî•</span>
          <div><div class="s-num" id="streakNum">0</div><div class="s-lbl">streak</div></div>
        </div>
        <button class="icon-btn" onclick="openPage('settingsPage')" title="Settings">‚öôÔ∏è</button>
      </div>
    </div>
  </div>

  <div class="content" style="padding:0 20px;">

    <div class="stats-bar" style="animation-delay:.02s">
      <div class="stat-pill card"><div class="stat-pill-num sp-cal" id="statAvgCal">‚Äî</div><div class="stat-pill-lbl">avg kcal</div></div>
      <div class="stat-pill card"><div class="stat-pill-num sp-water" id="statDaysLogged">0</div><div class="stat-pill-lbl">days logged</div></div>
      <div class="stat-pill card"><div class="stat-pill-num sp-streak"><span class="ni-trophy-icon">üèÜ</span> <span id="statMaida">0</span></div><div class="stat-pill-lbl">no maida</div></div>
    </div>

    <div class="quote-card" id="quoteCard" style="animation-delay:.03s">
      <div class="quote-text" id="quoteText"></div>
      <div class="quote-author" id="quoteAuthor"></div>
    </div>

    <div class="card" style="animation-delay:.04s">
      <div class="cal-row">
        <div>
          <div class="cal-big" id="calConsumed">0</div>
          <div class="cal-unit">kcal consumed today</div>
        </div>
        <div class="cal-right">
          <div class="cal-rem" id="calRemain">0</div>
          <div class="cal-rlbl">remaining</div>
          <div class="cal-rlbl" id="calTotalLbl" style="margin-top:6px;font-size:10.5px; opacity:0.8;"></div>
        </div>
      </div>
      <div class="pbar-wrap"><div class="pbar pb-cal" id="calBar" style="width:0%"></div></div>
      <div class="plabel"><span>0</span><span id="calPct">0%</span><span id="calGoalLabel" onclick="editCalTarget()" style="cursor:pointer; text-decoration:underline; font-weight:700;" title="Edit Target">2800 kcal ‚úé</span></div>
    </div>

    <div class="card" style="animation-delay:.09s">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <div class="sec-lbl" style="margin-bottom:0;"><span class="water-emoji">üíß</span> Hydration</div>
        <div style="font-size:12px;color:var(--sub); font-weight:600;">Goal: 5000 ml</div>
      </div>
      <div class="water-big" id="waterAmt">0 ml</div>
      <div class="pbar-wrap" style="margin:16px 0 10px"><div class="pbar pb-water" id="waterBar" style="width:0%"></div></div>
      <div class="plabel"><span>0</span><span id="waterPct">0%</span><span>5000 ml</span></div>
      <div class="water-grid">
        <button class="water-btn" onclick="addWater(200)">+200<span>ml</span></button>
        <button class="water-btn" onclick="addWater(300)">+300<span>ml</span></button>
        <button class="water-btn" onclick="addWater(400)">+400<span>ml</span></button>
        <button class="water-btn" onclick="addWater(500)">+500<span>ml</span></button>
      </div>
      <button class="water-reset" onclick="resetWater()">‚Ü∫ Reset Water</button>
    </div>

    <div class="nav-card" style="animation-delay:.14s" onclick="openPage('mealsPage')">
      <div class="nav-icon ni-meals"><span class="ni-meals-icon">üçΩ</span></div>
      <div class="nav-info">
        <div class="nav-title" id="navMealTitle">Today's Meals</div>
        <div class="nav-sub" id="navMealSub">Tap to view &amp; track your meals</div>
      </div>
      <div class="nav-arrow">‚Ä∫</div>
    </div>

    <div class="nav-card" style="animation-delay:.16s" onclick="openPage('weightPage')">
      <div class="nav-icon" style="background:linear-gradient(135deg,#00E5A0,#29B6F6);">‚öñÔ∏è</div>
      <div class="nav-info">
        <div class="nav-title">Weight Tracker</div>
        <div class="nav-sub" id="weightNavSub">Log your daily weight</div>
      </div>
      <div class="nav-arrow">‚Ä∫</div>
    </div>

    <div class="nav-card" style="animation-delay:.18s" onclick="openPage('maidaPage')">
      <div class="nav-icon ni-maida"><span class="ni-trophy-icon">üèÜ</span></div>
      <div class="nav-info">
        <div class="nav-title">No Maida Days</div>
        <div class="nav-sub" id="maidaNavSub">Tap to mark &amp; view history</div>
      </div>
      <div style="font-family:var(--font-head);font-size:28px;font-weight:900;color:var(--gold);margin-right:4px; text-shadow:0 2px 10px rgba(255,215,0,0.3);" id="maidaCntMain">0</div>
      <div class="nav-arrow">‚Ä∫</div>
    </div>

    <div class="nav-card" style="animation-delay:.22s" onclick="openPage('historyPage')">
      <div class="nav-icon ni-history"><span class="ni-hist-icon">üìÖ</span></div>
      <div class="nav-info">
        <div class="nav-title">History</div>
        <div class="nav-sub" id="navHistSub">View past days &amp; your progress</div>
      </div>
      <div class="nav-arrow">‚Ä∫</div>
    </div>

    <div class="nav-card" style="animation-delay:.26s" onclick="openPage('strategyPage')">
      <div class="nav-icon" style="background:linear-gradient(135deg,var(--water),#0288D1);"><span class="ni-target-icon">üéØ</span></div>
      <div class="nav-info">
        <div class="nav-title">Milestone Strategy</div>
        <div class="nav-sub">Central Calorie Committee Updates</div>
      </div>
      <div class="nav-arrow">‚Ä∫</div>
    </div>

  </div>
</div>

<div class="page" id="mealsPage">
  <div class="page-inner">
    <div class="page-hdr">
      <button class="back-btn" onclick="closePage('mealsPage')">‚Üê</button>
      <div class="page-title" id="mealsPageTitle">Today's Meals</div>
    </div>
    <div class="page-scroll">
      <div class="pcontent">
        <div class="mini-cal">
          <div>
            <div class="mc-num" id="mp-cons">0</div>
            <div class="mc-lbl">kcal consumed</div>
          </div>
          <div style="text-align:right">
            <div class="mc-num" id="mp-rem" style="color:var(--accent2); --glow-color: rgba(255,101,132,0.4);">0</div>
            <div class="mc-lbl">remaining</div>
          </div>
        </div>
        <div class="sec-lbl">üçΩ Your Meal Plan</div>
        <div id="mealList" class="meal-list"></div>
        <div style="margin-top:32px;margin-bottom:32px;">
          <div class="sec-lbl">‚ö° Add Extra Food</div>
          <div class="import-hint" style="margin-bottom:12px;">Search your database. Enter weight to auto-calculate!</div>
          <div class="quick-form">
            <div class="time-label-row" onclick="document.getElementById('qTimeReal').showPicker()">
              <span class="time-icon">üïê</span>
              <div class="time-input-wrapper">
                <span class="time-label-text">Meal Time</span>
                <span class="time-display" id="timeDisplay">Tap to set time</span>
              </div>
              <input type="time" id="qTimeReal" class="time-real-input" oninput="updateTimeDisplay()" />
            </div>
            <div style="position:relative;">
              <input type="text" id="qName" placeholder="üîç Search food (e.g. Paneer, Oats)" oninput="searchFood()" autocomplete="off"/>
              <div id="autocomplete-list" class="autocomplete-items"></div>
            </div>
            <div class="qf-row">
              <input type="number" id="qWeight" placeholder="Weight (grams)" oninput="calcCals()"/>
              <input type="number" id="qCal" placeholder="Total kcal"/>
            </div>
            <button class="import-btn" style="margin-top:6px;" onclick="submitQuickMeal()">+ Add to Today's List</button>
          </div>
        </div>
        <button class="btn-main" id="saveBtn" onclick="saveToHistory()">üíæ Save Today's Progress</button>
      </div>
    </div>
  </div>
</div>

<div class="page" id="maidaPage">
  <div class="page-inner">
    <div class="page-hdr">
      <button class="back-btn" onclick="closePage('maidaPage')">‚Üê</button>
      <div class="page-title">No Maida Challenge</div>
    </div>
    <div class="page-scroll">
      <div class="pcontent">
        <div style="text-align:center;padding:40px 20px 40px;">
          <div style="font-size:80px;margin-bottom:16px;display:inline-block;animation:mPulse 3s ease-in-out infinite;">üèÜ</div>
          <div class="cal-big" id="maidaCntPage" style="color:var(--gold);font-size:72px;display:inline-block; --glow-color: rgba(255,215,0,0.5);">0</div>
          <div style="font-size:14px;color:var(--sub);margin-top:12px;font-weight:700;letter-spacing:1px;text-transform:uppercase;">Days of Clean Eating</div>
        </div>
        <button class="btn-mark" id="maidaBtn" onclick="markNoMaida()">‚úÖ Mark Today as No-Maida Day!</button>
        <div class="sec-lbl" style="margin-top:40px">Recent Milestones</div>
        <div class="chips" id="maidaChips"></div>
      </div>
    </div>
  </div>
</div>

<div class="page" id="historyPage">
  <div class="page-inner">
    <div class="page-hdr">
      <button class="back-btn" onclick="closePage('historyPage')">‚Üê</button>
      <div class="page-title">History</div>
    </div>
    <div class="page-scroll">
      <div class="pcontent">
        <div id="historyList"></div>
      </div>
    </div>
  </div>
</div>

<div class="page" id="weightPage">
  <div class="page-inner">
    <div class="page-hdr">
      <button class="back-btn" onclick="closePage('weightPage')">‚Üê</button>
      <div class="page-title">Weight Tracker</div>
    </div>
    <div class="page-scroll">
      <div class="pcontent">
        <div class="weight-tracker-card">
          <div class="sec-lbl" style="margin-bottom:8px">‚öñÔ∏è Current Weight</div>
          <div class="current-wt-big" id="currentWtDisplay">‚Äî kg</div>
          <div class="target-info">Target: <span class="to-go">80.0 kg</span> ¬∑ <span id="toGoKg" class="to-go">‚Äî kg to go</span></div>
          <div class="weight-goal-bar" id="wtGoalBarWrap" style="display:none">
            <div class="wg-label">
              <span>80 kg (goal)</span><span id="wtStartLbl">‚Äî</span>
            </div>
            <div class="pbar-wrap" style="height:12px"><div class="pbar" id="wtGoalBar" style="width:0%;background:linear-gradient(90deg,var(--a-green),var(--water));box-shadow:0 0 15px rgba(0,229,160,0.5);"></div></div>
          </div>
          <div class="weight-entry-row">
            <input type="number" step="0.1" class="weight-input" id="weightInput" placeholder="Enter weight in kg"/>
            <button class="weight-log-btn" onclick="logWeight()">üìå Log</button>
          </div>
        </div>
        <div class="sec-lbl">üìä Weight Log</div>
        <div class="weight-history-list" id="weightHistList"></div>
      </div>
    </div>
  </div>
</div>

<div class="page" id="strategyPage">
  <div class="page-inner">
    <div class="page-hdr">
      <button class="back-btn" onclick="closePage('strategyPage')">‚Üê</button>
      <div class="page-title">Milestone Strategy</div>
    </div>
    <div class="page-scroll">
      <div class="pcontent">
        <div class="memo-intro">This memorandum serves to provide the daily operational update regarding the final stage of your physical recomposition parameters, targeting exactly 80.0 kg by August 2026.</div>
        
        <div class="docket-card border-standard">
          <div class="docket-header text-white">üìà I. TRANSITION SUBMISSION &amp; REVIEW</div>
          <div class="docket-body-text">On February 23rd, for metabolic convenience and to streamline the deficit process, we are initiating Phase 1. This prevents immediate fatigue while generating initial water-weight drop.</div>
          <div class="week-container">
            <div class="week-title">Week 1 (Feb 23 ‚Äì Mar 1)</div>
            <div class="comparison-grid">
              <div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym (2 Hrs)</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,500 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">103.0 ‚ûî 102.0 kg</span></div></div>
              <div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,400 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">103.0 ‚ûî 101.5 kg</span></div></div>
            </div>
          </div>
          <div class="week-container">
            <div class="week-title">Week 2 (Mar 2 ‚Äì Mar 8)</div>
            <div class="comparison-grid">
              <div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym (2 Hrs)</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,500 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">102.0 ‚ûî 101.0 kg</span></div></div>
              <div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,400 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">101.5 ‚ûî 100.5 kg</span></div></div>
            </div>
          </div>
        </div>

        <div class="docket-card border-green">
          <div class="docket-header text-green">‚úÖ II. EVALUATION &amp; SCORING (MODERATE CUT)</div>
          <div class="docket-body-text">The Central Calorie Committee utilizes a strict scoring system to evaluate daily intake. In this system, failing to meet protein requirements indicates improper recovery.</div>
          <div class="highlight-text">We are highly pleased to inform you that maintaining this specific deficit zone will completely clear chest fat while retaining muscular structure with absolutely no flaws. Excellent work!</div>
          <div class="week-container"><div class="week-title">Week 3 (Mar 9 ‚Äì Mar 15)</div><div class="comparison-grid"><div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym (2 Hrs)</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,400 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">101.0 ‚ûî 100.0 kg</span></div></div><div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,100 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">100.5 ‚ûî 99.7 kg</span></div></div></div></div>
          <div class="week-container"><div class="week-title">Week 4 (Mar 16 ‚Äì Mar 22)</div><div class="comparison-grid"><div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym (2 Hrs)</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,300 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">100.0 ‚ûî 99.0 kg</span></div></div><div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,100 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">99.7 ‚ûî 98.9 kg</span></div></div></div></div>
          <div class="week-container"><div class="week-title">Week 5 (Mar 23 ‚Äì Mar 29)</div><div class="comparison-grid"><div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym (2 Hrs)</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,300 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">99.0 ‚ûî 98.0 kg</span></div></div><div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,100 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">98.9 ‚ûî 98.1 kg</span></div></div></div></div>
          <div class="week-container"><div class="week-title">Week 6 (Mar 30 ‚Äì Apr 5)</div><div class="comparison-grid"><div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym (2 Hrs)</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,300 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">98.0 ‚ûî 97.0 kg</span></div></div><div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,100 kcal</span></div><div class="data-line"><span class="data-label">Weight</span><span class="data-value val-wt">98.1 ‚ûî 97.3 kg</span></div></div></div></div>
        </div>

        <div class="docket-card border-blue">
          <div class="docket-header text-blue">üìå III. TARGET DEFICIT MILESTONES (FINAL STRETCH)</div>
          <div class="docket-body-text">Great work in compiling your routine. Because your primary adaptation is complete, you will now execute the final baseline deficit. The following parameters break down your final 21 weeks into monthly operational milestones to track the descent to exactly 80.0 kg.</div>
          <div class="week-container"><div class="week-title">Weeks 7 to 10 (Apr 6 ‚Äì May 3)</div><div class="comparison-grid"><div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym (2 Hrs)</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,200 kcal</span></div><div class="data-line"><span class="data-label">Month End Wt.</span><span class="data-value val-wt">97.0 ‚ûî 93.5 kg</span></div></div><div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">1,800 kcal</span></div><div class="data-line"><span class="data-label">Month End Wt.</span><span class="data-value val-wt">97.3 ‚ûî 93.8 kg</span></div></div></div></div>
          <div class="week-container"><div class="week-title">Weeks 11 to 14 (May 4 ‚Äì May 31)</div><div class="comparison-grid"><div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym (2 Hrs)</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,200 kcal</span></div><div class="data-line"><span class="data-label">Month End Wt.</span><span class="data-value val-wt">93.5 ‚ûî 90.0 kg</span></div></div><div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">1,800 kcal</span></div><div class="data-line"><span class="data-label">Month End Wt.</span><span class="data-value val-wt">93.8 ‚ûî 90.3 kg</span></div></div></div></div>
          <div class="week-container"><div class="week-title">Weeks 15 to 18 (Jun 1 ‚Äì Jun 28)</div><div class="comparison-grid"><div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym (2 Hrs)</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,200 kcal</span></div><div class="data-line"><span class="data-label">Month End Wt.</span><span class="data-value val-wt">90.0 ‚ûî 86.5 kg</span></div></div><div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">1,800 kcal</span></div><div class="data-line"><span class="data-label">Month End Wt.</span><span class="data-value val-wt">90.3 ‚ûî 86.8 kg</span></div></div></div></div>
          <div class="week-container"><div class="week-title">Weeks 19 to 22 (Jun 29 ‚Äì Jul 26)</div><div class="comparison-grid"><div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym (2 Hrs)</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,200 kcal</span></div><div class="data-line"><span class="data-label">Month End Wt.</span><span class="data-value val-wt">86.5 ‚ûî 83.0 kg</span></div></div><div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">1,800 kcal</span></div><div class="data-line"><span class="data-label">Month End Wt.</span><span class="data-value val-wt">86.8 ‚ûî 83.3 kg</span></div></div></div></div>
          <div class="week-container"><div class="week-title">Weeks 23 to 27 (Jul 27 ‚Äì Aug 30)</div><div class="comparison-grid"><div class="scenario-box"><div class="scenario-title">üèãÔ∏è With Gym (2 Hrs)</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">2,200 kcal</span></div><div class="data-line"><span class="data-label">Final Target Wt.</span><span class="data-value val-wt" style="color:var(--a-green);">83.0 ‚ûî 80.0 kg</span></div></div><div class="scenario-box"><div class="scenario-title">üè† No Gym</div><div class="data-line"><span class="data-label">Intake</span><span class="data-value val-cal">1,800 kcal</span></div><div class="data-line"><span class="data-label">Final Target Wt.</span><span class="data-value val-wt" style="color:var(--a-green);">83.3 ‚ûî 80.0 kg</span></div></div></div></div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="page" id="settingsPage">
  <div class="page-inner">
    <div class="page-hdr">
      <button class="back-btn" onclick="closePage('settingsPage')">‚Üê</button>
      <div class="page-title">Settings &amp; Tools</div>
    </div>
    <div class="page-scroll">
      <div class="pcontent">
        <div class="card" style="margin-bottom:14px">
          <div class="tog-row">
            <span class="tog-lbl" id="togLbl">üåô Night Mode</span>
            <button class="tog on" id="togBtn" onclick="toggleTheme()">
              <div class="tog-knob"></div>
            </button>
          </div>
        </div>

        <div class="import-box" style="border-color:var(--a-green);">
          <h3 style="color:var(--a-green);">üíæ Backup Your Data</h3>
          <p>Download your complete History, Weight Log, Food DB, and Plan securely to your device.</p>
          <button class="import-btn" style="border-color:var(--a-green); color:var(--a-green);" onclick="exportData()">‚¨á Download JSON Backup</button>
        </div>

        <div class="import-box">
          <div class="import-tabs">
            <button class="imp-tab active" id="tab-plan" onclick="switchTab('plan')">Daily Plan</button>
            <button class="imp-tab" id="tab-db" onclick="switchTab('db')">Food DB</button>
          </div>
          <div id="panel-plan">
            <div class="import-hint">Paste your structured meal JSON array below.</div>
            <textarea id="importPlanArea" class="import-textarea"
              placeholder='[{ "time":"08:00 AM", "name":"Breakfast", "calories":320, "items":[{"food":"Oats","weight":"80g"}] }]'></textarea>
            <button class="import-btn" onclick="importPlanData()">‚¨Ü Import Plan</button>
          </div>
          <div id="panel-db" style="display:none;">
            <div class="import-hint">
              Paste your JSON array below. Only valid JSON arrays are accepted.<br>
              Format: <code>[{"n":"Food Name","c":100,"g":100,"type":"sabji"}]</code>
            </div>
            <textarea id="importDbArea" class="import-textarea"
              placeholder='[{ "n": "Palak Paneer", "c": 221, "g": 100, "type": "sabji", "unit": "100g cooked" }]'></textarea>
            <button class="import-btn" onclick="importFoodDB()">üíæ Save Food Database</button>
            <div id="dbStatusText" style="margin-top:10px;font-size:12px;color:var(--sub);text-align:center;"></div>
          </div>
        </div>

        <div class="danger-card">
          <div class="danger-title">‚ö†Ô∏è Danger Zone</div>
          <button class="btn-danger btn-warning" onclick="resetTodayData()">üßπ Reset Today's Meals & Data</button>
          <button class="btn-danger" onclick="hardResetApp()">üí• Hard Reset ‚Äî Delete All Data</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* ‚ïê‚ïê‚ïê HAPTIC FEEDBACK ‚ïê‚ïê‚ïê */
function triggerHaptic(ms = 40) {
  if (typeof navigator !== 'undefined' && navigator.vibrate) navigator.vibrate(ms);
}

/* ‚ïê‚ïê‚ïê OFFLINE ‚ïê‚ïê‚ïê */
function updateOnlineStatus(){
  const badge = document.getElementById('offlineBadge');
  if(badge) badge.style.display = navigator.onLine ? 'none' : 'block';
}
window.addEventListener('online', updateOnlineStatus);
window.addEventListener('offline', updateOnlineStatus);
updateOnlineStatus();

/* ‚ïê‚ïê‚ïê HELPERS & TIMEZONE FIX ‚ïê‚ïê‚ïê */
const ls    = (k,fb) => { try{ const v=localStorage.getItem(k); return v!=null?JSON.parse(v):fb; }catch{ return fb; } };
const lsSet = (k,v)  => { try{ localStorage.setItem(k,JSON.stringify(v)); }catch{} };

// Lock to local timezone so midnight works perfectly in India
const todayKey = () => {
  const d = new Date();
  d.setMinutes(d.getMinutes() - d.getTimezoneOffset());
  return d.toISOString().split("T")[0];
};

const DOW = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
const PALETTE = ['#FF4D6D','#00D4FF','#FF9F0A','#C77DFF','#00E5A0','#4D9EFF'];

function hexToRgb(h){
  const r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(h);
  return r?`${parseInt(r[1],16)},${parseInt(r[2],16)},${parseInt(r[3],16)}`:'108,99,255';
}
function parseTimeMins(val){
  if(!val) return 0;
  let c=val.toLowerCase().replace(/\s+/g,'');
  const pm=c.includes('pm'), am=c.includes('am');
  const m=c.match(/(\d+):(\d+)/);
  if(!m) return 0;
  let h=parseInt(m[1]), min=parseInt(m[2]);
  if(pm&&h!==12) h+=12; if(am&&h===12) h=0;
  return h*60+min;
}

function safeParseJSON(raw) {
  const trimmed = raw.trim();
  const start = trimmed.indexOf('[');
  const end = trimmed.lastIndexOf(']');
  if (start === -1 || end === -1 || end <= start) throw new Error("No valid JSON array found.");
  return JSON.parse(trimmed.substring(start, end + 1));
}

/* ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê */
let _toastTimer;
function showToast(msg, color='var(--a-green)'){
  const el=document.getElementById('toast');
  if(!el) return;
  el.textContent=msg; el.style.color=color;
  el.classList.add('show');
  clearTimeout(_toastTimer);
  _toastTimer=setTimeout(()=>el.classList.remove('show'),2800);
}

/* ‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê */
let dark       = ls("np_dark", true);
let streak     = ls("np_streak", 0);
let lastVis    = ls("np_lastvisit", "");
let weeklyPlan = ls("np_weeklyPlan", {});
let meals      = ls("np_meals", []);
let allChk     = ls("np_checked", {});
let allWater   = ls("np_water", {});
let noMaida    = ls("np_nomaida", []);
let appHistory = ls("np_history", {});
let foodDB     = ls("np_foodDB", []);
let calTarget  = ls("np_calTarget", 2800);
let lastLoadDate = ls("np_lastLoadDate", "");
let weightLog  = ls("np_weightLog", []);

const getChk   = () => allChk[todayKey()] || {};
const getWater = () => allWater[todayKey()] || 0;
const setChk   = v => { allChk[todayKey()]=v; lsSet("np_checked",allChk); };
const setWater = v => { allWater[todayKey()]=v; lsSet("np_water",allWater); };

/* ‚ïê‚ïê‚ïê DATA BACKUP ‚ïê‚ïê‚ïê */
function exportData() {
  triggerHaptic(30);
  const data = {
    appHistory, weightLog, foodDB, noMaida, 
    weeklyPlan, meals, calTarget, streak, lastVis
  };
  const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data, null, 2));
  const downloadAnchorNode = document.createElement('a');
  downloadAnchorNode.setAttribute("href", dataStr);
  downloadAnchorNode.setAttribute("download", "80kg_backup_" + todayKey() + ".json");
  document.body.appendChild(downloadAnchorNode); 
  downloadAnchorNode.click();
  downloadAnchorNode.remove();
  showToast("‚úÖ Backup Downloaded!");
}

/* ‚ïê‚ïê‚ïê CLEAN DUAL RESET ‚ïê‚ïê‚ïê */
function resetTodayData() {
  triggerHaptic([30, 50]);
  if(confirm("üßπ Reset today's meals, calories, and water?\n\n(Your DB and History remain safe)")){
    allChk[todayKey()] = {};
    allWater[todayKey()] = 0;
    lsSet("np_checked", allChk);
    lsSet("np_water", allWater);
    
    delete appHistory[todayKey()];
    lsSet("np_history", appHistory);
    
    meals = [];
    lsSet("np_meals", meals);
    lsSet("np_lastLoadDate", ""); 
    
    loadDailyPlan();
    renderHome();
    closePage('settingsPage');
    showToast("‚úÖ Today's data reset.");
  }
}

function hardResetApp(){
  triggerHaptic([50, 100, 50]);
  if(confirm("üí• Delete ALL data forever? This cannot be undone.")){
    localStorage.clear(); location.reload();
  }
}

/* ‚ïê‚ïê‚ïê QUOTES ‚ïê‚ïê‚ïê */
const QUOTES = [
  { text:"The body achieves what the mind believes.", author:"‚Äî Unknown" },
  { text:"Discipline is the bridge between goals and accomplishment.", author:"‚Äî Jim Rohn" },
  { text:"Your body can stand almost anything. It's your mind you have to convince.", author:"‚Äî Unknown" },
  { text:"Small daily improvements are the key to staggering long-term results.", author:"‚Äî Unknown" },
  { text:"Take care of your body. It's the only place you have to live.", author:"‚Äî Jim Rohn" },
  { text:"Every workout is progress. Every meal is a choice.", author:"‚Äî 80 KG HQ" },
  { text:"The secret of getting ahead is getting started.", author:"‚Äî Mark Twain" },
  { text:"Success is the sum of small efforts, repeated day in and day out.", author:"‚Äî Robert Collier" }
];
function renderQuote(){
  const idx = new Date().getDate() % QUOTES.length;
  const q = QUOTES[idx];
  const qt = document.getElementById('quoteText');
  const qa = document.getElementById('quoteAuthor');
  if(qt) qt.textContent = `"${q.text}"`;
  if(qa) qa.textContent = q.author;
}

/* ‚ïê‚ïê‚ïê DYNAMIC STREAK ‚ïê‚ïê‚ïê */
function updateStreak(){
  const t = new Date().toDateString();
  if (lastVis !== t) {
    const yest = new Date(); yest.setDate(yest.getDate() - 1);
    if (lastVis === "") streak = 1;
    else if (lastVis === yest.toDateString()) streak++;
    else streak = 1;
    lastVis = t;
    lsSet("np_streak", streak);
    lsSet("np_lastvisit", lastVis);
  }
  
  const fireEl = document.querySelector('.s-fire');
  if (fireEl) {
    const extraSize = Math.min(streak * 0.8, 14); 
    const speed = Math.max(0.6, 1.6 - (streak * 0.05)); 
    fireEl.style.fontSize = (22 + extraSize) + 'px';
    fireEl.style.animationDuration = speed + 's';
  }
}

let _lk=todayKey();
setInterval(()=>{ if(todayKey()!==_lk){ _lk=todayKey(); loadDailyPlan(); renderHome(); } },30000);

/* ‚ïê‚ïê‚ïê THEME ‚ïê‚ïê‚ïê */
function applyTheme(){
  document.body.classList.toggle("light",!dark);
  const b=document.getElementById("togBtn"), l=document.getElementById("togLbl");
  if(b) b.classList.toggle("on",dark);
  if(l) l.textContent=dark?"üåô Night Mode":"‚òÄÔ∏è Day Mode";
}
function toggleTheme(){ triggerHaptic(20); dark=!dark; lsSet("np_dark",dark); applyTheme(); }

/* ‚ïê‚ïê‚ïê PAGE NAVIGATION ‚ïê‚ïê‚ïê */
function openPage(id){
  triggerHaptic(20);
  const page = document.getElementById(id);
  if(page) page.classList.add("active");
  if(id==="mealsPage")   { renderMeals(); setTimeout(scrollToNextMeal,350); }
  if(id==="historyPage")   renderHistory();
  if(id==="maidaPage")     renderNoMaida();
  if(id==="weightPage")    renderWeightPage();
}
function closePage(id){ 
  triggerHaptic(20); 
  const page = document.getElementById(id);
  if(page) page.classList.remove("active"); 
}

/* ‚ïê‚ïê‚ïê TAB SWITCHING ‚ïê‚ïê‚ïê */
function switchTab(tab){
  triggerHaptic(15);
  ['plan','db'].forEach(t => {
    const elTab = document.getElementById(`tab-${t}`);
    const elPan = document.getElementById(`panel-${t}`);
    if(elTab) elTab.classList.toggle('active', tab===t);
    if(elPan) elPan.style.display = (tab===t) ? 'block' : 'none';
  });
  if(tab==='db'){
    const dbTxt = document.getElementById('dbStatusText');
    if(dbTxt) dbTxt.textContent = `Current DB Size: ${foodDB.length} items`;
  }
}

/* ‚ïê‚ïê‚ïê WATER ‚ïê‚ïê‚ïê */
function addWater(ml){ triggerHaptic(30); setWater(Math.min(getWater()+ml,6000)); updateWaterUI(); }
function resetWater(){
  if(!confirm("Reset today's water intake to 0?")) return;
  triggerHaptic(40);
  setWater(0); updateWaterUI();
}
function updateWaterUI(){
  const w=getWater(), pct=Math.min(w/5000*100,100);
  const wAmt = document.getElementById("waterAmt");
  const wBar = document.getElementById("waterBar");
  const wPct = document.getElementById("waterPct");
  if(wAmt) wAmt.textContent=w+" ml";
  if(wBar) wBar.style.width=pct+"%";
  if(wPct) wPct.textContent=Math.round(pct)+"%";
}

/* ‚ïê‚ïê‚ïê TIME DISPLAY ‚ïê‚ïê‚ïê */
function updateTimeDisplay(){
  const inputEl = document.getElementById('qTimeReal');
  const disp = document.getElementById('timeDisplay');
  if(!inputEl || !disp) return;
  const val = inputEl.value;
  if(!val){ disp.textContent = 'Tap to set time'; return; }
  const [hh,mm] = val.split(':');
  let h=parseInt(hh), ap=h>=12?'PM':'AM';
  if(h>12) h-=12; if(h===0) h=12;
  disp.textContent = `${h}:${mm} ${ap}`;
}
function setDefaultTime(){
  const now = new Date();
  const hh = String(now.getHours()).padStart(2,'0');
  const mm = String(now.getMinutes()).padStart(2,'0');
  const timeInput = document.getElementById('qTimeReal');
  if(timeInput){
    timeInput.value = `${hh}:${mm}`;
    updateTimeDisplay();
  }
}

/* ‚ïê‚ïê‚ïê FOOD DATABASE ‚ïê‚ïê‚ïê */
function importFoodDB(){
  const raw = document.getElementById('importDbArea').value.trim();
  if(!raw){ showToast("Paste database code first","var(--a-red)"); return; }
  try{
    const parsed = safeParseJSON(raw);
    if(!Array.isArray(parsed)){ showToast("‚ùå Format must be an array","var(--a-red)"); return; }
    const valid = parsed.filter(i => i.n && i.c !== undefined && i.g !== undefined);
    if(valid.length === 0){ showToast("‚ùå Ensure objects have {n:'Name', c:100, g:100}","var(--a-red)"); return; }
    foodDB = valid;
    lsSet("np_foodDB", foodDB);
    document.getElementById('importDbArea').value = '';
    const dbTxt = document.getElementById('dbStatusText');
    if(dbTxt) dbTxt.textContent = `‚úÖ Success! DB Size: ${foodDB.length} items`;
    showToast(`‚úÖ Saved ${foodDB.length} foods!`);
    triggerHaptic([30, 50, 30]);
  } catch(e) { showToast("‚ùå Invalid JSON ‚Äî check your format","var(--a-red)"); }
}

/* ‚ïê‚ïê‚ïê AUTOCOMPLETE ‚ïê‚ïê‚ïê */
let currentBaseCal = 0;
let currentBaseWeight = 0;

function searchFood() {
  const inputEl = document.getElementById('qName');
  if(!inputEl) return;
  const val = inputEl.value.toLowerCase();
  const list = document.getElementById('autocomplete-list');
  list.innerHTML = '';
  if (!val) { list.style.display = 'none'; return; }
  let matches = foodDB.filter(f => f.n.toLowerCase().includes(val));
  matches.sort((a, b) => {
    const aS = a.n.toLowerCase().startsWith(val);
    const bS = b.n.toLowerCase().startsWith(val);
    if (aS && !bS) return -1; if (!aS && bS) return 1;
    return a.n.localeCompare(b.n);
  });
  if (matches.length === 0) { list.style.display = 'none'; return; }
  matches.forEach(match => {
    const card = document.createElement('div');
    card.className = 'ac-card';
    const displayUnit = match.unit ? match.unit : `${match.g}g`;
    const displayType = match.type ? `<div class="ac-type-badge">${match.type}</div>` : '';
    let icon = 'üçΩÔ∏è';
    if(match.type === 'sabji')  icon = 'üç≤';
    if(match.type === 'sweet')  icon = 'üßÅ';
    if(match.type === 'street') icon = 'üåÆ';
    if(match.type === 'roti')   icon = 'ü´ì';
    if(match.type === 'fruit')  icon = 'üçé';
    if(match.type === 'drink')  icon = 'ü•õ';
    card.innerHTML = `
      <div class="ac-info">
        <div class="ac-title-row"><span>${icon}</span><span class="ac-title">${match.n}</span></div>
        ${displayType}
      </div>
      <div class="ac-stats">
        <div class="ac-cal">${match.c} <span style="font-size:0.7rem;color:var(--sub)">kcal</span></div>
        <div class="ac-unit">per ${displayUnit}</div>
      </div>`;
    card.onclick = (e) => {
      triggerHaptic(15);
      e.stopPropagation();
      selectFood(match.n, match.c, match.g);
    };
    list.appendChild(card);
  });
  list.style.display = 'flex';
}

function selectFood(name, baseCal, baseWeight) {
  document.getElementById('qName').value = name;
  currentBaseCal = baseCal;
  currentBaseWeight = baseWeight;
  document.getElementById('autocomplete-list').style.display = 'none';
  document.getElementById('qWeight').value = baseWeight;
  calcCals();
  document.getElementById('qWeight').focus();
}

function calcCals() {
  const weightEl = document.getElementById('qWeight');
  const calField = document.getElementById('qCal');
  if(!weightEl || !calField) return;
  const weight = parseFloat(weightEl.value) || 0;
  if (currentBaseCal > 0 && currentBaseWeight > 0 && weight > 0) {
    calField.value = Math.round((currentBaseCal / currentBaseWeight) * weight);
  } else {
    if (!calField.value) calField.value = '';
  }
}

document.addEventListener("click", function(e) {
  if (e.target.id !== "qName") {
    const list = document.getElementById("autocomplete-list");
    if(list) list.style.display = "none";
  }
});

/* ‚ïê‚ïê‚ïê QUICK MEAL SUBMIT ‚ïê‚ïê‚ïê */
function submitQuickMeal() {
  const nameEl = document.getElementById('qName');
  if(!nameEl) return;
  const name   = nameEl.value.trim();
  const weight = document.getElementById('qWeight').value.trim();
  const cal    = parseInt(document.getElementById('qCal').value) || 0;
  const timeval= document.getElementById('qTimeReal').value;
  
  if(!name){ showToast("Please select/enter a food","var(--a-red)"); triggerHaptic([50, 50]); return; }
  
  let timeLabel = "Now";
  if(timeval){
    const [hh,mm]=timeval.split(':');
    let h=parseInt(hh), ap=h>=12?'PM':'AM';
    if(h>12) h-=12; if(h===0) h=12;
    timeLabel=`${h}:${mm} ${ap}`;
  } else {
    const now=new Date();
    let h=now.getHours(), min=String(now.getMinutes()).padStart(2,'0'), ap=h>=12?'PM':'AM';
    if(h>12) h-=12; if(h===0) h=12;
    timeLabel=`${h}:${min} ${ap}`;
  }
  
  const meal = {
    id: Date.now(), timeLabel, name, calories: cal,
    items: [{ food: name, weight: weight ? weight+"g" : "‚Äî" }]
  };
  meals.push(meal);
  lsSet("np_meals", meals);
  
  nameEl.value   = '';
  document.getElementById('qWeight').value = '';
  document.getElementById('qCal').value    = '';
  currentBaseCal = 0; currentBaseWeight = 0;
  
  setDefaultTime(); 
  updateCalUI(); 
  updateDayHeaders();
  
  showToast(`‚úÖ Added ${name} to your plan!`);
  triggerHaptic([30, 50, 30]);
  
  if(typeof confetti !== 'undefined')
    confetti({ particleCount:100, spread:70, origin:{ y:0.6 } });
    
  if(document.getElementById("mealsPage").classList.contains("active")) renderMeals();
}

/* ‚ïê‚ïê‚ïê DELETE MEAL ‚ïê‚ïê‚ïê */
function deleteMeal(id){
  triggerHaptic(40);
  if(!confirm("Remove this meal from today's list?")) return;
  meals = meals.filter(m => m.id !== id);
  const chk = getChk();
  delete chk[id];
  setChk(chk);
  lsSet("np_meals", meals);
  updateCalUI(); updateDayHeaders();
  renderMeals();
  showToast("üóë Meal removed", "var(--sub)");
}

/* ‚ïê‚ïê‚ïê IMPORTER ‚Äî PLAN ‚ïê‚ïê‚ïê */
function importPlanData(){
  const raw = document.getElementById('importPlanArea').value.trim();
  if(!raw){ showToast("Paste your plan code first","var(--a-red)"); return; }
  try{
    const parsed = safeParseJSON(raw);
    const today  = DOW[new Date().getDay()];
    let daily = [];
    if(Array.isArray(parsed)){
      weeklyPlan[today] = parsed;
      lsSet("np_weeklyPlan", weeklyPlan);
      daily = parsed;
      showToast(`‚úÖ Plan set for ${today}!`);
    } else if(parsed && typeof parsed==='object'){
      const formatted={};
      for(let k in parsed){
        formatted[k.charAt(0).toUpperCase()+k.slice(1).toLowerCase()] = parsed[k];
      }
      weeklyPlan = formatted;
      lsSet("np_weeklyPlan", weeklyPlan);
      daily = weeklyPlan[today] || [];
      showToast("‚úÖ Full weekly plan imported!");
    } else { showToast("‚ùå Unrecognised format","var(--a-red)"); return; }
    
    applyDailyPlanToMeals(daily);
    lastLoadDate = todayKey();
    lsSet("np_lastLoadDate", lastLoadDate);
    document.getElementById('importPlanArea').value='';
    triggerHaptic([30, 50, 30]);
  } catch(e){ showToast("‚ùå Invalid JSON ‚Äî check your format","var(--a-red)"); }
}

/* ‚ïê‚ïê‚ïê PLAN HELPERS ‚ïê‚ïê‚ïê */
function loadDailyPlan(){
  if (lastLoadDate === todayKey()) { updateCalUI(); updateDayHeaders(); return; }
  const d=DOW[new Date().getDay()];
  const daily=weeklyPlan[d]||[];
  if(daily.length>0) { applyDailyPlanToMeals(daily); }
  else { meals = []; lsSet("np_meals", meals); updateCalUI(); updateDayHeaders(); }
  lastLoadDate = todayKey();
  lsSet("np_lastLoadDate", lastLoadDate);
}

function applyDailyPlanToMeals(arr){
  meals=arr.map((slot,i)=>({
    id: slot.id || Date.now()+i,
    timeLabel: slot.time || slot.timeLabel || "‚Äî",
    name: slot.name || slot.food || `Meal ${i+1}`,
    calories: parseInt(slot.calories)||0,
    items: slot.items || (slot.food?[{food:slot.food,weight:slot.weight||"‚Äî"}]:[])
  }));
  lsSet("np_meals",meals);
  updateCalUI(); updateDayHeaders();
  if(document.getElementById("mealsPage").classList.contains("active")) renderMeals();
}

function updateDayHeaders(){
  const d=DOW[new Date().getDay()];
  const t=`${d}'s Meals`;
  const pt=document.getElementById("mealsPageTitle");
  const nt=document.getElementById("navMealTitle");
  if(pt) pt.textContent=t;
  if(nt) nt.textContent=t;
}

/* ‚ïê‚ïê‚ïê EDIT CALORIE TARGET ‚ïê‚ïê‚ïê */
function editCalTarget() {
  const newTarget = prompt("Enter your daily calorie target:", calTarget);
  if (newTarget !== null && !isNaN(newTarget) && newTarget > 0) {
    calTarget = parseInt(newTarget);
    lsSet("np_calTarget", calTarget);
    updateCalUI();
    if(document.getElementById("mealsPage").classList.contains("active")) renderMeals();
  }
}

/* ‚ïê‚ïê‚ïê CALORIES ‚ïê‚ïê‚ïê */
function getConsumed(){
  const chk=getChk();
  return meals.filter(m=>chk[m.id]).reduce((s,m)=>s+Number(m.calories),0);
}

function getCheckedCount(){
  const chk = getChk();
  return meals.filter(m => chk[m.id]).length; 
}

function updateCalUI(){
  const total=calTarget;
  const cons=getConsumed();
  const pct=Math.min(cons/total*100,100);
  
  const cc = document.getElementById("calConsumed");
  const cr = document.getElementById("calRemain");
  const ctl = document.getElementById("calTotalLbl");
  const cgl = document.getElementById("calGoalLabel");
  const cb = document.getElementById("calBar");
  const cp = document.getElementById("calPct");
  const nms = document.getElementById("navMealSub");
  
  if(cc) cc.textContent=cons;
  if(cr) cr.textContent=total-cons;
  if(ctl) ctl.textContent="of "+total+" kcal planned";
  if(cgl) cgl.innerHTML=total+" kcal ‚úé";
  if(cb) cb.style.width=pct+"%";
  if(cp) cp.textContent=Math.round(pct)+"%";

  const chkCnt = getCheckedCount();
  if(nms) nms.textContent= meals.length>0 ? `${chkCnt}/${meals.length} meals done ¬∑ ${cons} kcal` : "No plan loaded yet";
}

/* ‚ïê‚ïê‚ïê NO MAIDA ‚ïê‚ïê‚ïê */
function markNoMaida(){
  triggerHaptic(40);
  const key=todayKey();
  const lbl=new Date().toLocaleDateString("en-IN",{weekday:"short",day:"numeric",month:"short"});
  if(!noMaida.find(d=>d.date===key)){ noMaida.push({date:key,label:lbl}); lsSet("np_nomaida",noMaida); }
  renderNoMaida();
  updateStatsBar(); 
  if(typeof confetti !== 'undefined'){
    const count=400;
    const defaults={ origin:{y:0.7}, colors:['#ff0000','#ff7f00','#ffff00','#00ff00','#0000ff','#4b0082','#9400d3'] };
    function fire(r,o){ confetti(Object.assign({},defaults,o,{particleCount:Math.floor(count*r)})); }
    fire(0.25,{spread:26,startVelocity:55}); fire(0.2,{spread:60});
    fire(0.35,{spread:100,decay:0.91,scalar:0.8}); fire(0.1,{spread:120,startVelocity:25,decay:0.92,scalar:1.2});
    fire(0.1,{spread:120,startVelocity:45});
  }
}

function renderNoMaida(){
  const key=todayKey(), cnt=noMaida.length, marked=!!noMaida.find(d=>d.date===key);
  const cp=document.getElementById("maidaCntPage");
  const cm=document.getElementById("maidaCntMain");
  if(cp) cp.textContent=cnt;
  if(cm) cm.textContent=cnt;
  const btn=document.getElementById("maidaBtn");
  if(btn){ btn.textContent=marked?"üéâ Today Marked! Keep Going!":"‚úÖ Mark Today as No-Maida Day!"; btn.classList.toggle("marked",marked); }
  const chips=document.getElementById("maidaChips");
  if(chips) chips.innerHTML=noMaida.slice(-12).map(d=>`<div class="chip">‚úÖ ${d.label}</div>`).join("");
  const nav=document.getElementById("maidaNavSub");
  if(nav) nav.textContent=cnt>0?`${cnt} clean day${cnt>1?'s':''} üåü`:"Tap to mark today!";
}

/* ‚ïê‚ïê‚ïê TOGGLE MEAL ‚ïê‚ïê‚ïê */
function toggleMeal(id){
  const chk=getChk(); chk[id]=!chk[id]; setChk(chk);
  triggerHaptic(chk[id] ? 50 : 20); 
  
  if(chk[id] && typeof confetti !== 'undefined'){
    confetti({ particleCount:150, spread:80, origin:{y:0.6},
      colors:['#00E5A0','#4D9EFF','#C77DFF','#FFD700'], scalar:1.2 });
  }
  renderMeals(); updateCalUI();
}

/* ‚ïê‚ïê‚ïê RENDER MEALS ‚ïê‚ïê‚ïê */
function renderMeals(){
  const container=document.getElementById("mealList");
  if(!container) return;
  const chk=getChk();
  const d=DOW[new Date().getDay()];
  const now=new Date();
  const curMins=now.getHours()*60+now.getMinutes();
  
  if(!meals.length){
    container.innerHTML=`<div class="empty-state">
      <div class="empty-icon">üçΩ</div>
      <div style="font-size:18px;font-weight:900;font-family:var(--font-head);margin-bottom:8px">No plan for ${d}</div>
      <div style="font-size:13px">Use the Quick Add tool below to start tracking!</div>
    </div>`;
    const mp1=document.getElementById("mp-cons"); if(mp1) mp1.textContent=0;
    const mp2=document.getElementById("mp-rem");  if(mp2) mp2.textContent=0;
    return;
  }
  
  let nextIdx=-1;
  meals.forEach((m,i)=>{
    const mm=parseTimeMins(m.timeLabel);
    if(nextIdx===-1 && mm>curMins && !chk[m.id]) nextIdx=i;
  });
  if(nextIdx===-1) meals.forEach((m,i)=>{ if(nextIdx===-1 && !chk[m.id]) nextIdx=i; });

  container.innerHTML=meals.map((m,i)=>{
    const isDone=!!chk[m.id];
    const isNext=(i===nextIdx);
    const color=PALETTE[i%PALETTE.length];
    const rgb=hexToRgb(color);
    const valid=(m.items||[]).filter(x=>x.food&&x.food.trim());
    const itemsHtml=valid.length
      ? valid.map(x=>`<div class="ing-row">
          <div class="ing-left"><div class="ing-bullet" style="background:${color}"></div><span>${x.food}</span></div>
          <div class="ing-tag">${x.weight||'‚Äî'}</div>
        </div>`).join('')
      : `<div class="ing-row" style="justify-content:center;border:none"><span style="color:var(--sub);font-size:.8rem;font-style:italic">Activity Checkpoint</span></div>`;

    return `<div class="meal-card ${isDone?'checked':''} ${isNext?'highlight':''}"
         id="meal-card-${i}" style="--accent-color:${color};--accent-rgb:${rgb};animation-delay:${i*.05}s">
      <div class="next-badge">Next Up</div>
      <div class="mc-content">
        <div class="mc-top">
          <span class="mc-time">${m.timeLabel||'‚Äî'}</span>
          <span class="mc-cal">${m.calories||0} kcal</span>
        </div>
        <div class="mc-title">${m.name}</div>
        <div>${itemsHtml}</div>
      </div>
      <div class="mchk ${isDone?'on':''}" onclick="toggleMeal(${m.id})">‚úì</div>
      <button class="del-meal" onclick="deleteMeal(${m.id})" title="Remove meal">‚úï</button>
    </div>`;
  }).join('');

  const cons=getConsumed();
  const total=calTarget;
  const mp1=document.getElementById("mp-cons"); if(mp1) mp1.textContent=cons;
  const mp2=document.getElementById("mp-rem");  if(mp2) mp2.textContent=total-cons;
}

function scrollToNextMeal(){
  const el=document.querySelector('.meal-card.highlight');
  if(el) el.scrollIntoView({behavior:'smooth',block:'center'});
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SAVE TO HISTORY
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function saveToHistory(){
  triggerHaptic(40);
  const key=todayKey();
  appHistory[key]={ calories:getConsumed(), water:getWater(), target:calTarget, savedAt:new Date().toISOString() };
  lsSet("np_history",appHistory);
  showToast("‚úÖ Progress Saved!");
  updateNavSubs();
  updateStatsBar();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   RENDER HISTORY
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderHistory(){
  const container=document.getElementById("historyList");
  if(!container) return;
  const keys=Object.keys(appHistory).sort((a,b)=>b.localeCompare(a));
  if(!keys.length){
    container.innerHTML=`<div class="h-empty">
      <div class="h-empty-icon">üìä</div>
      <div style="font-size:18px;font-family:var(--font-head);font-weight:900;margin-bottom:8px">No history yet</div>
      <div style="font-size:13.5px">Track your meals then save progress to build your log</div>
    </div>`;
    return;
  }
  container.innerHTML=keys.map((key,idx)=>{
    const d=new Date(key);
    const lbl=d.toLocaleDateString("en-IN",{weekday:"long",day:"numeric",month:"long",year:"numeric"});
    const data=appHistory[key], nm=!!noMaida.find(n=>n.date===key);
    const target=data.target || 2800;
    const cp=Math.min((data.calories/target)*100,100), wp=Math.min((data.water/5000)*100,100);
    return `<div class="h-card" style="animation-delay:${idx*.06}s">
      ${nm?'<div class="h-badge">üèÜ</div>':""}
      <div class="h-date">${lbl}</div>
      <div class="h-grid">
        <div class="h-stat"><div class="h-sn" style="color:var(--accent)">${data.calories}</div><div class="h-sl">kcal eaten</div></div>
        <div class="h-stat"><div class="h-sn" style="color:var(--water)">${data.water}</div><div class="h-sl">ml water</div></div>
      </div>
      <div style="margin-bottom:10px">
        <div style="display:flex;justify-content:space-between;font-size:11.5px;color:var(--sub);margin-bottom:6px; font-weight:600;">
          <span>üî• Calories</span><span>${Math.round(cp)}%</span></div>
        <div class="pbar-wrap" style="height:10px"><div class="pbar pb-cal" style="width:${cp}%"></div></div>
      </div>
      <div>
        <div style="display:flex;justify-content:space-between;font-size:11.5px;color:var(--sub);margin-bottom:6px; font-weight:600;">
          <span>üíß Hydration</span><span>${Math.round(wp)}%</span></div>
        <div class="pbar-wrap" style="height:10px"><div class="pbar pb-water" style="width:${wp}%"></div></div>
      </div>
      ${nm?'<div style="margin-top:16px;background:rgba(255,215,0,0.1);border:1px solid rgba(255,215,0,0.3);border-radius:12px;padding:10px;font-size:12.5px;color:var(--gold);font-weight:800;text-align:center">üèÜ No Maida Day!</div>':""}
    </div>`;
  }).join('');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PRO: WEIGHT TRACKER
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function logWeight(){
  triggerHaptic(20);
  const inputEl = document.getElementById('weightInput');
  if(!inputEl) return;
  const val = parseFloat(inputEl.value);
  
  if(isNaN(val) || val < 30 || val > 300){ showToast("Enter a valid weight (30-300 kg)","var(--a-red)"); triggerHaptic([50, 50]); return; }
  const entry = { date: todayKey(), weight: val, ts: Date.now() };
  
  weightLog = weightLog.filter(e => e.date !== todayKey());
  weightLog.push(entry);
  weightLog.sort((a,b) => a.date.localeCompare(b.date));
  lsSet("np_weightLog", weightLog);
  
  inputEl.value = '';
  renderWeightPage();
  updateWeightNavSub();
  showToast(`‚öñÔ∏è Logged ${val} kg!`);
  
  if(typeof confetti !== 'undefined')
    confetti({ particleCount:80, spread:50, origin:{y:0.6}, colors:['#00E5A0','#29B6F6'] });
}

function renderWeightPage(){
  const list = document.getElementById('weightHistList');
  const currentDisp = document.getElementById('currentWtDisplay');
  const toGoEl = document.getElementById('toGoKg');
  const barWrap = document.getElementById('wtGoalBarWrap');
  if(!list || !currentDisp || !toGoEl) return;
  
  const TARGET = 80.0;

  if(!weightLog.length){
    currentDisp.textContent = '‚Äî kg';
    toGoEl.textContent = '‚Äî kg to go';
    list.innerHTML = '<div style="text-align:center;color:var(--sub);padding:30px 20px;font-size:13.5px">No entries yet. Log your first weight above!</div>';
    if(barWrap) barWrap.style.display = 'none';
    return;
  }

  const latest = weightLog[weightLog.length-1];
  const toGo = Math.max(0, latest.weight - TARGET).toFixed(1);
  currentDisp.textContent = `${latest.weight} kg`;
  toGoEl.textContent = `${toGo} kg to go`;

  if(barWrap) {
    const startWeight = weightLog[0].weight;
    const totalToLose = Math.max(1, startWeight - TARGET);
    const lostSoFar = startWeight - latest.weight;
    const pct = Math.min(Math.max(0, (lostSoFar / totalToLose) * 100), 100);
    barWrap.style.display = 'block';
    document.getElementById('wtGoalBar').style.width = pct + '%';
    document.getElementById('wtStartLbl').textContent = `${startWeight} kg (start)`;
  }

  const reversed = [...weightLog].reverse();
  list.innerHTML = reversed.map((e, i) => {
    const prev = reversed[i+1];
    let diffHtml = '';
    if(prev){
      const diff = (e.weight - prev.weight).toFixed(1);
      const cls = diff < 0 ? 'we-down' : diff > 0 ? 'we-up' : 'we-same';
      const arrow = diff < 0 ? '‚ñº' : diff > 0 ? '‚ñ≤' : '‚Äî';
      diffHtml = `<span class="we-diff ${cls}">${arrow} ${Math.abs(diff)} kg</span>`;
    }
    const d = new Date(e.date);
    const lbl = d.toLocaleDateString("en-IN",{weekday:"short",day:"numeric",month:"short"});
    const isToday = e.date === todayKey();
    return `<div class="weight-entry" ${isToday?'style="border-color:var(--accent);"':''}>
      <div>
        <div class="we-date">${lbl}${isToday?' ¬∑ Today':''}</div>
      </div>
      <div style="display:flex;align-items:center;gap:12px;">
        ${diffHtml}
        <div class="we-val" style="color:${e.weight <= TARGET ? 'var(--a-green)' : 'var(--text)'}">${e.weight} kg</div>
      </div>
    </div>`;
  }).join('');
}

function updateWeightNavSub(){
  const el = document.getElementById('weightNavSub');
  if(!el) return;
  if(!weightLog.length){ el.textContent = 'Log your daily weight'; return; }
  const latest = weightLog[weightLog.length-1];
  const toGo = Math.max(0, latest.weight - 80.0).toFixed(1);
  el.textContent = `Current: ${latest.weight} kg ¬∑ ${toGo} kg to goal`;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PRO: STATS BAR
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function updateStatsBar(){
  const keys = Object.keys(appHistory);
  const daysLogged = keys.length;
  let avgCal = '‚Äî';
  if(daysLogged > 0){
    const sum = keys.reduce((s,k) => s + (appHistory[k].calories||0), 0);
    avgCal = Math.round(sum/daysLogged);
  }
  const el1 = document.getElementById('statAvgCal');
  const el2 = document.getElementById('statDaysLogged');
  const sm = document.getElementById('statMaida');
  if(el1) el1.textContent = avgCal;
  if(el2) el2.textContent = daysLogged;
  if(sm) sm.textContent = noMaida.length;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DATE + NAV SUBS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function updateDate(){
  const hd = document.getElementById("hdrDate");
  if(hd) hd.textContent=new Date().toLocaleDateString("en-IN",{weekday:"long",day:"numeric",month:"long"});
}
function updateNavSubs(){
  const hCnt=Object.keys(appHistory).length;
  const nhs = document.getElementById("navHistSub");
  if(nhs && hCnt>0) nhs.textContent=`${hCnt} day${hCnt>1?"s":""} logged`;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   RENDER HOME
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderHome(){
  setDefaultTime(); 
  updateDate();
  updateDayHeaders();
  
  const sn = document.getElementById("streakNum");
  if(sn) sn.textContent=streak;
  
  applyTheme();
  updateCalUI();
  updateWaterUI();
  renderNoMaida();
  updateNavSubs();
  renderQuote();
  updateStatsBar();
  updateWeightNavSub();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INIT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
updateStreak();
loadDailyPlan();
renderHome();
</script>
</body>
</html>